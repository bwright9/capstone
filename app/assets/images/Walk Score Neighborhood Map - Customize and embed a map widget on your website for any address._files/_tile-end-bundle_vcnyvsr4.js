function showAdsOnMap(t,e){if(!this.myAd){var i=1==t?google.maps.adsense.AdFormat.BUTTON:google.maps.adsense.AdFormat.VERTICAL_BANNER;e=_({format:i,position:google.maps.ControlPosition.RIGHT_BOTTOM,channel:"5139475795",publisher:"pub-0760627883975840"}).extend(e),this.myAd=new google.maps.adsense.AdUnit($("<div />")[0],{format:e.format,position:e.position,map:this,visible:!0,channelNumber:e.channel,publisherId:e.publisher})}}function AmenityManager(t,e){this.initIconFactory=function(){var t=this.iconFactory=new IconFactory;_(["makeCenterPinIcon","makeHouseIcon","makeBuildingIcon","makeClientCustomIcon","makeBadgeIcon"]).each(_(function(e){this[e]=_(t[e]).bind(t)}).bind(this))},this.initIconFactory(),this.geoData=e,this.app=t,this.dataSourceManager=t.dataSourceManager,this.transitResults=[],this.routeList=null,this.list={},this.untrimmed_list={},this.queries={},this.compositions={},this.parents={},this.removedPlaces={},this.addedPlaceData={},this.affectedCats={},this.markedForDelete=[],this.resultSetCap=8,this.routesToShow=6,this.transitStopsCap=8,this.TRANSIT_MODE_MIXED_MODE=101,this.TRANSIT_MODE_CLOSEST=102,this.transitMode=this.TRANSIT_MODE_MIXED_MODE,this.setTransitMode=function(t){this.transitMode=t},this.q_d=function(t,e){return this.dataSourceManager.dispatch(t.getService(),e)},this.addQuery=function(t){var e=t.getName();if(this.queries[e]!==t){this.queries[e]=t,this.list[e]||(this.list[e]=[],this.untrimmed_list[e]=[]);var i=t.parentQuery();if(i){var n=i.getName();this.parents[e]=n,this.compositions[n]||(this.compositions[n]=[]),this.compositions[n].push(e),this.addQuery(i)}_(t.includes||[]).each(_(this.addQuery).bind(this))}},this.addResultSet=function(t,e,i){this.list[t]=e,this.untrimmed_list[t]=e,this.addQuery(i)},this.getResult=function(t,e){return this.list[t][e]},this.getResultSet=function(t){return this.list[t]},this.setResultSetCap=function(t){this.resultSetCap=t},this.setTransitRoutesCap=function(t,e){this.routesToShow=t},this.getTransitResultById=function(t){for(var e in this.transitResults)if(this.transitResults[e].getId()==t)return this.transitResults[e]},this.getRouteById=function(t){return this.routeList.getRoute(t)},this.getDefaultRoutesPackage=function(){return null!=this.routeList?this.routeList.getDefaultRoutesPackage(this.routesToShow):null},this.getRoutePackage=function(t){return null!=this.routeList?this.routeList.getRoutePackage(t):null},this.getRoutesByCategories=function(t,e){return null!=this.routeList?this.routeList.getRoutesByCategories(t,e):null},this.getFeaturedTransitResults=function(){return this.featuredTransitResults},this.getAllTransitResults=function(){return this.transitResults},this.areMoreTransitResultsThanFeatured=function(){return this.transitResults.length>this.featuredTransitResults.length},this.furthestAmenityDistance=function(){var t=0;for(var e in this.list)t=Math.max(t,this.furthestDistanceInCategory(e));return t},this.furthestDistanceInCategory=function(t){for(var e=0,i=this.list[t],n=0;n<i.length;n++)i[n].getDist()>e&&(e=i[n].getDist());return e},this.processCurationData=function(t){t&&t.removed&&this.processRemovals(t.removed,!1),t&&t.added&&this.processLoadedAdditions(t.added),this.updateAllAffectedCats(!1)},this.updateAllAffectedCats=function(t){this._applyRoutedDistances&&this._applyRoutedDistances();for(var e=0;2>e;e++){_(this.affectedCats).chain().keys().map(_(function(t){retval=[t];for(var e=this.queries[t];e.isChild();)e=e.parentQuery(),retval.push(e.getName());return retval}).bind(this)).flatten().each(_(function(e){this.sortAmenityResults(e,this.resultSetCap,!0),this.updateView(e,this.list[e],t)}).bind(this));this.affectedCats={},t&&LocalCache.clearLike(/^_ws_curation/),e||(t=!1,this.handleLocalCuration())}},this.processRemovals=function(t,e){for(var i=0;i<t.length;i++)this.removedPlaces[t[i]]=!0;DEBUG_CURATION&&dbug("checking removals");for(var n in this.list)this.processRemovalsFromCategory(n);e&&this.updateAllAffectedCats(e)},this.processRemovalsFromCategory=function(t){for(var e=this.list[t],i=!1,n=0;n<e.length;n++)for(var s in this.removedPlaces)e[n].isRemoved()||e[n].getKey()!=s||(DEBUG_CURATION&&dbug(" === MATCH! ===  removing a place: "+e[n].getKey()),e[n].markAsRemoved(),i=!0,this.affectedCats[t]=!0);return i},this.restoreAmenity=function(t){if(t.isRemoved()){delete this.removedPlaces[t.getKey()];var e=t.getKey();for(var i in this.list)for(var n=this.list[i],s=0;s<n.length;s++)n[s].isRemoved()&&n[s].getKey()==e&&(DEBUG_CURATION&&dbug(" === MATCH! ===  restoring a place: "+n[s].getKey()),n[s].markAsRestored(),this.affectedCats[i]=!0)}this.updateAllAffectedCats(!0)},this.updateView=function(t,e,i){this.app.updateAmenitySet(t,e,i)},this.processLoadedAdditions=function(t){for(var e in t)this.addedPlaceData[t[e].category]||(this.addedPlaceData[t[e].category]=[]),this.addedPlaceData[t[e].category][t[e].key]=t[e];DEBUG_CURATION&&dbug("checking loaded additions against all cats currently loaded");var i=[];for(var n in this.list){var s=this.applyAdditionsToCategory(n);s.length>0&&(i[n]=s)}return i},this.applyAdditionsToCategory=function(t){var e=[];if(this.addedPlaceData[t]&&this.list[t])for(var i in this.addedPlaceData[t]){var n=this.addedPlaceData[t][i];if(!this.getAmenityByCatAndKey(t,n.key)){var s=this.geoData.getLatLng().distanceFrom(new ws.LatLng(n.lat,n.lng));(s<this.furthestDistanceInCategory(t)||this.list[t].length<this.resultSetCap&&16093>s)&&(DEBUG_CURATION&&dbug("adding loaded addition: "+n.name+" -- was within range"),this.finalizeAddition(t,n),this.sortAmenityResults(t,this.resultSetCap,!0))}}return e},this.getIconAndIconSel=function(t){for(var e=t;!e.getIconName()&&e.isChild();)e=e.parentQuery();var i=e.getIconName(),n=e.isCustom()?this.iconFactory.makeCustomIcon(i):this.iconFactory.makeAmenityIcon(i),s=e.isCustom()?this.iconFactory.makeCustomIcon(i):this.iconFactory.makeSelectedAmenityIcon(i);return[n,s]},this.finalizeAddition=function(t,e){DEBUG_CURATION&&dbug("finalizing addition: "+e.name);var i=this.getIconAndIconSel(this.queries[t]),n=this.createAmenityResultFromCuratedData(e,this.geoData.getLatLng(),i[0],i[1],t);return this.list[t].push(n),this.untrimmed_list[t].push(n),this.affectedCats[t]=!0,n},this.addNewResult=function(t,e,i){var n=t.key,s=t.category;t.removed=!1,t.freshly_added=!0,this.getAmenityByCatAndKey(s,n)&&this.deleteResult(s,n,!1);var a=this.finalizeAddition(s,t);return i&&this.updateAllAffectedCats(!0),a},this.deleteResult=function(t,e,i){this.markedForDelete.push({category:t,key:e}),this.affectedCats[t]=!0,this.finalizeDeletions(),i&&this.updateAllAffectedCats(!0)},this.finalizeDeletions=function(){for(var t=0;t<this.markedForDelete.length;t++){for(var e=this.queries[this.markedForDelete[t].category],i=[e.getName()];e.isChild();)e=e.parentQuery(),i.push(e.getName());for(var n=this.markedForDelete[t].key,s=0;s<i.length;s++)for(var a=i[s],o=0;o<this.list[a].length;o++)n==this.list[a][o].getKey()&&(removeFromArray(this.list[a],o),DEBUG_CURATION&&dbug("removing "+this.list[a][o].name+" from "+a));removeFromArray(this.markedForDelete,t)}},this.getAmenityByCatAndKey=function(t,e){if(this.list[t])for(var i=this.list[t],n=0;n<i.length;n++)if(i[n].getKey()==e)return i[n];return null},this.runCurationAnalyticsReport=function(){for(var t in this.list){for(var e=0,i=this.list[t],n=0;n<i.length;n++)i[n].isRemoved()&&e++;e>3&&trackEvent("Curation","More than 3 removed",e+" from "+t+" at: "+document.location.href)}},this.applyRoutedDistances=function(t,e){this._applyRoutedDistances=_(function(){_(t.list).each(_(function(t){if(!t.isChild()){var i=t,n=_([i,i.includes||[]]).flatten();_(n).each(_(function(t){this.applyRoutedDistancesInCategory(t.getName(),e[i.id].results)}).bind(this))}}).bind(this))}).bind(this),this.updateAllAffectedCats(!1)},this.applyRoutedDistancesInCategory=function(t,e){if(this.list[t]){for(var i=this.list[t],n=0;n<i.length;n++){var s=i[n],a=_(e).detect(function(t){return Math.abs(s.point.lat()-t.lat)<2e-4&&Math.abs(s.point.lng()-t.lon)<2e-4});s.displayDist=a?1609.3*a.distance:ws.LARGE_DISTANCE+s.displayDist}this.affectedCats[t]=!0}},this.makeAmenitiesFromRawResults=function(t){for(var e=t.getQuery(),i=e;!i.getIconName()&&i.isChild();)i=i.parentQuery();var n=e.getName();DEBUG_CURATION&&dbug("loading category "+n);var s=this.q_d(e,"makeAmenitiesFromRawResults")(t);_(s).each(function(t){t.originQuery=e}),_(s).each(function(t){t.displayQuery=i}),this.pid_local||(this.pid_local={}),"Local"==e.service&&_(s).each(_(function(t){this.pid_local[t.pid]=t}).bind(this)),s&&(this.addResultSet(n,s,e),this.processRemovalsFromCategory(n,!1),this.applyAdditionsToCategory(n),this.affectedCats[n]=!0,this.updateAllAffectedCats(!1))},this.refresh=function(){for(var t in this.untrimmed_list)_(this.untrimmed_list[t]).each(_(function(e){this.affectedCats[t]=!0}).bind(this));this.updateAllAffectedCats()},this.sortAmenityResults=function(t,e,i){var n=this.list[t]||[];_(this.compositions[t]||[]).each(_(function(t){n=n.concat(this.untrimmed_list[t]||[])}).bind(this)),n.length>1&&(i=defaultIfNotSet(i,!0),n.sort(function(t,e){return t.getDist()-e.getDist()||(t.getName()<e.getName()?-1:1)}),i&&(n=this.dedupeAndFilterAmenities(n)),this.untrimmed_list[t]=n,e&&e<n.length&&(n=n.slice(0,e),n=n.concat(_(this.untrimmed_list[t].slice(e)).select(function(t){return t.freshlyAdded}))),n.sort(function(t,e){return t.removed!=e.removed?t.removed?1:-1:t.getDist()-e.getDist()})),this.list[t]=n,this.parents[t]&&this.sortAmenityResults(this.parents[t],e,i)},this.dedupeAndFilterAmenities=function(t){var e=[];t=_(t).reject(_(function(t){return"Local"==t.getDataSource()&&this.pid_curated[t.pid]}).bind(this)),t[0]&&e.push(t[0]);for(var i=1;i<t.length;i++){var n=t[i].getStreetAddress?t[i].getStreetAddress():"",s=t[i-1].getStreetAddress?t[i-1].getStreetAddress():"",a=!isEmptyString(n)&&!isEmptyString(s)&&n==s;t[i].getName()==t[i-1].getName()||a?(t[i-1].displayDist==t[i].displayDist&&t[i].getUrl&&t[i].getUrl()||"Curated"!=t[i-1].getDataSource()&&"Curated"==t[i].getDataSource()&&t[i].pid&&t[i].pid==t[i-1].pid)&&(e[e.length-1]=t[i]):e.push(t[i])}return e},this.handleLocalCuration=function(){this.pid_curated||(this.pid_curated={}),this.pid_local||(this.pid_local={});for(var t in this.untrimmed_list)_(this.untrimmed_list[t]).each(_(function(t){if(t.pid&&"Curated"==t.getDataSource()){this.pid_curated[t.pid]=t;var e=this.pid_local[t.pid];e&&(t.local_source=e,this.affectedCats[e.category]=!0)}}).bind(this))},this.createAmenityResultFromCuratedData=function(t,e,i,n,s){var a,o=t.key;"ws_local_"==o.substr(0,9)&&(a=o.substr(9));var r=new AmenityResult({key:o,pid:a,app:this.app,rawCenter:e,icon:i,iconSel:n,category:s,lat:t.lat,lng:t.lng,url:reversespecialchars(t.url),name:reversespecialchars(t.name),address:reversespecialchars(t.address),city:reversespecialchars(t.city),region:reversespecialchars(t.region),phoneNumber:reversespecialchars(t.phone),dataSource:"Curated"});return r.userAddress=t.user_address,r.originQuery={api:"curation"},r.displayQuery=this.queries[r.category],r.local_source=t.local_source,t.removed&&r.markAsRemoved(),t.freshly_added&&(r.freshlyAdded=!0),r},this.initializeTransitResultsAndRoutes=function(t){this.iconFactory.initTransitIcons();var e=t.getResults();if(null!=e){this.routeList=new RouteList;for(var i=0;i<e.length;i++){var n=e[i];if(n.id&&n.lat&&n.lon&&n.name&&n.route_summary&&n.route_summary.length>0){var s=new ws.LatLng(n.lat,n.lon),a=new TransitResult({app:this.app,stop_id:n.id,stop_name:n.name,point:s,rawCenter:this.geoData.getLatLng()});this.transitResults.push(a);var o=[],r=[];_(n.route_summary).each(_(function(t){var e=t.category.toLowerCase(),i=this.routeList.addIfUnique(t.id,t.name,e,t.agency,t.agency_url,a);i?r.push(i):i=this.routeList.getRouteById(t.id),i&&o.push(i)}).bind(this)),a.setRoutes(o),a.setUniqueRoutes(r)}}if(this.transitResults.sort(function(t,e){return t.getDist()-e.getDist()}),this.featuredTransitResults=[],this.transitMode==this.TRANSIT_MODE_MIXED_MODE){var l=this.routeList.getDefaultRoutesPackage(this.routesToShow);_(l).each(_(function(t){_(this.featuredTransitResults).contains(t.nearestStop)||this.featuredTransitResults.push(t.nearestStop)}).bind(this))}for(var i=0;i<this.transitResults.length&&this.featuredTransitResults.length<this.resultSetCap;)_(this.featuredTransitResults).contains(this.transitResults[i])||this.featuredTransitResults.push(this.transitResults[i]),i++;this.featuredTransitResults.sort(function(t,e){return t.getDist()-e.getDist()})}},this.createSimpleMarker=function(t,e,i,n,s,a){return new SimpleMarker(t,e,i,n,s,a)}}function Result(t){if(null!=(t||{}).point){for(k in t)this[k]=t[k];this.displayDist=t.rawCenter.distanceFrom(this.point),this.key=null,this.removed=!1,this.markerShown=!1,this.displayDist||(this.displayDist=.01),this.getKey(),this.getHighResKey()}}function AmenityResult(t){t.point=new ws.LatLng(t.lat,t.lng),this.parent.constructor.call(this,t),this.url=t.url,this.streetAddress=t.address,this.city=t.city,this.region=t.region,this.phoneNumber=t.phoneNumber,this.yelpLookupDone=!!t.yelpBiz,this.yelpBiz=t.yelpBiz,this.dataSource=t.dataSource,this.pid=t.pid,this.key=t.key,this.provider=t.provider,this.encpoly=t.encpoly}function TransitRoute(t,e,i,n,s,a){this.id=t,this.name=safeString(e),this.category=i,this.agency=safeString(n),this.agencyUrl=safeString(s),this.nearestStop=a}function RouteList(){this.list=[],this.length=function(){return this.list.length},this.getRoute=function(t){return this.list[t]},this.getRouteById=function(t){for(var e in this.list)if(t==this.list[e].id)return this.list[e];return null},this.isInList=function(t){for(var e in this.list)if(this.list[e].id==t)return!0;return!1},this.getResult=function(t){return list[t].getNearestStop()},this.sortByTypeAndName=function(){this.list.sort(function(t,e){if(t.category!=e.category)return"rail"==t.category?-1:1;var i=getLeadingNumber(t.name),n=getLeadingNumber(e.name);return i&&n&&i!=n?i-n:t.name>e.name?1:t.name<e.name?-1:0})},this.sortByDist=function(){this.list.sort(function(t,e){return t.getNearestStop().distance()-e.getNearestStop().distance()})},this.add=function(t){this.list.push(t)},this.addIfUnique=function(t,e,i,n,s,a){if(!this.isInList(t)){var o=new TransitRoute(t,e,i,n,s,a);return this.list.push(o),o}return null},this.getDefaultRoutesPackage=function(t){var e=this.getRoutesByCategories("rail",t),i=this.getRoutesByCategories(["bus","other"],t),n=numOther=t/2;return e.length<n?numOther=Math.min(numOther+(n-e.length),i.length):i.length<numOther&&(n=Math.min(n+(numOther-i.length),e.length)),n<e.length&&(e=e.slice(0,n)),numOther<i.length&&(i=i.slice(0,numOther)),e.concat(i)},this.getRoutePackage=function(t){var e=[];for(var i in t){var n=t[i].types,s=t[i].num,a=this.getRoutesByCategories(n,s);e=e.concat(a)}return e},this.getRoutesByCategories=function(t,e){"string"==typeof t&&(t=[t]);for(var i=[],n=0;n<this.list.length&&i.length<e;n++)_(t).contains(this.list[n].getCategory())&&i.push(this.list[n]);return i}}function TransitResult(t){t.name=t.stop_name,t.icon=busIcon,t.iconSel=busIconSel,t.category="Transit",t.dataSource="Transit-API",this.parent.constructor.call(this,t),this.id=t.stop_id,this.routes=[],this.uniqueRoutes=[],this.zIndexGroup=ws.zIndexGroups.TRANSIT_MARKERS}function SimpleMarker(t,e,i,n,s,a){this.app=t,this.latlng=e,this.icon=i,this.street=safeString(n),this.cityStateZip=safeString(s),this.shadowIcon=a}function IconFactory(){this.iconCache=new SimpleCache,this.offsets={"art.png":{x:0,y:16},"bank.png":{x:0,y:12},"bar.png":{x:0,y:2},"bike.png":{x:0,y:19},"bookstore.png":{x:0,y:9},"cafe.png":{x:0,y:1},"carshare.png":{x:0,y:23},"child-care.png":{x:0,y:21},"drug-store.png":{x:0,y:10},"dry-cleaner.png":{x:0,y:15},"fitness.png":{x:0,y:18},"grocery.png":{x:0,y:0},"hardware.png":{x:0,y:14},"hospital.png":{x:0,y:17},"hotel.png":{x:0,y:20},"library.png":{x:0,y:8},"movie-theater.png":{x:0,y:7},"office_supplies.png":{x:0,y:22},"park.png":{x:0,y:4},"post-office.png":{x:0,y:13},"restaurant.png":{x:0,y:3},"retail.png":{x:0,y:5},"school.png":{x:0,y:6},"worship.png":{x:0,y:11}},this.transitOffsets={"rail.png":{x:0,y:0},"bus.png":{x:0,y:1},"boat.png":{x:0,y:2}},this.customOffsets={"GDarkGreen.png":{x:1,y:3},"GBrown.png":{x:1,y:2},"GPink.png":{x:1,y:4},"GLightBlue.png":{x:0,y:4},"GOrange.png":{x:1,y:0},"GPurple.png":{x:1,y:1},"GRed.png":{x:0,y:3},"GBlue.png":{x:0,y:0},"GGreen.png":{x:0,y:2},"GYellow.png":{x:0,y:1}},this.createIcon=function(t,e,i,n,s,a,o,r){var l=this.iconCache.get(t);if(l)return l;var a=defaultIfNotSet(a,e/2),o=defaultIfNotSet(o,i),h="//cdn2.walk.sc/2/images/icons/icon-sprites3.png";r||(r=h);var c={};return window.google&&(c={url:r,size:new google.maps.Size(e,i),origin:new google.maps.Point(n,s),anchor:new google.maps.Point(a,o)},$.browser.msie&&$.browser.version<9&&r==h&&(c.scaledSize=new google.maps.Size(120,600))),c._ws_={url:r,size:{w:e,h:i},offset:{x:n,y:s},id:__ws_id()},this.iconCache.put(t,c),c},this._iconProperties={building:{w:26,h:36,x:24,y:19},house:{w:28,h:24,x:24,y:55},"center-pin":{w:32,h:43,x:52,y:19}},_.each(["restaurants","coffee","bar","grocery","park","school","shop","entertain","hardware","bank","architecture","books","farmers","pharmacy","post_office"],_(function(t,e){var i=26;this._iconProperties[t]={w:22,h:i,x:0,y:128+i*e},this._iconProperties[t+"-on"]={w:22,h:i,x:22,y:128+i*e}}).bind(this)),_.each(["bus","train"],_(function(t,e){var i=20;this._iconProperties[t]={w:i,h:i,x:83,y:128+2*e*i},this._iconProperties[t+"-on"]={w:i,h:i,x:83,y:128+2*e*i+i}}).bind(this)),_.each(["GDarkGreen","GBrown","GRed","GLightBlue","GOrange","GPurple","GPink","GBlue","GGreen","GYellow"],_(function(t,e){var i=33;this._iconProperties[t]={w:23,h:i,x:44,y:128+e*i}}).bind(this)),this.createIconFromSS=function(t,e){"trails"==t.substr(0,6)&&(t="park"+t.substr(6));var i=this.iconCache.get(t);if(i)return i;var n=this._iconProperties[t.replace(/.png/,"")];if(n){var s=n.ax?n.ax:n.w/2,a=n.ay?n.ay:n.h,o="//cdn2.walk.sc/2/images/tile/sprites11"+(e?"-hd":"")+".png",r=new google.maps.Size(152,518),l={url:o,size:new google.maps.Size(n.w,n.h),scaledSize:r,origin:new google.maps.Point(n.x,n.y),anchor:new google.maps.Point(s,a)};return this.iconCache.put(t,l),l}},this.initTransitIcons=function(){if(!this.transitIconsCreated){var t=isHighRes();busIcon=this.createIconFromSS("bus",t),busIconSel=this.createIconFromSS("bus-on",t),railIcon=this.createIconFromSS("train",t),railIconSel=this.createIconFromSS("train-on",t),this.transitIconsCreated=!0}};var t=function(t,e,i,n,s,a){var o="//cdn2.walk.sc/2/images/icons/"+t+(n||getResModifier())+".png";return{url:o,scaledSize:new google.maps.Size(e,i),anchor:new google.maps.Point(s?s:e/2,a?a:i)}};this.makeTransitIcon=function(e,i,n){var s=n?"selected/":"";return t(s+e,20,20,i,10,10)},this.makeAmenityIcon=function(t){return t?this.createIcon(t,21,25,21*this.offsets[t].x,25*this.offsets[t].y):void 0},this.makeSelectedAmenityIcon=function(t){return t?this.createIcon(t+"sel",21,25,21*(this.offsets[t].x+1),25*this.offsets[t].y):void 0},this.makeAmenityShadowIcon=function(t){return this.createIcon("icon-shadow.png",28,24,42,260,9,24)},this.makeCustomIcon=function(t){return this.createIconFromSS(t,isHighRes())},this.makeClientCustomIcon=function(t,e){get_image_size(t,_(function(i,n){e(i||"none"==t.toLowerCase()?this.createIcon("client-custom",i,n,0,0,void 0,void 0,t):null)}).bind(this))},this.makeHouseIcon=function(t){return this.createIconFromSS("house",t)},this.makeCenterPinIcon=function(t){return this.createIconFromSS("center-pin",t)},this.makeBuildingIcon=function(t){return this.createIconFromSS("building",t)},this.makeBadgeIcon=function(){return this.createIcon("badge-pin.png",49,52,71,260)}}function ws_tileOptions(t,e,i,n){this.defaultHeight=t,this.minHeight=e,this.maxHeight=i,this.footerLines=n}function ws_footerInfo(t,e,i,n,s,a,o){this.footerX=t,this.footerY=e,this.footerX2=i,this.inputX=n,this.inputY=s,this.inputW=a,this.footerLines=o}function ws_rangeObj(t,e){this.minVal=t,this.maxVal=e}function ws_getTileOptions(t,e,i,n){null!=e&&"auto"!=e||(e=ws_getDefaultLayout(t));var s=WS_TILE_H_DEFAULT_HEIGHT,a=WS_TILE_H_MIN_HEIGHT,o=WS_TILE_H_MAX_HEIGHT;"vertical"==e&&(s=WS_TILE_V_MIN_HEIGHT,a=WS_TILE_V_MIN_HEIGHT,o=WS_TILE_V_MAX_HEIGHT);var r=1;return i==WS_TILE_FOOTER_HIDDEN?r=0:WS_TILE_FOOTER_2_LINE_THRESHOLD>t&&(r=2),"horizontal"==e&&1==r&&(a+=10),new ws_tileOptions(s,a,o,r)}function ws_getFooterInfo(t,e,i,n,s){var a=8,o=t-4;"vertical"==e&&(a=3,o=t-3);var r=i-WS_TILE_FOOTER_LINE_HEIGHT,l=s?s+6:170,h=0,c=1;WS_TILE_FOOTER_2_LINE_THRESHOLD>t&&(r-=WS_TILE_FOOTER_LINE_HEIGHT,l=0,h+=WS_TILE_FOOTER_LINE_HEIGHT,c=2);var u=o-a-32-l;return new ws_footerInfo(a,r,o,l,h,u,c)}function ws_getDefaultTileHeight(t,e,i,n){var s=ws_getTileOptions(t,e,i,n);return s.defaultHeight}function ws_getDefaultLayout(t,e){return Number(t)<WS_TILE_LAYOUT_SWITCH_THRESHOLD||Number(t)<=500&&Number(t)<Number(e)?"vertical":"horizontal"}function AmenityMapApp(t,e){this.auth=new WSIDAuth({wsid:ws_auth_wsid,domain:ws_auth_domain}),this.resModifier=getResModifier(),this.highRes=isHighRes();var i=this.parameterManager=new ParameterManager({auth:this.auth});_(ws_paid_parameters).each(function(t){i.add_paid.apply(i,t)}),_(ws_free_parameters).each(function(t){i.add_free.apply(i,t)}),this.auth.if_free(function(){var t=$("#view-full-map > a");t.attr("href",t.attr("href")+"&free=1"),window.bigMapLink+="&free=1"}),i.do_with_one("no_link_info_bubbles",function(t){window.nolink_bubbles=window.removeMoreAmenitiesLink=t}),i.do_with_one("no_head",function(t){window.no_head=t}),i.do_with_one("hide_bigger_map",_(function(t){if(("h"==layout||t&&width>=315||width>=405)&&$("#score-description").addClass("active"),!t&&($("#view-full-map").addClass("active"),$("#above-map").addClass("active"),"h"==layout&&($("#map-frame").addClass("make-room-above"),this.map&&this.map.gmap))){var e="number"==typeof this.map.optionFlags.zoom?this.map.optionFlags.zoom:this.map.DEFAULT_ZOOM;google.maps.event.trigger(this.map.gmap,"resize"),this.map.gmap.goTo(this.geoData.getPreSnapLatLng().ws_coerce("google"),e)}}).bind(this)),this.parameterManager.do_with_some(["amenity_profile","default_view"],_(function(i){this.view=i.default_view.toLowerCase(),this._deferred_init(t,e,i.amenity_profile)}).bind(this))}function TransitModule(t,e,i,n,s){this.app=t,this.amenityManager=e,this.panelManager=i,this.geocoder=n,this.amenityService=s,this.transitScore=null,this.hasContent=!1,this.initialize=function(t,e){this.geoData=t,e&&t.getCity()&&t.getAdminArea()?(appEvents.addListener("transitScoreAvailable",this.onTransitScoreQueryCompleted,this),this.app.request("transitScore",t)):this.onTransitScoreQueryCompleted(null)},this.onTransitScoreQueryCompleted=function(t){this.displayScore(t);var e=new AmenityQuery({service:"Transit-API",name:"Transit",search:["transit"],icon:"bus.png",short_name:"Transit"});this.amenityService.runQuery(e,bindCallback(this,this.onTransitStopsQueryCompleted))},this.onTransitStopsQueryCompleted=function(t){if(t.getResults()){this.amenityManager.setTransitMode(AmenityManager.TRANSIT_MODE_CLOSEST),this.amenityManager.makeAmenitiesFromRawResults(t);var e=this.amenityManager.getRoutePackage([{types:["rail","bus","other"],num:8}]);this.addContent(e,this.amenityManager.areMoreTransitResultsThanFeatured()),this.app.showAmenityMarkers("Transit",this.amenityManager.getFeaturedTransitResults())}else this.panelManager.cancelReservation("pub-transit")},this.displayScore=function(t){if(t&&t.transit_score){this.transitScore=t.transit_score,this.boxScoreHtml="<h3 class='tscore'>"+this.transitScore+"</h3>";var e=this.panelManager.getItemHtml("pub-transit",{pt1:"Transit Score:&reg;",pt1Extra:this.boxScoreHtml,extraClass:"final noclick highlight"});this.panelManager.confirmReservation("pub-transit",e)}},this.addContent=function(t,e){if(!this.hasContent)if(this.featRoutes=t,this.hasContent=!0,t.length>0){var i=t[0],n=i.getName();leadsWithNumber(n)&&(n="#"+n),"bus"==i.category&&(n+=" bus"),"rail"==i.category&&(n+=" train");var s=null!==this.transitScore?"Transit Score<sup>&reg;</sup>:":"h"==layout?"Public Transit:":"Transit:",a=this.panelManager.getItemHtml("pub-transit",{pt1:s,pt1Extra:this.boxScoreHtml,pt2:n,pt4:this.panelManager.formatDistance(i.nearestStop.getDist()),extraClass:"highlight"}),o=_(function(){$("#pub-transit").click(_(function(){this.panelManager.showTransit(this.featRoutes,0,"Walk Score",this.transitScore)}).bind(this))}).bind(this);this.panelManager.confirmReservation("pub-transit",a,o)}else this.panelManager.cancelReservation("pub-transit")},this.getTransitDataUrl=function(){var t=""!=this.geoData.getQuery()?this.geoData.getQuery():this.geoData.getLat()+","+this.geoData.getLng();return"http://www.citygoround.org/apps/walk-score/location/?q="+encodeURIComponent(t)},this.addRoute=function(t){var e=t.getNearestStop(),i=this.geoData.getUnits(),n=convertMetersForDisplay(e.getDist(),i,!0,2,!0,!0),s="route-"+t.getId(),a='<div id="'+s+'" class="'+t.getCategory()+'">';a+="<span>"+n+" -&nbsp;</span><label>"+t.getName()+"</label>",a+="</div>",$("#transit--route-list").append(a);var o=this.app;$("#transit--route-list").children("#"+s).click(function(){o.selectAmenity(e),trackEvent("overview","transit route click")})}}function Reservations(){this.list={},this.reserve=function(t,e){this.list[t]=e?Reservations.CONFIRMED:Reservations.HOLD},this.confirm=function(t){this.list[t]=Reservations.CONFIRMED},this.cancel=function(t){delete this.list[t]},this.numReservations=function(){return _(this.list).size()},this.numHolds=function(){return _.select(this.list,function(t){return t==Reservations.HOLD}).length},this.numConfirmed=function(){return _.select(this.list,function(t){return t==Reservations.CONFIRMED}).length},this.isConfirmed=function(t){return this.list[t]&&this.list[t]==Reservations.CONFIRMED}}function AmenityPanel(t,e,i){this.initAmenityPanelBase({panelManager:t,category:e,expanded:!1,geoData:i}),this.setIndex=0,this.amenityIndex=0}function SearchNearbyEntry(t){this.panelManager=t,this.panelId="nearby-entry",this.category="Search Nearby"}function ScrollPanel(){var t=$(".scrollable").scrollable({speed:220,touch:!1});this.api=t.data("scrollable"),this.backFuncs=_(_(32).range()).map(function(){return[]}),this.callbacks=[],this.api.onBeforeSeek(_(function(){this.active=!0}).bind(this)),this.api.onSeek(_(function(){this.active=!1,_(this.callbacks).each(function(t){t&&_(t).delay(20)}),this.callbacks=[]}).bind(this)),this.goForward=function(t,e,i){this.active||(this.callbacks=[e],this.backFuncs[this.api.getIndex()].unshift(i),this.backFuncs[this.api.getIndex()+1]=[e],this.api.getIndex()==this.api.getSize()-1&&this.api.addItem("<div></div>"),t&&this.api.getItems().eq(this.api.getIndex()+1).empty().append($("<div />").append(t)),this.api.next())},this.goBack=function(){this.active||(this.callbacks=this.backFuncs[this.api.getIndex()-1],this.backFuncs[this.api.getIndex()-1]=[],this.api.prev())},this.currentCardIndex=function(){return this.api.getIndex()}}function canSupportStreetView(t,e,i){return-1!=navigator.appVersion.indexOf("X11")?!1:"h"==e?i>=257:t>=250}function showMessage(t,e){e&&$("#error-title").attr("src",e).css("display","block");var i=$("#dialog");i.length>0&&(i.css("display","block"),$("#message").html(t),$("#dialog-button").focus())}function hideMessage(){$("#dialog").hide()}function IconPool(){}function NearbyManager(t){this.app=t,this.amenityService=t.walkScoreCore.amenityService,this.init()}!function(t){function e(e,i){var n=t(i);return n.length<2?n:e.parent().find(i)}function i(i,s){var a=this,o=i.add(a),r=i.children(),l=0,h=s.vertical;if(n||(n=a),r.length>1&&(r=t(s.items,i)),t.extend(a,{getConf:function(){return s},getIndex:function(){return l},getSize:function(){return a.getItems().size()},getNaviButtons:function(){return p.add(d)},getRoot:function(){return i},getItemWrap:function(){return r},getItems:function(){return r.children(s.item).not("."+s.clonedClass)},move:function(t,e){return a.seekTo(l+t,e)},next:function(t){return a.move(1,t)},prev:function(t){return a.move(-1,t)},begin:function(t){return a.seekTo(0,t)},end:function(t){return a.seekTo(a.getSize()-1,t)},focus:function(){return n=a},addItem:function(e){return e=t(e),s.circular?(r.children("."+s.clonedClass+":last").before(e),r.children("."+s.clonedClass+":first").replaceWith(e.clone().addClass(s.clonedClass))):r.append(e),o.trigger("onAddItem",[e]),a},seekTo:function(e,i,c){if(e.jquery||(e*=1),s.circular&&0===e&&-1==l&&0!==i)return a;if(!s.circular&&0>e||e>a.getSize()||-1>e)return a;var u=e;e.jquery?e=a.getItems().index(e):u=a.getItems().eq(e);var p=t.Event("onBeforeSeek");return c||(o.trigger(p,[e,i]),!p.isDefaultPrevented()&&u.length)?(u=h?{top:-u.position().top}:{left:-u.position().left},l=e,n=a,void 0===i&&(i=s.speed),r.animate(u,i,s.easing,c||function(){o.trigger("onSeek",[e])}),a):a}}),t.each(["onBeforeSeek","onSeek","onAddItem"],function(e,i){t.isFunction(s[i])&&t(a).bind(i,s[i]),a[i]=function(e){return e&&t(a).bind(i,e),a}}),s.circular){var c=a.getItems().slice(-1).clone().prependTo(r),u=a.getItems().eq(1).clone().appendTo(r);c.add(u).addClass(s.clonedClass),a.onBeforeSeek(function(t,e,i){if(!t.isDefaultPrevented()){if(-1==e)return a.seekTo(c,i,function(){a.end(0)}),t.preventDefault();e==a.getSize()&&a.seekTo(u,i,function(){a.begin(0)})}}),a.seekTo(0,0,function(){})}var p=e(i,s.prev).click(function(){a.prev()}),d=e(i,s.next).click(function(){a.next()});if(!s.circular&&a.getSize()>1&&(a.onBeforeSeek(function(t,e){setTimeout(function(){t.isDefaultPrevented()||(p.toggleClass(s.disabledClass,0>=e),d.toggleClass(s.disabledClass,e>=a.getSize()-1))},1)}),s.initialIndex||p.addClass(s.disabledClass)),s.mousewheel&&t.fn.mousewheel&&i.mousewheel(function(t,e){return s.mousewheel?(a.move(0>e?1:-1,s.wheelSpeed||50),!1):void 0}),s.touch){var m={};r[0].ontouchstart=function(t){t=t.touches[0],m.x=t.clientX,m.y=t.clientY},r[0].ontouchmove=function(t){if(1==t.touches.length&&!r.is(":animated")){var e=t.touches[0],i=m.x-e.clientX;e=m.y-e.clientY,a[h&&e>0||!h&&i>0?"next":"prev"](),t.preventDefault()}}}s.keyboard&&t(document).bind("keydown.scrollable",function(e){if(s.keyboard&&!e.altKey&&!e.ctrlKey&&!t(e.target).is(":input")&&("static"==s.keyboard||n==a)){var i=e.keyCode;if(h&&(38==i||40==i))return a.move(38==i?-1:1),e.preventDefault();if(!h&&(37==i||39==i))return a.move(37==i?-1:1),e.preventDefault()}}),s.initialIndex&&a.seekTo(s.initialIndex,0,function(){})}t.tools=t.tools||{version:"1.2.5"},t.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:null,items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",speed:400,vertical:!1,touch:!0,wheelSpeed:0}};var n;t.fn.scrollable=function(e){var n=this.data("scrollable");return n?n:(e=t.extend({},t.tools.scrollable.conf,e),this.each(function(){n=new i(t(this),e),t(this).data("scrollable",n)}),e.api?n:this)}}(jQuery),function(t){function e(e,i,n){var s=n.relative?e.position().top:e.offset().top,a=n.relative?e.position().left:e.offset().left,o=n.position[0];s-=i.outerHeight()-n.offset[0],a+=e.outerWidth()+n.offset[1],/iPad/i.test(navigator.userAgent)&&(s-=t(window).scrollTop());var r=i.outerHeight()+e.outerHeight();return"center"==o&&(s+=r/2),"bottom"==o&&(s+=r),o=n.position[1],e=i.outerWidth()+e.outerWidth(),"center"==o&&(a-=e/2),"left"==o&&(a-=e),{top:s,left:a}}function i(i,s){var a,o,r=this,l=i.add(r),h=0,c=0,u=i.attr("title"),p=i.attr("data-tooltip"),d=n[s.effect],m=i.is(":input"),g=m&&i.is(":checkbox, :radio, select, :button, :submit"),f=i.attr("type"),y=s.events[f]||s.events[m?g?"widget":"input":"def"];if(!d)throw'Nonexistent effect "'+s.effect+'"';if(y=y.split(/,\s*/),2!=y.length)throw"Tooltip: bad events configuration for "+f;i.bind(y[0],function(t){clearTimeout(h),s.predelay?c=setTimeout(function(){r.show(t)},s.predelay):r.show(t)}).bind(y[1],function(t){clearTimeout(c),s.delay?h=setTimeout(function(){r.hide(t)},s.delay):r.hide(t)}),u&&s.cancelDefault&&(i.removeAttr("title"),
i.data("title",u)),t.extend(r,{show:function(n){if(!a&&(p?a=t(p):s.tip?a=t(s.tip).eq(0):u?a=t(s.layout).addClass(s.tipClass).appendTo(document.body).hide().append(u):(a=i.next(),a.length||(a=i.parent().next())),!a.length))throw"Cannot find tooltip for "+i;if(r.isShown())return r;a.stop(!0,!0);var m=e(i,a,s);return s.tip&&a.html(i.data("title")),n=n||t.Event(),n.type="onBeforeShow",l.trigger(n,[m]),n.isDefaultPrevented()?r:(m=e(i,a,s),a.css({position:"absolute",top:m.top,left:m.left}),o=!0,d[0].call(r,function(){n.type="onShow",o="full",l.trigger(n)}),m=s.events.tooltip.split(/,\s*/),a.data("__set")||(a.bind(m[0],function(){clearTimeout(h),clearTimeout(c)}),m[1]&&!i.is("input:not(:checkbox, :radio), textarea")&&a.bind(m[1],function(t){t.relatedTarget!=i[0]&&i.trigger(y[1].split(" ")[0])}),a.data("__set",!0)),r)},hide:function(e){return a&&r.isShown()?(e=e||t.Event(),e.type="onBeforeHide",l.trigger(e),e.isDefaultPrevented()?void 0:(o=!1,n[s.effect][1].call(r,function(){e.type="onHide",l.trigger(e)}),r)):r},isShown:function(t){return t?"full"==o:o},getConf:function(){return s},getTip:function(){return a},getTrigger:function(){return i}}),t.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(e,i){t.isFunction(s[i])&&t(r).bind(i,s[i]),r[i]=function(e){return e&&t(r).bind(i,e),r}})}t.tools=t.tools||{version:"1.2.5"},t.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(t,e,i){n[t]=[e,i]}};var n={toggle:[function(t){var e=this.getConf(),i=this.getTip();e=e.opacity,1>e&&i.css({opacity:e}),i.show(),t.call()},function(t){this.getTip().hide(),t.call()}],fade:[function(t){var e=this.getConf();this.getTip().fadeTo(e.fadeInSpeed,e.opacity,t)},function(t){this.getTip().fadeOut(this.getConf().fadeOutSpeed,t)}]};t.fn.tooltip=function(e){var n=this.data("tooltip");return n?n:(e=t.extend(!0,{},t.tools.tooltip.conf,e),"string"==typeof e.position&&(e.position=e.position.split(/,?\s/)),this.each(function(){n=new i(t(this),e),t(this).data("tooltip",n)}),e.api?n:this)}}(jQuery),function(t){var e=t.tools.tooltip;t.extend(e.conf,{direction:"up",bounce:!1,slideOffset:10,slideInSpeed:200,slideOutSpeed:200,slideFade:!t.browser.msie});var i={up:["-","top"],down:["+","top"],left:["-","left"],right:["+","left"]};e.addEffect("slide",function(t){var e=this.getConf(),n=this.getTip(),s=e.slideFade?{opacity:e.opacity}:{},a=i[e.direction]||i.up;s[a[1]]=a[0]+"="+e.slideOffset,e.slideFade&&n.css({opacity:0}),n.show().animate(s,e.slideInSpeed,t)},function(e){var n=this.getConf(),s=n.slideOffset,a=n.slideFade?{opacity:0}:{},o=i[n.direction]||i.up,r=""+o[0];n.bounce&&(r="+"==r?"-":"+"),a[o[1]]=r+"="+s,this.getTip().animate(a,n.slideOutSpeed,function(){t(this).hide(),e.call()})})}(jQuery),function(t){function e(e){var i=t(window),n=i.width()+i.scrollLeft(),s=i.height()+i.scrollTop();return[e.offset().top<=i.scrollTop(),n<=e.offset().left+e.width(),s<=e.offset().top+e.height(),i.scrollLeft()>=e.offset().left]}function i(t){for(var e=t.length;e--;)if(t[e])return!1;return!0}var n=t.tools.tooltip;n.dynamic={conf:{classNames:"top right bottom left"}},t.fn.dynamic=function(s){"number"==typeof s&&(s={speed:s}),s=t.extend({},n.dynamic.conf,s);var a,o=s.classNames.split(/\s/);return this.each(function(){var n=t(this).tooltip().onBeforeShow(function(n,r){n=this.getTip();var l=this.getConf();a||(a=[l.position[0],l.position[1],l.offset[0],l.offset[1],t.extend({},l)]),t.extend(l,a[4]),l.position=[a[0],a[1]],l.offset=[a[2],a[3]],n.css({visibility:"hidden",position:"absolute",top:r.top,left:r.left}).show(),r=e(n),i(r)||(r[2]&&(t.extend(l,s.top),l.position[0]="top",n.addClass(o[0])),r[3]&&(t.extend(l,s.right),l.position[1]="right",n.addClass(o[1])),r[0]&&(t.extend(l,s.bottom),l.position[0]="bottom",n.addClass(o[2])),r[1]&&(t.extend(l,s.left),l.position[1]="left",n.addClass(o[3])),(r[0]||r[2])&&(l.offset[0]*=-1),(r[1]||r[3])&&(l.offset[1]*=-1)),n.css({visibility:"visible"}).hide()});n.onBeforeShow(function(){var t=this.getConf();this.getTip(),setTimeout(function(){t.position=[a[0],a[1]],t.offset=[a[2],a[3]]},0)}),n.onHide(function(){var t=this.getTip();t.removeClass(s.classNames)}),ret=n}),s.api?ret:this}}(jQuery),window.Modernizr=function(t,e,i){function n(t){d.cssText=t}function s(t,e){return typeof t===e}function a(){h.input=function(i){for(var n=0,s=i.length;s>n;n++)_[i[n]]=!!(i[n]in m);return _.list&&(_.list=!(!e.createElement("datalist")||!t.HTMLDataListElement)),_}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" "))}var o,r,l="2.6.2",h={},c=e.documentElement,u="modernizr",p=e.createElement(u),d=p.style,m=e.createElement("input"),g=({}.toString,"Webkit Moz O ms"),f=g.split(" "),y=g.toLowerCase().split(" "),v={},_={},w=[],b=w.slice,C={}.hasOwnProperty;r=s(C,"undefined")||s(C.call,"undefined")?function(t,e){return e in t&&s(t.constructor.prototype[e],"undefined")}:function(t,e){return C.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var i=b.call(arguments,1),n=function(){if(this instanceof n){var s=function(){};s.prototype=e.prototype;var a=new s,o=e.apply(a,i.concat(b.call(arguments)));return Object(o)===o?o:a}return e.apply(t,i.concat(b.call(arguments)))};return n}),v.canvas=function(){var t=e.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},v.canvastext=function(){return!(!h.canvas||!s(e.createElement("canvas").getContext("2d").fillText,"function"))},v.geolocation=function(){return"geolocation"in navigator},v.websockets=function(){return"WebSocket"in t||"MozWebSocket"in t},v.localstorage=function(){try{return localStorage.setItem(u,u),localStorage.removeItem(u),!0}catch(t){return!1}},v.webworkers=function(){return!!t.Worker};for(var k in v)r(v,k)&&(o=k.toLowerCase(),h[o]=v[k](),w.push((h[o]?"":"no-")+o));return h.input||a(),h.addTest=function(t,e){if("object"==typeof t)for(var n in t)r(t,n)&&h.addTest(n,t[n]);else{if(t=t.toLowerCase(),h[t]!==i)return h;e="function"==typeof e?e():e,"undefined"!=typeof enableClasses&&enableClasses&&(c.className+=" "+(e?"":"no-")+t),h[t]=e}return h},n(""),p=m=null,h._version=l,h._domPrefixes=y,h._cssomPrefixes=f,h}(this,this.document),function(t,e,i){function n(t){return"[object Function]"==f.call(t)}function s(t){return"string"==typeof t}function a(){}function o(t){return!t||"loaded"==t||"complete"==t||"uninitialized"==t}function r(){var t=y.shift();v=1,t?t.t?m(function(){("c"==t.t?p.injectCss:p.injectJs)(t.s,0,t.a,t.x,t.e,1)},0):(t(),r()):v=0}function l(t,i,n,s,a,l,h){function c(e){if(!d&&o(u.readyState)&&(_.r=d=1,!v&&r(),u.onload=u.onreadystatechange=null,e)){"img"!=t&&m(function(){b.removeChild(u)},50);for(var n in I[i])I[i].hasOwnProperty(n)&&I[i][n].onload()}}var h=h||p.errorTimeout,u=e.createElement(t),d=0,f=0,_={t:n,s:i,e:a,a:l,x:h};1===I[i]&&(f=1,I[i]=[]),"object"==t?u.data=i:(u.src=i,u.type=t),u.width=u.height="0",u.onerror=u.onload=u.onreadystatechange=function(){c.call(this,f)},y.splice(s,0,_),"img"!=t&&(f||2===I[i]?(b.insertBefore(u,w?null:g),m(c,h)):I[i].push(u))}function h(t,e,i,n,a){return v=0,e=e||"j",s(t)?l("c"==e?k:C,t,e,this.i++,i,n,a):(y.splice(this.i++,0,t),1==y.length&&r()),this}function c(){var t=p;return t.loader={load:h,i:0},t}var u,p,d=e.documentElement,m=t.setTimeout,g=e.getElementsByTagName("script")[0],f={}.toString,y=[],v=0,_="MozAppearance"in d.style,w=_&&!!e.createRange().compareNode,b=w?d:g.parentNode,d=t.opera&&"[object Opera]"==f.call(t.opera),d=!!e.attachEvent&&!d,C=_?"object":d?"script":"img",k=d?"script":C,S=Array.isArray||function(t){return"[object Array]"==f.call(t)},M=[],I={},A={timeout:function(t,e){return e.length&&(t.timeout=e[0]),t}};p=function(t){function e(t){var e,i,n,t=t.split("!"),s=M.length,a=t.pop(),o=t.length,a={url:a,origUrl:a,prefixes:t};for(i=0;o>i;i++)n=t[i].split("="),(e=A[n.shift()])&&(a=e(a,n));for(i=0;s>i;i++)a=M[i](a);return a}function o(t,s,a,o,r){var l=e(t),h=l.autoCallback;l.url.split(".").pop().split("?").shift(),l.bypass||(s&&(s=n(s)?s:s[t]||s[o]||s[t.split("/").pop().split("?")[0]]),l.instead?l.instead(t,s,a,o,r):(I[l.url]?l.noexec=!0:I[l.url]=1,a.load(l.url,l.forceCSS||!l.forceJS&&"css"==l.url.split(".").pop().split("?").shift()?"c":i,l.noexec,l.attrs,l.timeout),(n(s)||n(h))&&a.load(function(){c(),s&&s(l.origUrl,r,o),h&&h(l.origUrl,r,o),I[l.url]=2})))}function r(t,e){function i(t,i){if(t){if(s(t))i||(u=function(){var t=[].slice.call(arguments);p.apply(this,t),d()}),o(t,u,e,0,h);else if(Object(t)===t)for(l in r=function(){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i}(),t)t.hasOwnProperty(l)&&(!i&&!--r&&(n(u)?u=function(){var t=[].slice.call(arguments);p.apply(this,t),d()}:u[l]=function(t){return function(){var e=[].slice.call(arguments);t&&t.apply(this,e),d()}}(p[l])),o(t[l],u,e,l,h))}else!i&&d()}var r,l,h=!!t.test,c=t.load||t.both,u=t.callback||a,p=u,d=t.complete||a;i(h?t.yep:t.nope,!!c),c&&i(c)}var l,h,u=this.yepnope.loader;if(s(t))o(t,0,u,0);else if(S(t))for(l=0;l<t.length;l++)h=t[l],s(h)?o(h,0,u,0):S(h)?p(h):Object(h)===h&&r(h,u);else Object(t)===t&&r(t,u)},p.addPrefix=function(t,e){A[t]=e},p.addFilter=function(t){M.push(t)},p.errorTimeout=1e4,null==e.readyState&&e.addEventListener&&(e.readyState="loading",e.addEventListener("DOMContentLoaded",u=function(){e.removeEventListener("DOMContentLoaded",u,0),e.readyState="complete"},0)),t.yepnope=c(),t.yepnope.executeStack=r,t.yepnope.injectJs=function(t,i,n,s,l,h){var c,u,d=e.createElement("script"),s=s||p.errorTimeout;d.src=t;for(u in n)d.setAttribute(u,n[u]);i=h?r:i||a,d.onreadystatechange=d.onload=function(){!c&&o(d.readyState)&&(c=1,i(),d.onload=d.onreadystatechange=null)},m(function(){c||(c=1,i(1))},s),l?d.onload():g.parentNode.insertBefore(d,g)},t.yepnope.injectCss=function(t,i,n,s,o,l){var h,s=e.createElement("link"),i=l?r:i||a;s.href=t,s.rel="stylesheet",s.type="text/css";for(h in n)s.setAttribute(h,n[h]);o||(g.parentNode.insertBefore(s,g),m(i,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},!function(){var t=0,e=function(){"use strict";if(!(window.wsProfiler||t++>100)){var i=250,n=(window.performance||{}).timing,s=n?n.loadEventEnd-n.responseStart:-1,a=n?n.responseStart-n.requestStart:-1;if(n){if(!n.loadEventEnd)return setTimeout(e,250);var o={t:s,T:a,c:window.ACTIVE_COMPONENT||"unknown"};if($.ajax({url:"/auth/p/log",data:o}),s>0&&3e4>s){for(s=""+Math.ceil(s/i)*i;s.length<4;)s="0"+s;window.trackEventNonInteractive&&trackEventNonInteractive(ACTIVE_COMPONENT,"PROF load",s)}window.wsProfiler={data:o,click:function(){},link:function(){},samp:function(){},event:function(){}}}}};e()}();var idol_wither=function(t){t.prototype.ws_with=function(t,e){this._ws_&&this._ws_.idol&&this._ws_.idol.ws_with?this._ws_.idol.ws_with(t,e):e(this)},t.prototype.ws_coerce=function(t,e){return this._ws_&&this._ws_.idol&&this._ws_.idol.ws_coerce?this._ws_.idol.ws_coerce(t):this}};!function(){var t="once";ensureWSUnderscoreMixins(),window.ensure_ws_v3_extensions=_(_(function(){if(!(window.google&&google.maps&&google.maps.Map))return t+=".",void _(ensure_ws_v3_extensions).delay(100);ensure_ws(),google.maps.Map.prototype.computeSVAngle=function(t,e){var i=57.2957795,n=.017453,s=t.lat()-e.lat(),a=t.lng()-e.lng(),o=Math.atan2(a*Math.cos(t.lat()*n),s)*i;return this.wrapAngle(o)},google.maps.Map.prototype.wrapAngle=function(t){return t>=360?t-=360:0>t&&(t+=360),t},google.maps.Map.prototype.showAds=showAdsOnMap,google.maps.Map.prototype.customLatlngToPoint=function(t){var e=this.getProjection().fromLatLngToPoint(t),i=Math.pow(2,this.getZoom()),n=new google.maps.Point(e.x*i,e.y*i);return n},google.maps.Map.prototype.customPointToLatlng=function(t){var e=Math.pow(2,this.getZoom()),i=new google.maps.Point(t.x/e,t.y/e),n=this.getProjection().fromPointToLatLng(i);return n},google.maps.Map.prototype.customLatLngToPixel=function(t){var e=Math.pow(2,this.getZoom()),i=new google.maps.LatLng(this.getBounds().getNorthEast().lat(),this.getBounds().getSouthWest().lng()),n=this.getProjection().fromLatLngToPoint(i),s=this.getProjection().fromLatLngToPoint(t),a=new google.maps.Point(Math.floor((s.x-n.x)*e),Math.floor((s.y-n.y)*e));return a},google.maps.Map.prototype.setCenterWhenVisible=function(t,e){if(this.getBounds())this.setCenter(t);else{this.setCenter(t);var i=google.maps.event.addListener(this,"bounds_changed",_(function(n){$(this.getDiv()).width()>0&&this.getBounds()&&"block"==e.css("display")&&(this.setCenter(t),google.maps.event.removeListener(i))}).bind(this))}},google.maps.Map.prototype.customPanTo=function(t,e,i){var n=(this._ws_||{}).svPano;if(n&&n.getVisible())this._ws_.svService.getPanoramaByLocation(t,50,function(e,i){if(e){var s=e.location.latLng;google.maps.event.addListener(n,"position_changed",function(){n.setPov({heading:google.maps.Map.prototype.computeSVAngle(t,s),zoom:1,pitch:0})}),n.setPosition(s)}});else if(this.getProjection()){var s=this.customLatlngToPoint(t),a=new google.maps.Point(s.x,s.y-40),o=this.customPointToLatlng(a);this.panTo(o)}else t.ws_coerce&&(t=t.ws_coerce("google")),this.panTo(t)},google.maps.Map.prototype.goTo=function(t,e){this.setCenter(t),_(e).isUndefined()||this.setZoom(e)},google.maps.Map.prototype.addOverlay=function(t){t.ws_with("google",_(function(t){t.setMap(this),_(t.zIndexGroup).isUndefined()&&t.setZIndexGroup&&t.setZIndexGroup(0)}).bind(this))},google.maps.Marker.prototype.setZIndexGroup=function(){var t=1024,e=[];return function(i){if(this._ws_){if(_(this.zIndexGroup).isUndefined()||delete e[this.zIndexGroup][this._ws_.id],this.zIndexGroup=i,$.browser.msie)return this.setZIndex(this.zIndexGroup);e[i]||(e[i]={}),e[i][this._ws_.id]=this;var n=0;_(e[i]).chain().values().sortBy(function(t){return-1*t.position.lat()}).each(function(e){e.setZIndex(i*t+n++)})}}}(),function(){var t=google.maps.Marker.prototype.setVisible;google.maps.Marker.prototype.setVisible=function(e){return this._ws_&&this._ws_.idol&&(this._ws_.idol.visible=e),t.call(this,e),this}}(),google.maps.Map.prototype.removeOverlay=function(t){t.ws_with("google",function(t){t.setMap(null)})},google.maps.Map.prototype.addTransitLayer=function(){};var e=function(){return rad=function(t){return t*Math.PI/180},function(t,e){var i=6371,n=rad(e.lat()-t.lat()),s=rad(e.lng()-t.lng()),a=Math.sin(n/2)*Math.sin(n/2)+Math.cos(rad(t.lat()))*Math.cos(rad(e.lat()))*Math.sin(s/2)*Math.sin(s/2),o=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),r=i*o;return r.toFixed(3)}}();google.maps.LatLng.prototype.distanceFrom=function(t){return 1e3*e(this,t)};var i=function(){return function(t,e){if(e)return t>=100?[(t/1e3).toFixed(1),"km"]:[t.toFixed(),"m"];var i=3.28084*t;return i>=528?[(i/5280).toFixed(1),"mi"]:[i.toFixed(),"ft"]}}();return google.maps.LatLng.prototype.distanceFromString=function(t,e){var n=this.distanceFrom(t),s=i(n,e);return s.join(" ")},google.maps.Polyline.prototype.getBounds=function(){return _(this.getPath().getArray()).reduce(function(t,e){return t.extend(e)},new google.maps.LatLngBounds)},google.maps.Polyline.prototype.contains=function(t){for(var e=0,i=!1,n=t.lng(),s=t.lat(),a=this.getPath().getArray(),o=a.length,r=0;o>r;r++){e++,e==o&&(e=0);var l=a[r].lat(),h=a[r].lng(),c=a[e].lat();(s>l&&c>=s||s>c&&l>=s)&&h+(s-l)/(c-l)*(a[e].lng()-h)<n&&(i=!i)}return i},window.MiniWindow=function(){function t(t){if(!t||!t.idol)throw new Error("Need idol in MiniWindow init");this._ws_={idol:t.idol},this.setOptions(t)}var e=t.prototype=new google.maps.OverlayView;return _(["setOptions","setPosition","setOffset","addClass","removeClass","makeDiv","setContent"]).each(function(t){e[t]=function(){var e=this._ws_.idol;return e[t].apply(e,arguments)}}),e.open=function(t,e,i){if(i=i||{},this.onClose=i.onClose,google.maps.event.addListenerOnce(t,"click",_(this.close).bind(this)),e){var n=_(e).spelunk(["icon","anchor","y"]);n?this.setOffset(0,-_(e).spelunk(["icon","anchor","y"])||0):this.setOffset(-1,_(e).spelunk(["anchorPoint","y"])||0),this.setPosition(e.position)}this.setMap(t)},e.close=function(){this.setMap(null),this.onClose&&this.onClose()},e.onAdd=function(){this.getPanes().floatPane.appendChild(this.makeDiv()[0])},e.draw=function(){var t=this._ws_.idol,e=$(t.div),i=this.getProjection().fromLatLngToDivPixel(t.position),n=t.offset_x||0,s=t.offset_y||0;e.css("left",i.x-e.width()/2+n).css("top",i.y-(e.height()-2)+s)},e.onRemove=function(){var t=this._ws_.idol;$(t.div).remove(),t.div=null},t}(),_([google.maps.LatLng,google.maps.Marker,google.maps.Polyline,MiniWindow]).each(function(t){idol_wither(t)}),window.MarkerLabel=function(){function t(t,e){this.setValues(t);var i=this.div_=document.createElement("div");if(this.opts=e||{},this.opts.url&&this.opts.iconUrl){this.isPhotoMarker=!0;var n=this.span_=document.createElement("span");n.style.cssText="position: absolute; left: -2px; top: -2px;",this.setHighlight(!1)}else{var n=this.span_=document.createElement("span");n.style.cssText="position: absolute; left: -24px; padding: 0; top: -41px; width: 47px; text-align: center; white-space: nowrap; color: rgb(255, 255, 255); padding: 0px; font-family: Arial; font-weight: bold; font-size: 24px; display: block; text-shadow: 2px 2px 0 rgba(30, 30, 30, 0.3);"}i.appendChild(n),i.style.cssText="position: absolute; display: none"}var e=t.prototype=new google.maps.OverlayView;return e.setHighlight=function(t){t&&this.opts.iconUrlSel?this.set("text",'<img class="feat-place-pin-photo" src='+this.opts.url+' width="50" height="50" /><img class="feat-place-pin-icon" src='+this.opts.iconUrlSel+' width="22" height="21" />'):this.set("text",'<img class="feat-place-pin-photo" src='+this.opts.url+' width="50" height="50" /><img class="feat-place-pin-icon" src='+this.opts.iconUrl+' width="22" height="21" />')},e.onAdd=function(){var t=this.getPanes().overlayImage;t.appendChild(this.div_);var e=this;this.listeners_=[google.maps.event.addListener(this,"position_changed",function(){e.draw()}),google.maps.event.addListener(this,"text_changed",function(){e.draw()}),google.maps.event.addListener(this,"zindex_changed",function(){e.draw()})]},e.onRemove=function(){this.div_.parentNode.removeChild(this.div_);for(var t=0,e=this.listeners_.length;e>t;++t)google.maps.event.removeListener(this.listeners_[t])},e.updateZIndexing=function(t,e){!t&&e?this.setMarker(e):this.set("zIndex",3e3)},e.setMarker=function(t){this.parentMarker=t},e.draw=function(){var t=this.getProjection(),e=t.fromLatLngToDivPixel(this.get("position")),i=this.div_;if(i.style.left=e.x+"px",i.style.top=e.y+"px",i.style.display="block",this.parentMarker){var n=2;this.parentMarker.getZIndex&&"undefined"!=typeof this.parentMarker.getZIndex()?i.style.zIndex=this.parentMarker.getZIndex()+n:i.style.zIndex=parseInt(i.style.top,10)+n}else i.style.zIndex=this.get("zIndex");this.span_.innerHTML=this.get("text").toString()},t}(),window.SimpleStreetview=function(t,e){if(e=e||{},ensure_ws_v3_extensions(),this.streetViewService=new google.maps.StreetViewService,0!=$("#"+t).length){if(ensure_ws_v3_extensions(),this.streetViewService=new google.maps.StreetViewService,!bootstrapIsPhone()){var i={scrollwheel:!1,panControl:!1,zoomControl:!1};this.panorama=new google.maps.StreetViewPanorama(document.getElementById(t),i),this.panorama.set("addressControl",!1)}this.updateStatic=function(e,i){e&&(this.latLng=e),i&&(this.panoLatLng=i);var n=google.maps.Map.prototype.computeSVAngle(this.latLng,this.panoLatLng),s=$("#"+t),a=s.width()+"x"+s.height(),o=this.latLng.lat()+","+this.latLng.lng();s.html("<img src='http://maps.googleapis.com/maps/api/streetview?size="+a+"&location="+o+"&fov=90&heading="+n+"&pitch=10&sensor=false' />")},this.orient=function(){if(this.seekingNewTarget&&(this.seekingNewTarget=!1,this.svTarget)){var t=this.panorama.getPosition(),e=google.maps.Map.prototype.computeSVAngle(this.svTarget,t);this.panorama.setPov({heading:e,zoom:1,pitch:0})}},this.panorama?google.maps.event.addListener(this.panorama,"position_changed",_(this.orient).bind(this)):$(window).resize(_(_(function(){this.updateStatic()}).bind(this)).debounce(250)),this.streetViewServiceCallback=_(function(t,i){if(i==google.maps.StreetViewStatus.OK){this.seekingNewTarget=!0,e.controlSelector&&$(e.controlSelector).removeClass("disabled"),this.show();var n=t.location.pano;this.panorama?n!=this.lastPanoID?this.panorama.setPano(n):this.orient():this.updateStatic(this.svTarget,t.location.latLng),this.lastPanoID=n,e.onAvailable&&e.onAvailable()}else e.controlSelector&&$(e.controlSelector).addClass("disabled"),e.onUnavailable&&e.onUnavailable.call(this);e.onUpdateComplete&&e.onUpdateComplete()}).bind(this),this.update=function(t){this.svTarget=t,_(_(function(){this.streetViewService.getPanoramaByLocation(this.svTarget,50,this.streetViewServiceCallback)}).bind(this)).delay(e.delay||0)},this.show=function(){this.panorama&&this.panorama.setVisible(!0)},this.hide=function(){this.panorama&&this.panorama.setVisible(!1),e.placeholder&&$("#"+t).css("background","url("+e.placeholder+") center center no-repeat")}}},!0}).max_attempts(100)).memoize(function(){return t}),window.google&&google.setOnLoadCallback&&google.setOnLoadCallback(ensure_ws_v3_extensions)}();var __ws_id=function(){var t=0;return function(){return t++}}();Result.prototype.getName=function(){return this.name},Result.prototype.getDist=function(){return this.displayDist},Result.prototype.getPoint=function(){return this.point},Result.prototype.getCategory=function(){return this.displayQuery.name},Result.prototype.getOriginCategory=function(){return this.category},Result.prototype.getDataSource=function(){return this.dataSource},Result.prototype.isRemoved=function(){return this.removed},Result.prototype.markAsRemoved=function(){this.removed=!0},Result.prototype.markAsRestored=function(){this.removed=!1},Result.prototype.setMarkerShown=function(t){this.markerShown=t},Result.prototype.isMarkerShown=function(){return this.markerShown},Result.prototype.getKey=function(){return this.key||(this.key=generateAmenityKey(this.name,this.point,this.dataSource)),this.key},Result.prototype.getHighResKey=function(){return this._hiResKey||(this._hiResKey=generateAmenityKey(this.name,this.point,this.dataSource,!0)),this._hiResKey},Result.prototype.getUniqueId=function(){if(this.unique)return this.unique;var t=new Date;return this.unique=t.getTime()+1e7*rand(1e4),this.unique},Result.prototype.getPaths=function(){return this.encpoly?_(this.encpoly.replace(/\\\\/g,"\\").split(" ")).map(function(t){return google.maps.geometry.encoding.decodePath(t)}):void 0},Result.prototype.getMarker=function(t){return this.marker||(this.encpoly?this.marker=new ws.Polygon({paths:this.getPaths(),strokeColor:"#097601",strokeOpacity:.4,strokeWeight:2,fillColor:"#63e802",fillOpacity:.3,clickHandler:_(this.onMarkerClick).bind(this),zIndex:1}):this.marker=new ws.Marker({position:this.point,icon:this.icon,app:this.app,amenity:this,id:__ws_id(),clickHandler:_(this.onMarkerClick).bind(this)})),this.marker},Result.prototype.getMarkerSel=function(t){return this.markerSel||(this.markerSel=new ws.Marker({position:this.point,icon:this.iconSel,app:this.app,amenity:this,id:__ws_id(),zIndexGroup:ws.zIndexGroups.SELECTED_MARKERS,clickHandler:_(this.onMarkerClick).bind(this)}))},Result.prototype.onMarkerClick=function(){trackEvent(ACTIVE_COMPONENT,"marker click",this.category),this.app.selectAmenity(this)},Result.prototype.placeId=function(){if(this.external_id)return"eid/"+this.external_id;if(this.phoneNumber)return"phone/"+(""+this.phoneNumber).replace(/\D/g,"");if(this.key)return"akey/"+this.key;throw'Unable to generate placeId for Result object of type "'+this.getCategory()+'"'},AmenityResult.inheritsFrom(Result),AmenityResult.prototype.getUrl=function(){return this.url},AmenityResult.prototype.getDataSource=function(){return this.dataSource},AmenityResult.prototype.getStreetAddress=function(){return this.streetAddress},AmenityResult.prototype.getPhoneNumber=function(){return this.phoneNumber},AmenityResult.prototype.getCity=function(){return this.city},AmenityResult.prototype.getRegion=function(){return this.region},AmenityResult.prototype.getLocation=function(t){var e=[];this.streetAddress&&e.push(this.streetAddress),this.city&&this.region&&e.push(this.city+", "+this.region);var i=t?"<br />":", ";return e.join(i)},AmenityResult.prototype.getScore=function(){if(this.score)return this.score;var t=Math.floor(4*convertMeters(this.getSnapDistance(),UNITS_MI));switch(t){case 0:this.score=10;break;case 1:this.score=8;break;case 2:this.score=4;break;case 3:this.score=2;break;default:this.score=0}return this.score},TransitRoute.prototype.getId=function(){return this.id},TransitRoute.prototype.getName=function(){return this.name},TransitRoute.prototype.getCategory=function(){return this.category},TransitRoute.prototype.getAgency=function(){return this.agency},TransitRoute.prototype.getAgencyUrl=function(){return this.agencyUrl},TransitRoute.prototype.getNearestStop=function(){return this.nearestStop},TransitRoute.prototype.isEqual=function(t){return t==this.id},TransitResult.inheritsFrom(Result),TransitResult.prototype.setRoutes=function(t){this.routes=t,this.hasRail()&&(this.icon=railIcon,this.iconSel=railIconSel)},TransitResult.prototype.setUniqueRoutes=function(t){this.uniqueRoutes=t},TransitResult.prototype.getName=function(){return this.name},TransitResult.prototype.getId=function(){return this.id},TransitResult.prototype.getLocation=function(){return this.name},TransitResult.prototype.getRoutes=function(){return this.routes},TransitResult.prototype.hasRail=function(){for(var t in this.routes)if("rail"==this.routes[t].category)return!0;return!1},SimpleMarker.prototype.getDataSource=function(){return"app-created"},SimpleMarker.prototype.getPoint=function(){return this.latlng},SimpleMarker.prototype.getLocation=function(){return this.street},SimpleMarker.prototype.getMarker=function(){return this.markerSel||(this.markerSel=new ws.Marker({position:this.latlng,icon:this.icon,app:this.app,amenity:this,id:__ws_id(),zIndexGroup:ws.zIndexGroups.HOUSE_MARKER,clickHandler:_(this.onMarkerClick).bind(this)}))},SimpleMarker.prototype.onMarkerClick=function(){trackEvent(ACTIVE_COMPONENT,"house click",this.category),this.app.selectAmenity(this)},SimpleMarker.prototype.getResultHTML=function(){if(this.resultHTML)return this.resultHTML;var t='<div class="iw">';return t+='<div class="iw-title">Address:</div>',t+='<div class="iw-contact-info">',""!=this.street&&(t+="<div class=iw-street>"+this.street+"</div>"),""!=this.cityStateZip&&(t+="<div class=iw-citystate>"+this.cityStateZip+"</div>"),t+="</div>",t+="</div>",this.resultHTML=t,this.resultHTML},SimpleMarker.prototype.add=function(t){this.badgeIcon=t,this.app.map.mod_do("addOverlay")(this.getMarker())},SimpleMarker.prototype.remove=function(){this.app.map.mod_do("removeOverlay")(this.getMarker()),delete this.markerSel};var WS_TILE_MIN_WIDTH=225,WS_TILE_WIZARD_MIN_WIDTH=250,WS_TILE_LAYOUT_SWITCH_THRESHOLD=475,WS_TILE_H_DEFAULT_WIDTH=700,WS_TILE_H_DEFAULT_HEIGHT=440,WS_TILE_H_MIN_HEIGHT=200,WS_TILE_H_MAX_HEIGHT=3e3,WS_TILE_V_MIN_HEIGHT=300,WS_TILE_V_MAX_HEIGHT=3e3,WS_TILE_V_DEFAULT_LIST_LIMIT=5,WS_TILE_V_MIN_LIST_LIMIT=5,WS_TILE_MAX_LIST_LENGTH=10,WS_TILE_H_LINE_HEIGHT=38,WS_TILE_V_LINE_HEIGHT=34,WS_TILE_FOOTER_LINE_HEIGHT=18,WS_TILE_FOOTER_2_LINE_THRESHOLD=350,WS_TILE_FOOTER_HIDDEN=100,WS_TILE_FOOTER_ADDRESS=101;WalkScoreApp=function(){function t(t){}var e={coreGeocode:"onGeocode",coreGeocodeFailed:"onFailedGeocode",dataRequestsComplete:"onDataRequestsComplete",scoreCompleted:"onScoringCompleted",scoreQueriesAvailable:"onScoreQueriesReceived",customQueriesAvailable:"onCustomQueriesReceived",overviewQueriesAvailable:"onOverviewQueriesReceived",travelQueriesAvailable:"onTravelQueriesReceived",commercialQueriesAvailable:"onCommercialQueriesReceived"},i={};return WAp=t.prototype,WAp.initApp=function(t){for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);for(var n in i)if(!this.hasOwnProperty(n))return void alert("Missing "+n+" in app init");var s="walkscore";$.browser.msie&&$.browser.version<8&&(s="walkscore_ie7"),this.profile=t.profile?t.profile:s,this.dataFetcher?this.dataFetcher.setProfile(this.profile):this.dataFetcher=new DataFetcher(this.profile),this.dataSourceManager=new DataSourceManager(this);var a=new AmenityService(this);this.localAmenityService=new LocalAmenityService,this.noAmenityLocalStorage&&(a.noAmenityLocalStorage=!0);var o=new Geocoder;this.walkScoreCore=new WalkScoreCore(this.profile,this.dataFetcher,a,o,this.optionFlags),this.walkScoreCore.app=this,this.geoData=null,this.cache=new SimpleCache;for(var r in e)appEvents.addListener(r,this[e[r]],this);this.appQueryList&&this.walkScoreCore.request(this.appQueryList,this.geoData)},WAp.updateAmenitySet=function(t,e,i){if(DEBUG_CURATION&&dbug("APP: update amenity set "+t),"Transit"!=t&&this.queryList){var n=this.queryList.getQueryByName(t);n&&!n.isChild()&&this.updateAmenitySetInternal(n,t,e,i)}},WAp.updateAmenitySetInternal=function(t,e,i,n){this.resultPanels&&this.resultPanels.addAmenityContent(e,i,n),this.map&&this.map.updateAmenityMarkers(e,i)},WAp.initAmenityManager=function(t){this.amenityManager=new AmenityManager(this,this.geoData),this.amenityManager.setResultSetCap(t),this.walkScoreCore.amenityManager=this.amenityManager},WAp.onOverviewQueriesReceived=function(t){this.onDisplayQueriesReceived(t,"overviewQueries")},WAp.onCustomQueriesReceived=function(t){this.onDisplayQueriesReceived(t,"customQueries")},WAp.onTravelQueriesReceived=function(t){this.onDisplayQueriesReceived(t,"travelQueries")},WAp.onCommercialQueriesReceived=function(t){this.onDisplayQueriesReceived(t,"commercialQueries")},WAp.onDisplayQueriesReceived=function(t,e){this.displayInitiated||(this.displayInitiated=!0,e&&e==this.appQueryList&&(t||dbug("no json for display queries"),this.queryList=new QueryList(t,e),this.initializePanelManager(),this.localAmenityService.setQueryList(this.queryList).setLocation(this.geoData),this.onResultPanelsInitialized&&this.onResultPanelsInitialized(),this.lazyQueryExecution||this.walkScoreCore.getAmenityService().runQueryList(this.queryList,_(this.onDisplayQueryCompleted).bind(this),_(this.onAllDisplayQueriesCompleted).bind(this))))},WAp.initializePanelManager=function(){this.resultPanelID&&(this.resultPanels=new PanelManager(this,$("#"+this.resultPanelID).eq(0),this.geoData,this.listLimit),this.resultPanels.initializePanelsFromQueryList(this.queryList))},WAp.request=function(t,e){this.walkScoreCore.request(t,e)},WAp.getMap=function(){return this.map},WAp.addNewResult=function(t,e){this.showRescoreAlert&&this.showRescoreAlert();var i=this.amenityManager.addNewResult(t,e,!0);return i&&this.selectAmenity(i),i},WAp.updateResult=function(t,e,i){this.showRescoreAlert&&this.showRescoreAlert(),this.amenityManager.deleteResult(i.getCategory(),i.getKey(),!1);var n=this.amenityManager.addNewResult(t,e,!0);return n&&this.selectAmenity(n),n},WAp.showAmenityMarkers=function(t,e){this.map.showAmenityMarkers(t,e)},WAp.selectAmenityByCategory=function(t,e){var i=this.amenityManager.getResult(t,e);this.selectAmenity(i)},WAp.selectAmenity=function(t,e){this.map.showAmenityInfo(t,e)},WAp.showRemoveAmenityDialog=function(t,e,i){var n=function(t){var e=_(t||{}).spelunk(["place","place_page_path"]);return e?(window.open(e+"?utm_medium=bubble_flag","_blank"),!0):void 0};trackEvent(ACTIVE_COMPONENT,"remove result clickthrough",t.getCategory()),n({place:t})||$.ajax({url:"/auth/places/v1/add-place",data:{place:JSON.stringify(unpackPlaceData(t))},dataType:"json",type:"GET",cache:!1,success:n,error:n})},WAp.showRestoreAmenityDialog=function(t,e,i){this.dataCurator.initRestorePlace(t,e,i)},WAp.showAddPlaceDialog=function(t,e,i){this.dataCurator.initAddPlace(this.queryList,t,this.walkScoreCore.getGeocoder(),e,i);
},WAp.showEditAmenityDialog=function(t,e,i){this.dataCurator.initEditPlace(t,this.queryList,this.walkScoreCore.getGeocoder(),e,i)},WAp.removeAmenities=function(t){this.showRescoreAlert&&this.showRescoreAlert(),this.amenityManager.processRemovals(t,!0)},WAp.restoreAmenity=function(t){this.showRescoreAlert&&this.showRescoreAlert(),this.amenityManager.restoreAmenity(t),this.selectAmenity(t)},WAp.deleteAmenity=function(t,e){this.showRescoreAlert&&this.showRescoreAlert(),this.amenityManager.deleteResult(t,e,!0)},WAp.toggleAllTransit=function(t){this.allTransitShown?(this.map.removeAmenityMarkers("Transit",this.amenityManager.getAllTransitResults()),this.map.showAmenityMarkers("Transit",this.amenityManager.getFeaturedTransitResults()),$(t).html("Show more stops"),trackEvent(ACTIVE_COMPONENT,"hide some transit stops")):(this.map.removeAmenityMarkers("Transit",this.amenityManager.getFeaturedTransitResults()),this.map.showAmenityMarkers("Transit",this.amenityManager.getAllTransitResults()),$(t).html("Show fewer stops"),trackEvent(ACTIVE_COMPONENT,"show all transit stops")),this.allTransitShown=!this.allTransitShown},WAp.checkForHighlightedResult=function(t){if(!this.foundHighlight){try{var e=decodeURIComponent(getUrlParam("show"))}catch(i){return}if(thisObj=this,!isEmptyString(e)){var n=forEach(t,function(t,i){return t&&t.getKey()==e?t:void 0});n&&!n.isRemoved()&&(this.foundHighlight=!0,_(function(){thisObj.selectAmenity(n)}).delay(2e3),this.map.GMap().customPanTo(n.getPoint(),-90,60))}}},WAp.withUser=function(t){this.openIdConnector?this.openIdConnector.withInfo(t):t(null)},t}(),PanelManagerBase=function(){function t(){}var e={app:!0,container:!0,geoData:!0,titleMaxLength:!0,noneFoundHtml:!0};return PMp=t.prototype,PMp.initPM=function(t){for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);for(var i in e)if(!this.hasOwnProperty(i))return void alert("Missing "+i+" in app init");this.panels=[],this.allPanelsExpanded=!1},PMp.numPanels=function(){return this.panels.length},PMp.getPanelByIndex=function(t){return this.panels[t]},PMp.getPanel=function(t){for(var e in this.panels)if(this.panels[e].getCategory()==t)return this.panels[e];return null},PMp.getPanelIndex=function(t){for(var e in this.panels)if(this.panels[e].getCategory()==t)return e;return-1},PMp.addAmenityContent=function(t,e,i){var n=this.getPanel(t);n&&n.addContent(t,e,i)},PMp.onEntryClick=function(t){trackEvent(ACTIVE_COMPONENT,"result list click",t.getCategory()),this.app.selectAmenity(t,!0)},PMp.onEntryClickByIndex=function(t,e){trackEvent(ACTIVE_COMPONENT,"result list click",t),this.app.selectAmenityByCategory(t,e)},PMp.onRemovedEntryClick=function(t,e,i){trackEvent("overview","removed amenity info click",t.getCategory()),this.app.showRestoreAmenityDialog(t,e,i)},PMp.formatDistanceForDisplay=function(t){return convertMetersForDisplay(t,this.geoData.getUnits(),!0,2,!1)},PMp.showAddPlace=function(t,e,i){this.app.showAddPlaceDialog(t,e,i)},PMp.initializePanelsFromQueryList=function(t){var e=_(t.list).filter(function(t){return!t.isChild()}),i=e.length;this.listLimit&&(this.hasOtherSet=e.length>this.listLimit,i=Math.min(e.length,this.listLimit));for(var n=0;i>n;n++)this.addContainer(e[n].getName())},t}(),AmenityPanelBase=function(t,e,i,n){function s(){}var a={panelManager:!0,category:!0,expanded:!0,geoData:!0};return APBp=s.prototype,APBp.initAmenityPanelBase=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);for(var e in a)if(!this.hasOwnProperty(e))return void alert("Missing "+e+" in app init");this.amenities=[],this.slug=sluggify(safeString(this.category)),this.panelId="pg-"+this.slug,this.headerId="ph-"+this.slug,this.contentId="pc-"+this.slug,this.extensionId="px-"+this.slug,this.getEntryId=function(t){return"pe-"+this.slug+t}},APBp.getCategory=function(){return this.category},APBp.isInDOM=function(){return $("#pg-"+this.slug).length>0},APBp.initializeInDOM=function(t,e){var i=[],n=this.expanded?"open":"";i.push('<div class="panel-group" id="'+this.panelId+'">'),i.push('<div class="group-label '+n+'" id="'+this.headerId+'"><h4>'+this.category+"</h4></div>"),i.push('<div id="'+this.contentId+'" class="result first-result"><img class="progress" src="//cdn2.walk.sc/2/images/progress.gif"/></div>'),i.push("</div>"),this.addToDOM(i.join(""),t,e)},APBp.addToDOM=function(t,e,i){i&&"before"==i?e.before(t):i&&"after"==i?e.after(t):e.append(t),this.bindClickEvents()},APBp.removeSelfFromDOM=function(){$("#"+this.panelId).remove()},APBp.repositionInDom=function(t,e){var i=$("#"+this.panelId);i.remove(),this.addToDOM(i,t,e)},APBp.addContent=function(t,e,i){this.expanded=i?!0:this.expanded,this.amenities=e;var n=this.expanded?"block":"none";if(e.length>0){var s=[];s.push('<div id="'+this.contentId+'">'),s.push(this.getEntryHTML(0,e[0],"first-result")),s.push('<div id="'+this.extensionId+'" style="display:'+n+';">');for(var a=1;a<e.length;a++)s.push(this.getEntryHTML(a,e[a]));s.push('<div class="result noclick"><p class="add-place-link"><a class="dull-link">Add place</a></p></div>'),s.push("</div></div>"),$("#"+this.contentId).replaceWith(s.join(""));var o=this.category,r=replaceAll(this.category," ","_"),l=this.panelManager;$("#"+this.extensionId).find(".see-more-link").children("a").bind("click",function(){trackEvent(ACTIVE_COMPONENT,"see more amenities",o),goToTab("nearby",{active:r})}),$("#"+this.extensionId).find(".add-place-link").children("a").bind("click",function(t){l.showAddPlace(o,t.pageX,t.pageY)}),this.bindClickEvents()}else $("#"+this.contentId).replaceWith(this.panelManager.noneFoundHtml)},APBp.getEntryHTML=function(t,e,i){var n=e.getName().substr(0,this.panelManager.titleMaxLength),s="";return e.isRemoved()?(s+='<div class="result noclick removed-result '+safeString(i)+'" id="'+this.getEntryId(t)+'">',s+='<h6><a class="removed-info"></a></h6>',s+="<h5>"+n+"</h5>",s+="</div>"):(s+='<div class="result '+safeString(i)+'" id="'+this.getEntryId(t)+'">',s+="<h6>"+this.panelManager.formatDistanceForDisplay(e.getDist())+"</h6>",s+="<h5>"+n+"</h5>",s+="</div>"),s},APBp.bindClickEvents=function(){var t=this;$("#"+this.headerId).unbind().bind("click",function(){t.toggleExpandCollapse()});for(var e=0;e<this.amenities.length;e++)this.bindEntryClick(e)},APBp.bindEntryClick=function(t){var e=this.panelManager,i=this.amenities[t];i&&(this.amenities[t].isRemoved()?$("#"+this.getEntryId(t)).find(".removed-info").click(function(t){e.onRemovedEntryClick(i,t.pageX,t.pageY)}):$("#"+this.getEntryId(t)).bind("click",function(){e.onEntryClick(i)}))},APBp.toggleExpandCollapse=function(t){var e=$("#"+this.extensionId);return e.length>0&&(t?(e.css("display",t),"block"==t?$("#"+this.headerId).addClass("open"):$("#"+this.headerId).removeClass("open"),this.expanded="block"==t):this.expanded?(e.css("display","none"),$("#"+this.headerId).removeClass("open"),this.expanded=!1,trackEvent(ACTIVE_COMPONENT,"collapse-category",this.category)):(e.css("display","block"),$("#"+this.headerId).addClass("open"),this.expanded=!0,trackEvent(ACTIVE_COMPONENT,"expand-category",this.category))),this.expanded},s}();var WS_M_NOT_FOUND="The supplied address could not be found. Please try another address.",INITIAL_PRO_CAP=16;window.onresize=_(function(){var t=window.innerWidth;if(t!=window.width){var e=window.location.href;e=e.replace(/&w=([0-9])*/g,"&w="+window.innerWidth),ws_auth_domain&&-1==e.indexOf("reloaded_from")&&(e+="&reloaded_from="+ws_auth_domain),window.location.replace(e)}}).debounce(300);var percentServerQueries=function(t){return(""+(new Date).getTime()).substr(11)-0<t},kill_splash=function(){$("#splash").css("display","none")};AmenityMapApp.prototype=new WalkScoreApp,AmenityMapApp.prototype._deferred_init=function(t,e,i){var n={geoData:t,dataFetcher:e,serverQueries:!0,profile:i,resultPanelID:"result-panels"};"default"==this.view?n.appQueryList="travel"==industry?"travelQueries":"commercial"==industry?"commercialQueries":"overviewQueries":"commute"==this.view&&$("#powered-by").removeClass("hide"),this.initApp(n),this.allTransitShown=!1,this.init=function(){if(trackEventNonInteractive("tile","tile view",tileDomain),edition>=1.5&&trackEventNonInteractive("tile","tile Redfin link",tileDomain),this.initClickTracking(),width<WS_TILE_MIN_WIDTH)throw showMessage("Tile misconfigured: current width: "+width+". <br>The tile must be at least "+WS_TILE_MIN_WIDTH+" pixels wide"),"unsupported layout";this.walkScoreCore.init(t,"tile"),"commute"==this.view?(this.geoData=t,this.initializePanelManager(),trackEventNonInteractive("tile","tile type","commute-"+(have_google?"google":"bing"))):(kill_splash(),trackEventNonInteractive("tile","tile type",industry+"-"+(have_google?"google":"bing")))},this.registerClick=function(){if(this.clicks++,1==this.clicks){var t=function(t){trackEvent("tile","clicked once "+t,ws_auth_wsid)};this.auth.if_free(_(t).bind({},"free")).if_paid(_(t).bind({},"paid"))}},this.initClickTracking=function(){this.clicks=0,$("body").click(_(function(){this.registerClick()}).bind(this))},this.showAmenityMarkers=function(t,e){this.map.showAmenityMarkers(t,e)},this.selectAmenityByCategory=function(t,e){var i=this.amenityManager.getResult(t,e);this.selectAmenity(i)},this.selectAmenity=function(t,e){return t.badgeIcon?void window.open(window.bigMapLink+"&utm_medium=badge_pin"):void this.map.showAmenityInfoWithSlowPan(t,0,40,e)},this.request=function(t,e){this.walkScoreCore.request(t,e)},this.init()},AmenityMapApp.prototype.onGeocode=function(t){this.parameterManager.do_with_one("map_zoom",_(function(e){this.geoData=t,this.initAmenityManager(INITIAL_PRO_CAP),this.amenityManager.setTransitRoutesCap(8),this.auth.if_free(_(function(){this.amenityManager.setResultSetCap(8),this.amenityManager.refresh()}).bind(this)),e&&(e-=0);var i=_(window.google).spelunk(["maps","MapTypeId","ROADMAP"]);this.map=new AmenityMap(this);var n=$("#map-element");this.map.init(n,this.geoData,{highlightSelectedAmenity:!0,autoShowTransit:!1,zoom:e,showContextMenu:!0,enableRecenter:!0,enableJiggle:!(isIOS()&&"Safari"==$.browser.name),bingOptions:{showCopyright:width>=350},gmapOptions:{mapTypeId:i,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1}}),this.parameterManager.do_with_one("show_reviews",_(function(t){var e=t&&n.width()>280&&n.height()>250?AmenityMap.LARGE_INFO_WINDOWS:AmenityMap.SMALL_INFO_WINDOWS;this.map.setIWSize(e),this.map.optionFlags.showReviews=t}).bind(this)),this.onGeocodeContinuation()}).bind(this))},AmenityMapApp.prototype.getBadgeIcon=function(){var t="01";return void 0!==this.finalScore?{url:"//cdn2.walk.sc/2/images/score/wsb/"+t+"/"+this.finalScore+this.resModifier+".png",scaledSize:new google.maps.Size(50,53)}:null},AmenityMapApp.prototype.badgifyHouse=function(){if(!this._badgified){var t=this.getBadgeIcon();t&&this.houseResult&&(this.houseResult.remove(),this.houseResult.add(t),this._badgified=!0)}},AmenityMapApp.prototype.onGeocodeContinuation=function(){this.enableMapModules(),this.auth.if_free(_(function(){edition<2&&($("#dfp-slot").addClass("active").css("visibility","visible"),googletag.cmd.push(function(){googletag.display("div-gpt-ad-1401925358882-0")}),this.map.isBigEnoughForAds()&&this.map.showAds(1,{channel:"2222374041",publisher:"pub-9087492394564508"}))}).bind(this));var t=(this.walkScoreCore.getAmenityService(),_(function(t,e){if(!t)var i="building"==iconType?this.amenityManager.makeBuildingIcon(this.highRes):"house"==iconType?this.amenityManager.makeHouseIcon(this.highRes):this.amenityManager.makeCenterPinIcon(this.highRes);this.houseResult=this.amenityManager.createSimpleMarker(this,this.geoData.getPreSnapLatLng(),t||i,this.geoData.getThoroughfare()||this.geoData.getQuery(),this.geoData.getCityStateZip()),t||hide_scores_below||this.auth.if_free(_(function(){this.badgifyHouse()}).bind(this)),this.map.showResult(this.houseResult);var n=this.resultPanels;"commute"==this.view&&n.initCommute(_(n.showCommute).bind(n,_(function(){"v"==layout&&($("#content > .header").remove(),$("#scroll-menu .header").appendTo("#content"),$("#map-frame").height($("#map-frame").height()+30),this.map.recenter()),_(kill_splash).delay(200)}).bind(this)))}).bind(this));this.parameterManager.do_with_some(["custom_pin","polygon"],_(function(e){e.custom_pin?this.amenityManager.makeClientCustomIcon(e.custom_pin,t):e.polygon||t()}).bind(this)),percentServerQueries(5)&&function(t){_(function(){$.ajax({url:"/auth/places/v1/grid",data:{lat:t.getLat(),lng:t.getLng()}})}).defer()}(this.geoData)},AmenityMapApp.prototype.onFailedGeocode=function(){showMessage(WS_M_NOT_FOUND,"//cdn2.walk.sc/2/images/tile/err-not-found.gif")},AmenityMapApp.prototype.initializePanelManager=function(){if(this.resultPanelID){if(this.resultPanels=new PanelManager(this,$("#"+this.resultPanelID).eq(0),this.geoData),"commute"==this.view)return;this.resultPanels.initializePanelsFromQueryList(this.queryList),this.withTransitParameters(_(function(t,e){t||e?(this.transitModule=new TransitModule(this,this.amenityManager,this.resultPanels,this.walkScoreCore.getGeocoder(),this.walkScoreCore.getAmenityService()),this.transitModule.initialize(this.geoData,t)):this.resultPanels.cancelReservation("pub-transit")}).bind(this))}},AmenityMapApp.prototype.withTransitParameters=function(t){var e=this.parameterManager;e.do_with_one("transit_score",_(function(i){e.do_with_one("public_transit",_(function(e){t(i,e)}).bind(this))}).bind(this))},AmenityMapApp.prototype.onScoringCompleted=function(t){this.finalScore=t,this.auth.if_free(_(function(){this.badgifyHouse()}).bind(this)),$("#score-prefix").removeClass(),this.finalScore>=hide_scores_below&&($("#score-text").html(this.finalScore),$("#out-of-100").css("display","block"),$("#score-description").html(getScoreDescription(this.finalScore))),$("#qmark").css("display","block"),this.parameterManager.do_with_one("no_link_description",_(function(t){t||$("#score-description-link").append($("#score-description")).addClass("active")}).bind(this))},AmenityMapApp.prototype.onDisplayQueryCompleted=function(t){this.amenityManager.makeAmenitiesFromRawResults(t)},AmenityMapApp.prototype.onAllDisplayQueriesCompleted=function(){this.resultPanels.onAllDisplayQueriesCompleted()},AmenityMapApp.prototype.enableMapModules=function(){this.parameterManager.do_with_some(["map_modules","disable_street_view","base_map","polygon"],_(function(t){var e=t.map_modules.toLowerCase(),i="mod_"+t.base_map;e="all"==e?this.map.allModules():"default"==e?this.map.defaultModules():_(e.split(",")).map(function(t){return"mod_"+t}),t.polygon&&(e=[i="mod_polygon"]),t.disable_street_view&&(e=_(e).reject(function(t){return"mod_street_view"==t})),_(e).include(i)||e.unshift(i),have_google||_(e).include("mod_bing_map")||e.unshift("mod_bing_map"),!have_google&&_(e).include("mod_walkability")&&(e=_(e).map(function(t){return"mod_walkability"==t?"mod_walkability_bing":t}),"mod_walkability"==i&&(i="mod_walkability_bing")),_(e).each(_(this.map.enableModule).bind(this.map)),this.map.activateModule(i),this.map.finalizeModules()}).bind(this))},Reservations.HOLD=0,Reservations.CONFIRMED=1,function(){"use strict";window.PanelManager=function(t,e,i){this.initPM({app:t,container:e,geoData:i,titleMaxLength:80,noneFoundHtml:"None found"}),this.scrollPanel=new ScrollPanel,this.rootListDisplayCount=0;var n="one-line"==menuItemSize?2:5;this.rootListLimit=Math.floor((menuItemsHeight+n)/itemHeight),this.listLimit="v"==layout?this.rootListLimit-1:this.rootListLimit,this.showAddresses=!(results_w<275&&"one-line"==menuItemSize),"commute"!=this.app.view&&(this.listReservations=new Reservations,edition<2?(this.listReservations.reserve("ad1"),this.app.auth.if_free(_(this.confirmReservation).bind(this,"ad1")).if_paid(_(this.cancelReservation).bind(this,"ad1"))):this.cancelReservation("ad1"),this.listReservations.reserve("pub-transit"),this.listReservations.reserve("commute"),this.initCommute(_(this.initCommuteMenuItem).bind(this)),showSearchNearby&&(this.app.nearbyManager=new NearbyManager(this.app)))},PanelManager.prototype=new PanelManagerBase,PanelManager.prototype.getPanel=function(t){var e;for(e in this.panels)if(this.panels[e].getCategory()==t)return this.panels[e];var i=this.app.nearbyManager.panels;for(e in i)if(i[e].getCategory()==t)return i[e];return null},PanelManager.prototype.initializePanelsFromQueryList=function(t){var e=_(t.list).filter(function(t){return!t.isChild()&&!t.isCustom()}),i=e.length;this.numQueries=e.length,showSearchNearby&&this.numQueries++;for(var n=0;i>n;n++)this.addContainer(e[n].getName());showSearchNearby&&(this.panels.push(new SearchNearbyEntry(this)),this.refreshRoot())},PanelManager.prototype.addContainer=function(t){var e=new AmenityPanel(this,t,this.geoData);this.panels.push(e),this.refreshRoot()},PanelManager.prototype.refreshRoot=function(){if(!this.rootLoadingComplete){for(var t=this.rootListLimit-this.listReservations.numReservations(),e=0==this.listReservations.numHolds(),i=this.rootListDisplayCount;t-1>i&&i<this.panels.length;)this.panels[i].initializeInDOM(this.container),this.rootListDisplayCount++,i++;if(e&&(this.panels.length>t+2||this.panels.length==this.numQueries)){if(this.panels.length>t){var n="more-cats-"+(t-1),s=this.getItemHtml(n,{pt1:"More Places:",extraClass:"highlight"});$("#end_of_main_results").after(s),this.bindRootMoreItem()}else i<this.panels.length&&(this.panels[i].initializeInDOM(this.container),this.rootListDisplayCount++);this.rootListDisplayCount++,_(this.listReservations.list).each(function(t,e){t==Reservations.CONFIRMED&&$("#"+e).css("display","block")}),$("#root-card").find(".menu-item:last").addClass("last"),this.rootLoadingComplete=!0,$.browser.webkit&&$("#scroll-menu").scroll(function(t){$(this).scrollLeft(0)})}}},PanelManager.prototype.onAllDisplayQueriesCompleted=function(){this.bindRootMoreItem()},PanelManager.prototype.bindRootMoreItem=function(){var t=this.rootListLimit-this.listReservations.numReservations()-1;$("#more-cats-"+t).unbind().click(_(function(t){this.showCategories(t,"Walk Score")}).bind(this,t))},PanelManager.prototype.getItemHtml=function(t,e){var i=e.extraClass?e.extraClass:"";e.pt3||e.pt4||(i+=" wide");var n=t?'id="'+t+'"':"";n+=' class="menu-item '+i+'"';var s=[];return s.push("<div "+n+'><div class="left">'),e.custom?s.push(e.custom):(s.push("<h3>"+e.pt1+"</h3>"),e.pt1Extra&&s.push(e.pt1Extra),s.push("<h4>"+safeString(e.pt2)+"</h4>"),"one-line"==menuItemSize&&e.pt3&&s.push("<h5>"+safeString(e.pt3)+"</h5>"),s.push("</div>")),(e.pt3||e.pt4)&&(s.push('<div class="right">'),"two-line"==menuItemSize&&s.push("<h5>&nbsp;"+safeString(e.pt3)+"</h5>"),s.push("<h6>"+safeString(e.pt4)+"</h6>"),s.push("</div>")),e.extraClass&&-1!=e.extraClass.indexOf("final")||s.push('<div class="next-icon"></div>'),e.extra&&s.push(e.extra),s.push("</div>"),s.join("")},PanelManager.prototype.cancelReservation=function(t){this.listReservations.cancel(t),this.refreshRoot()},PanelManager.prototype.confirmReservation=function(t,e,i){e&&$("#"+t).replaceWith(e),0==this.listReservations.numHolds()&&$("#"+t).css("display","block"),this.listReservations.confirm(t),this.refreshRoot(),i&&i(),0==this.listReservations.numHolds()&&$("#root-card").find(".menu-item:last").addClass("last")},PanelManager.prototype.formatDistance=function(t){return am_convertMetersForDisplay(t,this.geoData.getUnits())},PanelManager.prototype.getCardHeaderHtml=function(t,e,i){var t=defaultIfNotSet(t,"Walk Score"),n=[];return n.push("<div class='header'>"),i.noBackButton||n.push("<div class='button back b-btn light'><div></div></div>"),n.push("<div class='title-wrap'><div class='title'><h2>"+e+"</h2></div></div>"),"v"==layout&&(i.moreId?(n.push("<div id="+i.moreId+" class='more-wrap b-btn light button more'>"),n.push("More <div></div></div>")):i.moreContent&&(n.push("<div class='more more-link more-wrap b-btn light' id='final-more-link'>"),n.push("<div class='popout'></div>"),n.push(i.moreContent+"</div>"))),n.push("</div>"),n.join("")},PanelManager.prototype.showCard=function(t){var e=t.type,i=t.array,n=t.itemHtmlFunc,s=t.startIndex,a=t.backLabel,o=t.title,r=t.stub,l=t.morePt1,h=i.length,c="h"==layout&&t.moreLink?h+1:h,u=Math.min(s+this.listLimit,c);if(c>u){"h"==layout&&(u-=window.no_head?2:1);var p="more"+r+u}else if("h"==layout&&t.moreLink){u-=window.no_head?2:1;var d=!0}for(var m=[],g=s;u>g;g++)m.push(n(i[g],g));var f="card"+r+s,y=[];y.push("<div id='"+f+"'>");var v={moreId:p?p:null,moreContent:t.moreLink?"More":null};if(y.push(this.getCardHeaderHtml(a,o,v)),y.push("<div class='menu-items'>"),y=y.concat(m),"h"==layout)if(p){var w=t.morePt2Func?t.morePt2Func(u):null;y.push(this.getItemHtml(p,{pt1:l,pt2:w,extraClass:"highlight more-"+e}))}else d&&y.push(this.getItemHtml("final-more-link",{pt1:l+'<div class="popout"></div>',extraClass:"more-"+e+" final external"}));y.push("</div></div>");var b=null,C=null;if("categories"==e)b=_(function(){this.bindCategoryList(f,s,u,p,t)}).bind(this);else if("amenities"==e){var k=0,S=_(function(){this.app.walkScoreCore.getAmenityService().runQueryListFromServer({list:this.app.queryList,cat:o,update:_(function(t){this.app.amenityManager.makeAmenitiesFromRawResults(t),this.app.loadingAmenities=!1,this.app.postLoadMore&&(this.app.postLoadMore(),delete this.app.postLoadMore)}).bind(this)})}).bind(this),b=_(function(){this.bindAmenityList(f,t.category,t.panel,s,u,p,t),t.isCustom||u>h/2.5&&256>h&&!k++&&this.app.auth.if_paid(_(function(){this.app.loadingAmenities=!0;var t=this.app.amenityManager.resultSetCap;2*h>t&&this.app.amenityManager.setResultSetCap(2*t),S()}).bind(this))}).bind(this);if(0==s){var M=this.app,I=M.map,A=M.nearbyManager;C=t.isCustom?function(){_(_(A.handleCatDiveExit).bind(A)).delay(10)}:function(){_(_(I.restoreAllCats).bind(I)).delay(10),M.amenityManager.setResultSetCap(INITIAL_PRO_CAP),S()}}}else if("pub-transit"==e){var b=_(function(){this.bindTransitList(f,i,s,u,p,t)}).bind(this);0==s&&(C=_(function(){setTimeout(_(function(){this.app.map.restoreAllCats()}).bind(this),10)}).bind(this))}return this.scrollPanel.goForward(y.join(""),b,C),$("#"+f).find(".menu-item:last").addClass("last"),f},PanelManager.prototype.showCategories=function(t,e){var i=_(function(t){if(t instanceof SearchNearbyEntry)return t.getHTML();var e=t.amenities[0],i=e?e.getName():this.noneFoundHtml,n=e?this.formatDistance(e.getDist()):"";return this.getItemHtml(t.panelId,{pt1:t.category+":",pt2:i,pt4:n})}).bind(this),n=_(function(t){return this.getNextCats(t)}).bind(this);this.showCard({type:"categories",array:this.panels,itemHtmlFunc:i,startIndex:t,backLabel:e,title:"More Places",stub:"nearby",morePt1:"More Places",morePt2Func:n}),trackEvent("tile","more nearby click")},PanelManager.prototype.bindCategoryList=function(t,e,i,n,s){var a=$("#"+t);a.find(".menu-item:last").addClass("last"),a.find(".back").click(_(function(){this.goBack()}).bind(this.scrollPanel)),n&&a.find("#"+n).click(_(function(){this.showCategories(i,"More Places")}).bind(this));for(var o=0===this.scrollPanel.currentCardIndex()?"Walk Score":"More Places",r=e;i>r;r++)this.panels[r].bindClickEvents(o)},PanelManager.prototype.getNextCats=function(t){for(var e=[],i=t;t+3>i&&i<this.panels.length;i++)this.panels[i]&&this.panels[i].category&&e.push(this.panels[i].category);return e.join(", ")+"..."},PanelManager.prototype.getAmenityItemHtmlFunc=function(){return ensureWSUnderscoreMixins(),function(t){return _(function(e,i){return e?this.getItemHtml("pe-"+t+i,{pt1:e.getName(),pt2:this.showAddresses?e.getStreetAddress():"",pt4:this.formatDistance(e.getDist()),extraClass:"final"}):""}).bind(this)}}(),PanelManager.prototype.showAmenities=function(t,e,i){if(this.app.loadingAmenities)return this.app.postLoadMore=_(this.showAmenities).bind(this,t,e,i);var n=this.getPanel(t),s=this.getAmenityItemHtmlFunc(n.slug),a=t.replace(/\W/g,"_"),o=removeMoreAmenitiesLink?null:"http://www.walkscore.com/score/"+this.geoData.getUrlifiedLocation()+"/active="+a;this.showCard({type:"amenities",array:n.amenities,itemHtmlFunc:s,startIndex:e,backLabel:i,title:t,stub:a,morePt1:"More "+t,category:t,panel:n,moreLink:o}),trackEvent("tile","category click",t)},PanelManager.prototype.bindAmenityList=function(t,e,i,n,s,a,o){this.app.map.onlyShowCat(e,n,s);var r=$("#"+t);r.find(".back").click(_(function(){this.goBack()}).bind(this.scrollPanel)),a?r.find("#"+a).click(_(function(){this.showAmenities(e,s,e)}).bind(this)):o.moreLink&&r.find("#final-more-link").click(function(){window.open(o.moreLink)});for(var l=n;s>l;l++)i.bindEntryClick(l)},PanelManager.prototype.initCommuteMenuItem=function(){this.cookie=new BasicCookie("commute"),this.updateCommuteMenuItem(this.cookie.hasData()?this.cookie.getGeoData("toAddress"):null),this.confirmReservation("commute"),appEvents.addListener("commuteAddressChanged",this.updateCommuteMenuItem,this)},PanelManager.prototype.updateCommuteMenuItem=function(t){if(t&&t.hasData())var e=this.getItemHtml("commute",{pt1:"travel"==industry?"See directions to:":"See commute time to:",pt2:t.getBestFormattedAddress(),extraClass:"highlight commute-menu-item"}),i=_(function(){$("#commute").click(_(function(){trackEvent("tile","commute click","existing commute address"),this.showCommute(null)}).bind(this))}).bind(this);else var e=this.getItemHtml("commute",{custom:this.getCommuteQueryHtml().html(),extraClass:"final noclick custom commute-menu-item"}),i=_(function(){var t=this.app.commuteApp,e=_(t.activate).bind(t),i=_(function(t){trackEvent("tile","commute click","new commute address"),this.showCommute(t)}).bind(this,function(){var t=getActiveText("#commute .commute-query");t&&setActiveText(".commute-panel .commute-query",t),e()}),n=$("#commute .commute-query");n.keypress(_(function(t){13==t.which&&i()}).bind(this));var s="travel"==industry?"Type address for directions":"Where do you commute?";setInputExampleText("#commute .commute-query",s),$("#commute .go-button").click(_(function(){i()}).bind(this,null))}).bind(this);$("#commute").replaceWith(e),$("#commute").css("display","block").addClass("last"),i()},PanelManager.prototype.getCommuteQueryHtml=function(t){var e=this.app.commuteApp,i=_(e.activate).bind(e),n=$("<input />",{type:"text",name:"query","class":"commute-query"});n.keypress(function(t){13==t.which&&i()});var s=$("<div />",{"class":"go-button b-btn"}).html("Go").click(i),a=$("<div />",{"class":"address-form"}).append(n).append(s);return t&&a.append($("<div />",{id:"commute-entry-helptext"}).html("Type an address to see your "+("travel"==industry?"travel":"commute")+" time driving, on transit, and walking.")),a},PanelManager.prototype.maybeEnableChart=function(){var t=$("#commute-details");if((!have_google||$.browser.msie&&$.browser.version<10)&&$("#elevation-chart-wrapper").addClass("disabled"),!($.browser.msie&&$.browser.version<8))if("h"==layout){var e=$(".commute-results").height()-$("#commute-controls").height()+8;e>=t.height()&&t.addClass("enabled"),ws_auth_domain.match(/walkscore.com$/i)&&this.app.parameterManager.do_with_one("is_apartments",function(e){e&&($("#powered-by").css("display","none"),$("#content .header").css("display","none"),$(".commute-panel").css("top","0px"),t.addClass("enabled"))})}else!this.controlsAreTiled&&t.width()>=220&&(t.addClass("enabled"),$("#commute-controls").find("div.live").width(commute_results_w/2-1));return t.hasClass("enabled")},PanelManager.prototype.maybeTileControls=function(t){"v"==layout&&commute_results_h<148&&(t.addClass("tiled"),t.find("div.live").width(commute_results_w/2-1),this.controlsAreTiled=!0)},PanelManager.prototype.getCommuteResultsHtml=function(){var t=$("<div />",{id:"commute-controls"}).html('<div id="driving" class="live"><div class="commute-icon"></div><label></label><div class="secondary"></div></div><div id="transit" class="live"><div class="commute-icon"></div><label></label><div class="secondary"></div></div><div id="walking" class="live"><div class="commute-icon"></div><label></label></div><div id="bicycling" class="live"><div class="commute-icon"></div><label></label></div>').addClass("disabled");this.maybeTileControls(t);var e=$("<div />",{id:"elevation-chart-wrapper"}).append($("<h2 />").html("Hills Between Home and Work")).append($("<p />",{id:"y-units"})).append($("<div />",{id:"elevation-chart"})),i="<h2>Driving Costs</h2>";this.geoData&&"US"==this.geoData.countryCode&&(i+='<div id="dpm"><div class="icon"></div><p><span></span>&nbsp;per month</p></div>'),i+='<div id="hpm"><div class="icon"></div><p><span></span>&nbsp;hours per month</p></div><p><strong>Based on:</strong></p><ul><li id="mpm"></li>',this.geoData&&"US"==this.geoData.countryCode&&(i+='<li id="base-cost"></li></ul>');var n=$("<div />",{id:"driving-costs"}).html(i),s=$("<div />",{id:"transit-options"}).append($("<h2 />").html("Public Transit Options")).append($("<ul />",{id:"route-list"})),a=$("<div />",{id:"commute-details"}).append(e).append(n).append(s);return"v"==layout&&a.width(commute_results_w/2).addClass("vertical").find("#elevation-chart").width(commute_results_w/2-20),$("<div />",{id:"commute-content","class":"commute-results"}).append(t).append(a)},PanelManager.prototype.getSearchNearbyHtml=function(){var t="Search nearby...",e=$("<input />",{type:"text",name:"query","class":"nearby-query"}),i=this.app.nearbyManager,n=_(function(){i.addQuery(e.val()),this.app.map.onlyShowCustomCats(),e.val(""),i.checkFull()&&e.blur()}).bind(this);e.keypress(function(t){13==t.which&&n()}),setInputExampleText(e,t);var s=$("<div />",{"class":"go-button b-btn"}).html("Go").click(n),a=$("<div />",{"class":"shield"}).html("Remove one before adding"),o=$("<div />",{"class":"exists-warning"}).html("Category exists");return $("<div />",{"class":"nearby-form"}).append(a).append(o).append(e).append(s)},PanelManager.prototype.getNearbyResultsHtml=function(){return $("<div />",{"class":"nearby-results"})},PanelManager.prototype.showSearchNearby=function(){var t=this.scrollPanel,e=this.app.nearbyManager,i=_(e.deactivate).bind(e),n=_(e.activate).bind(e),s=$("<div />").append(this.getCardHeaderHtml(null,"Search Nearby",{})).append($("<div />",{"class":"nearby-panel"}).append(this.getSearchNearbyHtml()).append(this.getNearbyResultsHtml()));s.find(".header .back").click(_(t.goBack).bind(t)),this.app.nearbyManager.setContainer(s.find(".nearby-results")),this.app.nearbyManager.refresh(),t.goForward(s,n,i),trackEvent("tile","search_nearby click")},PanelManager.prototype.initCommute=function(t){this.app.parameterManager.do_with_some(["commute","polygon"],_(function(e){if(e.polygon||!e.commute)return this.cancelReservation("commute");var i=_(function(){return window.CommuteApp?void this.app.parameterManager.do_with_some(["commute_address","commute_display_address","fixed_commute"],_(function(e){this.app.commute_address=e.commute_address,this.app.commute_display_address=e.commute_display_address,this.app.fixed_commute=e.fixed_commute,this.app.commuteApp=new CommuteApp(this.geoData,this.app),t&&t()}).bind(this)):_(i).delay(100)}).bind(this);Modernizr.load({load:["//cdn2.walk.sc/2/js/commute-map_vcnyvsr4.js","//cdn2.walk.sc/2/js/commute_vcnyvsr4.js","//apicdn.walkscore.com/api/v1/traveltime/js?wsid=WS_TILE"],complete:i})}).bind(this))},PanelManager.prototype.showCommute=function(t){var e=this.scrollPanel,i=this.app.commuteApp,n=this.app.map;n.lock("mod_google_map");var s=function(){i.activate(),t&&t()},a=function(){i.deactivate(),n.unlock()},o={noBackButton:"commute"==this.app.view},r=$("<div />").append(this.getCardHeaderHtml(null,"travel"==industry?"Directions":"Your Commute",o)).append($("<div />",{"class":"commute-panel commute-query-form"}).append(this.getCommuteQueryHtml(!0)).append(this.getCommuteResultsHtml()));r.find(".header .back").click(_(e.goBack).bind(e)),this.app.map.onlyShowCat("-commute-"),e.goForward(r,s,a)},PanelManager.prototype.showTransit=function(t,e,i,n){var s=_(function(t){return this.getItemHtml("route-item-"+t.id,{pt1:t.name,pt2:t.nearestStop.name,pt4:this.formatDistance(t.nearestStop.displayDist),extraClass:"final "+t.category,extra:"<div class='mode-icon'></div>"
})}).bind(this),a=(_(function(t){return this.getNextCats(t)}).bind(this),null!==n?"Transit Score":"Public Transit"),o=this.showCard({type:"pub-transit",array:t,itemHtmlFunc:s,startIndex:e,backLabel:i,title:a,stub:"pub-transit",morePt1:"More Transit",transitScore:n});if(null!==n){var r="<h2 class='tscore'> "+n+"</h2>";$("#"+o+" h2").append("<sup>&reg;</sup>: ").after(r)}trackEvent("tile","category click","transit")},PanelManager.prototype.bindTransitList=function(t,e,i,n,s,a){0==i&&setTimeout(_(function(){this.app.map.onlyShowCat("Transit")}).bind(this),10);var o=$("#"+t);o.find(".back").click(_(function(){this.goBack()}).bind(this.scrollPanel)),s&&o.find("#"+s).click(_(function(){this.showTransit(e,n,"Transit",a.transitScore)}).bind(this));for(var r=i;n>r;r++)this.bindTransitRoute(e[r])},PanelManager.prototype.bindTransitRoute=function(t){$("#route-item-"+t.id).click(_(function(){this.onEntryClick(t.nearestStop)}).bind(this))}}(),AmenityPanel.prototype=new AmenityPanelBase,AmenityPanel.prototype.initializeInDOM=function(t){this.panelIndex=this.panelManager.getPanelIndex(this.category);var e=this.amenities.length>0?this.amenities[0].getName():null,i=this.amenities.length>0?this.panelManager.formatDistance(this.amenities[0].getDist()):" ",n=this.panelManager.getItemHtml(this.panelId,{pt1:this.category+":",pt2:e,pt4:i});this.addToDOM(n,t)},AmenityPanel.prototype.bindClickEvents=function(t){t=defaultIfNotSet(t,"Walk Score"),this.amenities.length>0?$("#"+this.panelId).unbind("click").removeClass("noclick").click(_(function(){this.panelManager.showAmenities(this.category,0,t)}).bind(this)):$("#"+this.panelId).unbind("click").addClass("noclick")},AmenityPanel.prototype.addContent=function(t,e,i){if(e=_.select(e,function(t){return!t.isRemoved()}),e.length>0){this.amenities=e;var n=this.amenities[0],s=$("#"+this.panelId);s.find("h4").html(n.getName()),s.find("h6").html(this.panelManager.formatDistance(n.getDist()))}else{var s=$("#"+this.panelId);s.find("h4").html(this.panelManager.noneFoundHtml)}this.bindClickEvents()},function(){var t=SearchNearbyEntry.prototype;t.getCategory=function(){return this.category},t.getHTML=function(t){var e="one-line"==menuItemSize&&results_w<250,i=e?null:"Add a custom search",n=!this.panelManager.haveShownNearbyCounts,s=this.panelManager.getItemHtml(this.panelId,{pt1:"Search Nearby"+(e?"":":"),pt2:n?"":i,extraClass:"highlight"});return s},t.initializeInDOM=function(t){this.panelIndex=this.panelManager.getPanelIndex(this.category),t.append(this.getHTML()),this.bindClickEvents()},t.bindClickEvents=function(t){t=defaultIfNotSet(t,"Walk Score");var e=this.panelManager;$("#"+this.panelId).unbind("click").removeClass("noclick").click(_(e.showSearchNearby).bind(e))}}(),function(){var t=IconPool.prototype,e=["GDarkGreen","GBrown","GRed","GLightBlue","GOrange","GPurple","GPink","GBlue","GGreen","GYellow"],i=_(e).clone();t.totalCount=function(){return e.length},t.availableCount=function(){return i.length},t.acquire=function(){return i.shift()},t.release=function(t){i.push(t)},t.acquireSpecific=function(t){return i=_(i).reject(function(e){return e==t}),t}}(),function(){var t=NearbyManager.prototype=new AmenityPanelBase;t.init=function(){this.iconPool=new IconPool,this.cookie=new BasicCookie("custom-map"),this.panels={},this.icons={},this.determineMaxCategories(),this.loadFromCookie()},t.activate=function(){this.app.map.onlyShowCustomCats(),this.checkFull(),this.is_active=!0},t.deactivate=function(){this.app.map.restoreAllCats(),this.is_active=!1},t.setContainer=function(t){this.container=t},t.determineMaxCategories=function(){var t=this.iconPool.totalCount(),e="one-line"==menuItemSize?26:38,i=commute_results_h-10,n=Math.floor(i/e);this.maxCategories=n>t?t:n},t.loadFromCookie=function(){_(_(this.cookie.getData("custom")||[]).zip(this.cookie.getData("icons")||[])).each(_(function(t){t[0]&&(this.icons[t[0]]=t[1]?this.iconPool.acquireSpecific(t[1]):this.iconPool.acquire(),this.addQuery(t[0]))}).bind(this))},t.getQueries=function(){return _(this.app.queryList.list).select(function(t){return t.actsLikeCustom()})},t.checkFull=function(t){var e=this.getQueries().length>=this.maxCategories,i=$(".nearby-form");return e?i.addClass("disabled"):i.removeClass("disabled"),e},t.checkExists=function(t){t=t.toLowerCase();var e=_(this.getQueries()).select(function(e){return e.name.toLowerCase()==t}).length,i=$(".nearby-form");return e&&(i.addClass("exists"),_(function(){i.removeClass("exists")}).delay(1e3)),e},t.checkInternal=function(t){t=t.toLowerCase();var e=_(this.app.queryList.list).select(function(e){return e.name.toLowerCase()==t})[0];return e},t.refresh=function(){this.container&&(this.container.empty(),_(this.getQueries()).each(_(function(t){var e=this.app.amenityManager.getResultSet(t.name),i=t.name+": ",n="<div class='nearby-remove'><div></div></div><div class='nearby-dot "+t.icon_base+"'></div>",s=$(this.app.resultPanels.getItemHtml("custom_"+t.name,{pt1:i,pt2:e&&e[0]?e[0].name:"",extraClass:"highlight custom-search",extra:n}));this.container.append(s),s.find(".nearby-remove").click(_(function(e){this.removeQuery(t.name),e.stopPropagation()}).bind(this)),e&&s.click(_(this.showCategory).bind(this,t,e))}).bind(this)),this.container.find(".menu-item:last").addClass("last"))},t.showCategory=function(t,e){var i=t.name,n=supersluggify(i),s=removeMoreAmenitiesLink?null:"http://www.walkscore.com/nearby/"+this.app.geoData.getUrlifiedLocation()+"/active="+n,a=t.isCustom()?this.panels[i]:this.app.resultPanels.getPanel(i);this.app.resultPanels.showCard({type:"amenities",array:e,itemHtmlFunc:this.app.resultPanels.getAmenityItemHtmlFunc(a.slug),startIndex:0,backLabel:null,title:i,stub:n,morePt1:"More "+i,category:i,panel:a,moreLink:s,isCustom:!0}),this.in_cat_dive=!0},t.handleCatDiveExit=function(){this.app.map.onlyShowCustomCats(),this.in_cat_dive=!1},t.getIcon=function(t){return this.icons[t]?this.icons[t]:this.icons[t]=this.iconPool.acquire()},t.removeIcon=function(t){this.iconPool.release(this.icons[t]),delete this.icons[t]},t.addQuery=function(t){if(t=htmlToText(t),!this.checkFull()&&!this.checkExists(t)){this.app.map.mod_do("handleNewCategory")();var e=this.checkInternal(t);if(e&&e.icon)e.icon_base=e.icon.replace(".png",""),e.showOnCustomCard=!0,this.refresh();else{var i=this.getIcon(t),e=new AmenityQuery({service:have_google?"PlacesTextSearch":"Bing",name:t,search:[t],icon:i,short_name:""},"",!0);e.icon_base=i,this.app.queryList.addQuery(e),this.amenityService.runQuery(e,_(this.onQueryCompleted).bind(this))}this.updateCookie(),this.checkFull()}},t.onQueryCompleted=function(t){this.app.amenityManager.makeAmenitiesFromRawResults(t);var e=t.query.name,i=this.app.amenityManager.getResultSet(e);this.app.map.showAmenityMarkers(e,i);var n=this.app.resultPanels;this.panels[e]=new AmenityPanel(n,e,n.geoData),this.panels[e].amenities=i,this.is_active&&this.app.map.onlyShowCustomCats(),this.refresh()},t.removeCurrentQuery=function(){var t=this.app.map.lastSelected;t&&this.removeQuery(t.displayQuery.name)},t.removeQuery=function(t){var e=this.app.queryList.getQueryByName(t),i=this.app.amenityManager.getResultSet(t);if(e.isCustom()){this.app.map.removeAmenityMarkers(t,i),this.app.queryList.removeQuery(e),this.removeIcon(t),delete this.panels[t],this.active=_(this.active).reject(function(e){return e==t});var n=_(function(){this.in_cat_dive&&($(".header > .button.back").click(),_(n).delay(100))}).bind(this);n()}else e.showOnCustomCard=!1;this.is_active&&this.app.map.onlyShowCustomCats(),this.updateCookie(),this.refresh(),this.checkFull()},t.updateCookie=function(){var t=_(this.getQueries()).map(function(t){return t.name});this.active||(this.active=this.cookie.getData("active")||[]);var e=_(this.active||[]).reduce(function(t,e){return t[e]=!0,t},{});_(t).each(_(function(t){e[t]||this.active.push(t)}).bind(this)),this.cookie.addData("custom",t),this.cookie.addData("active",this.active),this.cookie.addData("icons",_(t).map(_(function(t){return this.icons[t]}).bind(this))),this.cookie.save()}}();var startApp=app_loader(function(){if(isIE6())return showMessage("Internet Explorer 6 is not supported. Please upgrade your browser to the latest version of Internet Explorer, or download <a href='http://www.mozilla.com/' target='_blank'>Firefox</a> or <a href='http://www.google.com/chrome/' target='_blank'>Chrome</a>.");var t=initGeoDataFromURL();window.app=window.amenityMapApp=new AmenityMapApp(t,dataFetcher)});_(window.google).spelunk(["maps","Map"])&&google_ready(),_(startApp).defer(),$.browser.msie&&$(window).unload(function(){for(key in window)try{"location"!=key&&(window[key]=null)}catch(t){}});