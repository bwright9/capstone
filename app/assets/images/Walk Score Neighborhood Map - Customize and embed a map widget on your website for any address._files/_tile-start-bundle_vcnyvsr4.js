function DataSourceManager(t){this.app=t,this.init()}function AmenityQuery(t,e,i,n){i||(i=t.isCustom);var s={service:safeString,api:safeString,name:safeString,id:safeString,search:null,icon:safeString,short_name:safeString,exceptions:function(t){return t?_(t).map(function(t){return t.toLowerCase()}):null},includes:_(function(t){return t?_(t).map(_(function(t){return new AmenityQuery(t,e,i,this)}).bind(this)):null}).bind(this),weights:null};for(key in s){var o=s[key];this[key]=o?o(t[key]):t[key]}this.isCustomQuery=i,this.groupName=defaultIfNotSet(e,null),this.isChild=this.parentQuery=function(){return n}}function AmenityService(t){this.app=t,this.dataSourceManager=t.dataSourceManager.setAmenityService(this),this.cache=new SimpleCache,this.queue=new ActionQueue,this.localCache=new LocalCache("_ws_amenity_cache"),this.curationCache=new LocalCache("_ws_curation_cache"),this.activeCount=0,this.targetResultSetSize=8,this.countDownLists=[],this.requestsOut={},this.populateCache=function(t){for(var e in t)t.hasOwnProperty(e)&&this.cache.put(e,t[e])},this.q_d=function(t,e){return this.dataSourceManager.dispatch(t.getService(),e)},this.INITIAL_CURATED_QUERY_RANGE=5e3,this.setTargetResultSetSize=function(t){this.targetResultSetSize=t},this.setLocation=function(t){this.geoData=t,this.localCache.setLocation(t),this.noAmenityLocalStorage||this.populateCache(this.localCache.fetch()||{})},this.isIdle=function(){return 0==this.activeCount&&0==this.queue.length()},this.runQueryListFromServer=function(t){var e=t.list,i=t.update,n=t.complete,s={},o=0,a=_(function(r){r||(r={});var u={};if(_(e.list).each(_(function(e){s[e.name]||(d=r[e.name],d?(s[e.name]=!0,e.api||(e=(e.includes||[])[0]),i(new RawResults(d,e).filterOutExceptions(this.q_d(e,"nameFinder")))):e.isChild()||e.isCustomQuery||t.cat&&e.name!=t.cat||_(e.search).each(function(t){u[[t,e.name].join("|")]=!0}))}).bind(this)),_(u).keys().length&&!o++){var l=this.geoData.latLng,c=({score:"scoring",travelQueries:"tile-travel",commercialQueries:"tile-commercial"}[e.groupName]||"display",{req:_(_(u).keys()).join(","),lat:l.lat(),lng:l.lng(),n:this.app.amenityManager.resultSetCap});$.ajax({url:"/auth/score/amenities-by-cid",data:c,dataType:"json",type:"GET",timeout:6e4,success:_(a).bind(this),error:_(a).bind(this,null)})}else n&&n()}).bind(this);a(window._amenity_prepop),window._amenity_prepop=null},this.runQueryList=function(t,e,i){return this.app.serverQueries?this.runQueryListFromServer({list:t,update:e,complete:i}):(t.getGroupName()&&i&&this.countDownLists.push(new CountDownHash(_(t.getNonemptyQueries()).map(function(t){return t.getName()}),i)),void _(t.getNonemptyQueries()).each(_(function(t){this.runQuery(t,e,!0)}).bind(this)))},this.runQuery=function(t,e,i){i||_(t.includes||[]).each(_(function(t){this.runQuery(t,e)}).bind(this)),t.getService()&&(this.queue.add(t,e),0==this.activeCount&&this.runNextQuery())},this.runNextQuery=function(){if(this.queue.length()>0){var t=this.queue.getCurrentData();if(this.q_d(t,"is_ready")()){var e=this.queue.getCurrentCallback();this.queue.removeCurrent(),this.activeCount++,this.q_d(t,"fetch")(t,e)}}},this.handleResults=function(t,e,i){t.filterOutExceptions(i),e(t),this.activeCount--;var n=t.getQuery().getName();_(this.countDownLists).each(function(t){t(n)}),"Google"!=t.getService()&&0!=this.activeCount||this.runNextQuery(),this.isIdle()&&!this.noAmenityLocalStorage&&this.localCache.store(this.cache.data)},this.fetchCuratedPlaceData=function(t,e,i){var n=this.curationCache.setLocation(t).fetch();return n&&n.range>=e?(this.curationCache.store(n),void i(n.data)):void i()}}function ActionQueue(){this.list=[]}function RawResults(t,e){this.results=t,this.query=e}function CityGridHelper(){this.getAmenityData=_(function(t,e,i){if(!e.cgLookupDone&&null!=e.phoneNumber&&!e._cgCallback){e._cgCallback=i;var n=(t.getBounds(),"/data/get-citygrid-data.php?phone="+encodeURI(cleanNumber(replaceAll(e.phoneNumber,"#"," ")))),s=e;$.ajax({url:n,type:"GET",success:_(function(t){this.resultsCallback(t,s)}).bind(this),error:_(function(){this.resultsCallback("",s)}).bind(this)})}}).debounce(100),this.resultsCallback=function(t,e){var i={};t&&t.locations&&t.locations.length&&(i.rating=_(t.locations[0]).spelunk(["review_info","overall_review_rating"]),i.url=_(t.locations[0]).spelunk(["urls","profile_url"]),i.url&&(i.url+="?publisher=10000001955")),e._cgCallback(e,i)},this.getReviewsHtml=function(t,e,i){return t&&t.url?'<div class="iw-reviews"><div class="reviews-text"><a><div class="popout dark"></div>Read reviews</a></div></div>':i?'<div class="iw-reviews"></div>':'<div class="iw-reviews"><div class="unlinked-reviews-text">No reviews found.</div></div>'}}function YelpHelper(){this.getAmenityData=_(function(t,e,i){if(!e.yelpLookupDone&&null!=e.phoneNumber&&!e._yelpCallback){var n=_(function(n){if(!e.phoneNumber&&!n)return i(e,null);e._yelpCallback=i;var s=(t.getBounds(),"/auth/places/v1/get-yelp-data?phone="+encodeURI(cleanNumber(replaceAll(e.phoneNumber||n||"","#"," ")))),o=e;$.ajax({url:s,type:"GET",success:_(function(t){this.resultsCallback(t,o)}).bind(this),error:_(function(){this.resultsCallback("",o)}).bind(this)})}).bind(this);""==e.phoneNumber&&e.fetchPhone&&e.reference?e.fetchPhone(e.reference,n):n()}}).debounce(100),this.resultsCallback=function(t,e){var i=t&&""!=t&&t.businesses&&0!=t.businesses.length?t.businesses[0]:null;e._yelpCallback(e,i)},this.getReviewsHtml=function(t,e,i){if(i){if(!t)return'<div class="iw-reviews"></div>';var n=[];return n.push('<div class="iw-reviews">'),n.push('<img class="ratings-image" src="'+t.rating_img_url_small+'"/>'),n.push("</div>"),n.join("")}if(!t)return'<div class="iw-reviews">No reviews found.</div>';var n=[];return n.push('<div class="iw-reviews"><img class="ratings-image" src="'+t.rating_img_url_small+'"/>'),n.push('<div class="reviews-text"><a><div class="popout dark"></div>Read reviews</a></div>'),n.join("")},this.getImageUrl=function(t){if(t){var e=t.photo_url||t.image_url;if(e&&-1==e.indexOf("static")&&-1==e.indexOf("blank")&&-1==e.indexOf("default_avatars"))return e}return null}}function LocalAmenityService(){}function BoxCachedAmenityMixin(t,e){t.withBounds=function(t,e){return this._withBounds(t,e),this},BoxCacheMixin(t,e),t._init=function(t){this.app=t},t._withBounds=function(t,e){if(this._inRequest)return _(_(this._withBounds).bind(this,t,e)).delay(1e3);this._inRequest=!0;var i=[],n=this._boxSetForBounds(t),s=n.length,o=_(function(){delete this._inRequest,e(this._results=i)}).bind(this),a=function(t){t&&t.length&&(i=i.concat(t)),--s||o()};if(s)for(;n.length;)this._withBox(n.shift(),a);else o()},t._fetchBox=function(t,e){$.ajax({url:this._URL,type:"GET",dataType:"json",data:{lat:t[0],lng:t[1]},success:e,error:_(e).bind(this,null)})},t._processBoxData=function(t){return t}}function CarShareService(t){this._init(t)}function ParksService(t){this._init(t)}function DataFetcher(t){this.setProfile=function(t){this.profile=window.wst_profile||t},this.setProfile(t),ensureWSUnderscoreMixins(),this.reqDefs={isRankingsCity:"irc",cityUserRank:"ur",hoodInfo:"hi",compareData:"cd",scoreQueries:"sq",overviewQueries:"oq",customQueries:"cq",commercialQueries:"tcq",travelQueries:"ttq",transitScore:"ts",walkScore:"ws",walkScoreDetails:"wsd"},this.replyDefs={irc:"isRankingsCityAvailable",ur:"cityUserRankAvailable",hi:"hoodInfoAvailable",cd:"compareDataAvailable",sq:"scoreQueriesAvailable",oq:"overviewQueriesAvailable",cq:"customQueriesAvailable",tcq:"commercialQueriesAvailable",ttq:"travelQueriesAvailable",ts:"transitScoreAvailable",ws:"walkScoreAvailable",wsd:"walkScoreDetailsAvailable"},this.queuedRequests=new Array,this.hasRunDeferredRequests=!1,this.isFirstBatch=!0,this.responseCache=(new LocalCache).setDefault({}),this.request=function(t,e){this.hasRunDeferredRequests&&e?this.addToQueue(t)&&this.runRequestsInternal(this.reqDefs[t],e):this.addToQueue(t)},this.addToQueue=function(t){return _.isUndefined(this.reqDefs[t])||_(this.queuedRequests).detect(function(e){return e==t})?!1:(this.queuedRequests.push(t),!0)},this.runDeferredRequests=function(t){this.hasRunDeferredRequests=!0;var e=_(this.queuedRequests).map(_(function(t){return this.reqDefs[t]}).bind(this)).join(",");this.runRequestsInternal(e,t);this.timeout||(this.timeout=_.delay(_(this.deferredRequestsTimeout).bind(this,e),6e3))},this.requestPrivate=function(t,e,i){this.privateContinuation=i,this.runRequestsInternal(this.reqDefs[t],e)},this.runRequestsInternal=function(t,e){var i=t.split(","),n=_(function(e){this.handleResponse(_(_(e).slice(i)).trim()),t=_(i).reject(function(t){return e[t]}).join()}).bind(this);if(this.responseCache.setKey("_ws_data_"+this.profile).setLocation(e),n(window._get_data_prepop||{}),n(this.responseCache.fetch()),t){var s=this,o=t,a=e.getCity(),r=e.getAdminArea(),u=(e.getTransitScoreCity(),"walkscore"!=this.profile?"&profile="+this.profile:"");a=this.fixNYBoroughs(a,r);var l="/auth/score/get-data?req="+encodeURI(o)+"&lat="+encodeURI(e.getLat())+"&lng="+encodeURI(e.getLng())+u;$.ajax({url:l,type:"GET",dataType:"json",success:function(t){s.receiveData(t)},error:_(function(){_(i).include("ts")?(this.handleResponse({ts:null}),this.runRequestsInternal(_(i).reject(function(t){return"ts"==t}).join(","),e)):s.receiveData(null)}).bind(this)})}},this.receiveData=function(t){clearTimeout(this.timeout),t&&this.handleResponse(t)},this.handleResponse=function(t){var e=this.responseCache.fetch();_(e).extend(t),this.responseCache.store(e);for(var i in t)this.privateContinuation?this.privateContinuation(e[i]):appEvents.fireEvent(null,this.replyDefs[i],[e[i]]),this.dequeueRequest(i,e)},this.dequeueRequest=function(t,e){for(var i in this.queuedRequests)this.reqDefs[this.queuedRequests[i]]==t&&this.queuedRequests.splice(i,1);this.isFirstBatch&&_(this.queuedRequests).isEmpty()&&(this.isFirstBatch=!1,appEvents.fireEvent(null,"dataRequestsComplete",[e]))},this.deferredRequestsTimeout=function(t){this.isFirstBatch&&(this.isFirstBatch=!1,appEvents.fireEvent(null,"dataRequestsComplete"))},this.fetchWalkScore=function(t,e,i,n){_({ws:"walkScoreAvailable",wsd:"walkScoreDetailsAvailable"}).each(function(t,e){appEvents.addListener(t,i)}),this.request(n?"walkScoreDetails":"walkScore",new GeoData("",new ws.LatLng(t,e)))},this.fixNYBoroughs=function(t,e){return fixNYBoroughs(t,e)}}function QueryList(t,e){this.groupName=defaultIfNotSet(e,null),this.list=[],this.by_name={},this.addQuery=function(t){this.list.push(t),this.by_name[t.getName()]=t,_(t.includes||[]).each(_(function(e){this.addQuery(e),t.getService()||"Local"!=e.getService()||(t.service="Local")}).bind(this))},this.removeQuery=function(t){var e=t.name;this.list=_(this.list).reject(function(t){return t.name==e}),delete this.by_name[e]},this.length=function(){return this.list.length},this.getAllQueries=function(){return this.list},this.getGroupName=function(){return this.groupName},this.getQuery=function(t){return this.list[t]},this.getQueryByName=function(t){return this.by_name[t]},this.getNonemptyQueries=function(){return _(this.list).select(function(t){return t.getService()})},_.isUndefined(t)||_(t.amenity_categories).each(_(function(t){this.addQuery(new AmenityQuery(t,e))}).bind(this))}function bindArguments(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);return function(){return t.apply(this,e)}}function WSEvent(){this.evts=[],this.builtinEvts=[]}function WalkScoreCore(t,e,i,n,s){this.profile=t,this.dataFetcher=e,this.amenityService=i,this.geocoder=n,this.optionFlags=defaultIfNotSet(s,{}),this.scorer=null,this.geoData=null,this.score=null,this.fromCookie=!1,this.scoringComplete=!1,this.dataFetchesComplete=!1,this.init=function(t,e){this.geoData=t,appEvents.addListener("dataRequestsComplete",this.onDataRequestsComplete,this);var i=this.app&&this.app.doesGeolocation&&""==this.geoData.query;this.coreCookie=!e||i||DEBUG_BLOCK_COOKIE?null:new CoreCookie(e,getLocationKey(this.geoData)),this.coreCookie&&this.coreCookie.hasData()?(this.fromCookie=!0,this.geoData.fillDataFromGeoData(this.coreCookie.getGeoData()),_(_(function(){this.geocodeComplete(),this.onScoringCompleted(this.coreCookie.getScore())}).bind(this)).defer()):(this.coreCookie&&this.coreCookie.deleteCookie(),this.geocoder.autoFillPartialGeoData(this.geoData,bindCallback(this,this.geocodeComplete)))},this.geocodeComplete=function(){return null==this.geoData.latLng?void appEvents.fireEvent(null,"coreGeocodeFailed",[this.geoData]):(this.amenityService.setLocation(this.geoData),appEvents.fireEvent(null,"coreGeocode",[this.geoData]),this.fromCookie||(this.scorer=new Scorer(this),this.scorer.scoreLocation(this.geoData,bindCallback(this,this.onScoringCompleted),bindCallback(this,this.onScoreDetailsReceived))),void this.dataFetcher.runDeferredRequests(this.geoData))},this.onScoringCompleted=function(t){appEvents.fireEvent(null,"scoreCompleted",[t]),this.score=t,this.scoringComplete=!0,this.checkAllServicesCompleted()},this.onScoreDetailsReceived=function(t){appEvents.fireEvent(null,"scoreDetails",[t])},this.onDataRequestsComplete=function(){this.dataFetchesComplete=!0,this.checkAllServicesCompleted()},this.checkAllServicesCompleted=function(){this.coreCookie&&!this.fromCookie&&this.geoData.hasData()&&this.scoringComplete&&this.dataFetchesComplete&&this.coreCookie.save(this.geoData,this.score)},this.request=function(t,e){this.dataFetcher.request(t,e)},this.getGeocoder=function(){return this.geocoder},this.getAmenityService=function(){return this.amenityService},this.getScorer=function(){return null==this.scorer&&(this.scorer=new Scorer(this)),this.scorer}}function GoogleGeocoder(){}function Geocoder(){ensure_ws(),this.geocoding=!1;var t=new GoogleGeocoder;this.isGeocoding=function(){return this.geocoding},this.confirmSuccess=function(){this.geocoding=!1,clearTimeout(this.geoTimeout)},this.timeOut=function(){this.geocoding=!1,clearTimeout(this.geoTimeout)},this.autoFillPartialGeoData=function(t,e){var i=_(function(){appEvents.fireEvent(null,"coreGeocodeFailed",[this.geoData]),this.failHandler?this.failHandler("Failed to find the specified location"):dbug("Failed to find your location")}).bind(this);if(this.autoFillCallback_func=e,this.autoFillTarget=t,DEBUG_AUDIT_GEOCODE&&(dbug("auto geocode for geoData with:"),dbug("query: "+t.getQuery()),dbug("latlng: "+dumpGLL(t.getLatLng()))),t.latLng){var n=!0;t.locBase==t.LOCBASE_GEOCODE_FROM_SERVER?n=!1:t.query.length>0?(t.locBase=t.LOCBASE_REVERSE_GEOCODE_WITH_ADDRESS_OVERRIDE,DEBUG_AUDIT_GEOCODE&&dbug("locBase: LOCBASE_REVERSE_GEOCODE_WITH_ADDRESS_OVERRIDE")):(t.locBase=t.LOCBASE_REVERSE_GEOCODE,DEBUG_AUDIT_GEOCODE&&dbug("locBase: LOCBASE_REVERSE_GEOCODE")),n?this.reverseGeocode(t.getPreSnapLatLng(),bindCallback(this,this.autoFillCallback)):this.autoFillCallback(t)}else if(t.query.length>0)t.locBase=t.LOCBASE_GEOCODE,DEBUG_AUDIT_GEOCODE&&dbug("locBase: LOCBASE_GEOCODE"),this.geocode(t.query,bindCallback(this,this.autoFillCallback));else{if(!this.tryCurrentLocation||!navigator.geolocation)return i(),!1;try{t.locBase=t.LOCBASE_REVERSE_GEOCODE,window.ws_map_splash&&ws_map_splash(),_(locate_to_accuracy_for_seconds(150,10,_(function(t){this.reverseGeocode(new ws.LatLng(t.coords.latitude,t.coords.longitude),bindCallback(this,this.autoFillCallback))},i).bind(this))).defer()}catch(s){return!1}}return!0},this.autoFillCallback=function(t){if(this.autoFillTarget){t&&this.autoFillTarget.fillDataFromGeoData(t);var e=this.autoFillTarget.locBase}if(this.autoFillTarget&&t&&isEmptyString(this.autoFillTarget.getThoroughfare())&&e==this.autoFillTarget.LOCBASE_GEOCODE)DEBUG_AUDIT_GEOCODE&&dbug("...didn't get a thoroughfare.  Running reverse geocode for more info."),DEBUG_AUDIT_GEOCODE&&dbug("reverse geo on : "+dumpGLL(this.autoFillTarget.getLatLng())+"(locBase now set to LOCBASE_GEOCODE_PLUS_REVERSE)"),this.autoFillTarget.locBase=this.autoFillTarget.LOCBASE_GEOCODE_PLUS_REVERSE,this.reverseGeocode(this.autoFillTarget.getPreSnapLatLng(),bindCallback(this,this.autoFillCallback));else{var i=this.autoFillCallback_func,n=this.autoFillTarget;this.autoFillCallback_func=null,this.autoFillTarget=null,DEBUG_AUDIT_GEOCODE&&dbug("final latlng after geocoding: "+dumpGLL(n.getLatLng())),i&&i(n)}},this.geocode=function(e,i){this.geocoding=!0,this.callback_func=i,this.activeQuery=e,t.geocode({address:e},_(this.geocodeReturn).bind(this)),this.geoTimeout=setTimeout(bindCallback(this,this.timeOut),15e3)},this.reverseGeocode=function(e,i){this.geocoding=!0,this.callback_func=i,this.activeQuery="",t.geocode({latLng:e},_(this.geocodeReturn).bind(this)),this.geoTimeout=setTimeout(bindCallback(this,this.timeOut),15e3)},this.geocodeReturn=function(t){this.activeQuery="",this.callback_func(geoDataFromGoogleResponse(t,this.activeQuery)),this.geocoding=!1}}function Scorer(t){this.walkScoreCore=t,this.dataFetcher=t.dataFetcher,this.amenityService=t.amenityService,this.amenityManager=t.amenityManager,this.geoData=t.geoData,this.SCOREBASE_JS=10,this.SCOREBASE_API=11,this._get_walk_shed=1==this.walkScoreCore.optionFlags.walk_shed,this.getScore=function(){return this.walkScore},this.isFinalScore=function(){return this.scoringCompleted},this.scoreLocation=function(t,e,i){this.geoData=t,this.completionCallback=e,this.scoreDetailsCallback=i,this.scoreBase=this.SCOREBASE_JS,this.snappedLatLng=new ws.LatLng(snapToGrid(t.getLat()),snapToGrid(t.getLng())),DEBUG_AUDIT_GEOCODE&&dbug("snapped latlng for scoring: from "+dumpGLL(t.getLatLng())+" to "+this.snappedLatLng),this.scoringCompleted=!1,this.walkScore=0,this.dataFetcher.fetchWalkScore(this.snappedLatLng.lat(),this.snappedLatLng.lng(),bindCallback(this,this.receiveFromWSAPI),this.walkScoreCore.optionFlags.getScoreDetails)},this.receiveFromWSAPI=function(t){t=(t||[])[0]||{},null!=t.walkscore?(this.scoreBase=this.SCOREBASE_API,this.scoringCompleted=!0,this.walkScore=t.walkscore,this.completionCallback(this.walkScore),this.scoreDetailsCallback&&t.scoredetails&&this.scoreDetailsCallback(t)):this.scoreDetailsCallback(null)}}function CoreCookie(t,e){this.cookie=new BasicCookie(t,e),this.hasData=function(){return this.cookie.hasData()},this.getScore=function(){return this.cookie.getData("score")},this.getGeoData=function(){return this.cookie.getGeoData("geoData")},this.save=function(t,e){this.cookie.addGeoData("geoData",t),this.cookie.addData("score",e),this.cookie.save()},this.deleteCookie=function(){this.cookie.deleteCookie()}}function RoutingService(){this.routesPerRequest=4,this.queue=new ActionQueue,this.progressPtr=0,this.cache=new SimpleCache,this.gdirections=new google.maps.DirectionsService,this.setDefaultStart=function(t){this.start=t},this.queueRoute=function(t,e,i,n,s){if(!_(this.queue.list).detect(function(e){return e.data.id&&e.data.id==t})){if(!s)var s={};s.id=t,s.start=e,s.end=i,this.queue.add(s,n)}},this.runQueuedRequests=function(){for(var t=[];this.progressPtr<this.routesPerRequest&&this.progressPtr<this.queue.length();){var e=this.queue.getDataAt(this.progressPtr),i=this.cache.get(e.id);if(i){var n=this.queue.getCallbackAt(this.progressPtr);n(i,e),this.queue.removeAt(this.progressPtr)}else t.push(e.start),t.push(e.end),this.progressPtr++}if(this.progressPtr>0){var s=this.start.ws_coerce("google"),o={origin:s,destination:s,travelMode:google.maps.TravelMode.WALKING,waypoints:_(t).map(function(t){return{location:t.ws_coerce("google")}})},a=_(this.onGoogDirectionsReceived).bind(this);this.gdirections.route(o,a)}},this.onGoogDirectionsReceived=function(t,e){var i=google.maps.DirectionsStatus.OK==e?t.routes[0].legs.slice(1):[],n=i.length;if(n!=2*this.progressPtr)dbug("WRONG NUMBER OF ROUTES returned from goog");else{for(var s=0;s<this.progressPtr;s++){var o=i[2*s],a=this.getPolylineFromRoute(o),r=this.queue.getDataAt(s),u=this.queue.getCallbackAt(s);u(a,r),this.cache.put(r.id,a)}this.queue.removeAt(0,this.progressPtr),this.progressPtr=0,this.runQueuedRequests()}},this.getPolylineFromRoute=function(t){for(var e=t.steps.length,i=[],n=0;e>n;n++)i.push(t.steps[n].start_location);return i.push(t.end_location),new google.maps.Polyline({path:i,strokeColor:"blue",strokeOpacity:.45,strokeWeight:5})},this.getCachedRoute=function(t){return this.cache.get(t)}}function AmenityMap(t){this.app=t,this.dataSourceManager=(t||{}).dataSourceManager,this.cache=new SimpleCache,this.DEFAULT_ZOOM=AmenityMap.DEFAULT_ZOOM}function SecondaryMap(){}function GoogleMap(t){this.app=t,this.div_id="google-map-element"}function WalkShedService(){}!function(t){if(!jQuery.browser){jQuery.browser={},jQuery.browser.mozilla=!1,jQuery.browser.webkit=!1,jQuery.browser.opera=!1,jQuery.browser.msie=!1;var e=navigator.userAgent;jQuery.browser.name=navigator.appName,jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10);var i,n,s;-1!=(n=e.indexOf("Opera"))?(jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=e.substring(n+6),-1!=(n=e.indexOf("Version"))&&(jQuery.browser.fullVersion=e.substring(n+8))):-1!=(n=e.indexOf("MSIE"))?(jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer",jQuery.browser.fullVersion=e.substring(n+5)):-1!=(n=e.indexOf("Chrome"))?(jQuery.browser.webkit=!0,jQuery.browser.name="Chrome",jQuery.browser.fullVersion=e.substring(n+7)):-1!=(n=e.indexOf("Safari"))?(jQuery.browser.webkit=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=e.substring(n+7),-1!=(n=e.indexOf("Version"))&&(jQuery.browser.fullVersion=e.substring(n+8))):-1!=(n=e.indexOf("Firefox"))?(jQuery.browser.mozilla=!0,jQuery.browser.name="Firefox",jQuery.browser.fullVersion=e.substring(n+8)):(i=e.lastIndexOf(" ")+1)<(n=e.lastIndexOf("/"))&&(jQuery.browser.name=e.substring(i,n),jQuery.browser.fullVersion=e.substring(n+1),jQuery.browser.name.toLowerCase()==jQuery.browser.name.toUpperCase()&&(jQuery.browser.name=navigator.appName)),-1!=(s=jQuery.browser.fullVersion.indexOf(";"))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,s)),-1!=(s=jQuery.browser.fullVersion.indexOf(" "))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,s)),jQuery.browser.majorVersion=parseInt(""+jQuery.browser.fullVersion,10),isNaN(jQuery.browser.majorVersion)&&(jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10)),jQuery.browser.version=jQuery.browser.majorVersion}}(jQuery),function(){var t={};window.ListenerMixin=t.exports=function(t){t._addListener=function(t,e){return this.listeners||(this.listeners={}),this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),this},t.on=t._addListener,t._alertListeners=function(t,e){for(var i=((this.listeners||{})[t]||[]).slice(),n=0;n<i.length;n++)i[n](e)},t.emit=t._alertListeners,t._clearListeners=function(t){delete this.listeners[t]}},window.BoxCacheMixin=t.exports=function(t,e){e||(e={});var i=this,n={},s={},o=e.ttl||3e5,a=e.size,r=e.trim||a/4||1,u=0,l=e.buffer||0,c=e.limit||128,h=e.granularity||4;void 0===a&&(a=i.window?64:1024);var d=function(t){return Math.floor(t*h)},p=1/69.04,g=1/45.4;t.boxesInCache=function(){return this._boxesInCache()},t.boxesFetched=function(){return this._boxesFetched},t.boxesHandled=function(){return this._boxesHandled},t.boxCacheSize=function(){return u},t._withBox=function(t,e){this._boxesHandled++;var i=this._namespacedBoxKey(t),a=n[i];if(a&&this._boxIsSufficient(a.data)){if((new Date).getTime()-a.ctime<o)return a.atime=(new Date).getTime(),_(_(e).bind({},a.data)).defer();delete n[a.key],u--}s[i]?s[i].push(e):(s[i]=[e],this._boxesFetched++,this._fetchBox(t,_(this._receiveBox).bind(this,t)))},t._boxIsSufficient=function(){return!0},t._namespacedBoxKey=function(t){var e=t.slice();return this._boxCacheNamespace&&e.unshift(this._boxCacheNamespace),e.join("_")},t._receiveBox=function(t,e){var i=this._namespacedBoxKey(t);if(e=this._processBoxData(e,_(n).spelunk([i,"data"])),a&&!n[i]&&!_(e).isUndefined()&&(n[i]={key:i,data:e,ctime:(new Date).getTime(),atime:(new Date).getTime()},++u>a)){for(var o=_(n).sortBy(function(t){return t.atime}),l=0;r>l;l++)delete n[o[l].key];u-=r,this._boxesEvicted+=r}var c=s[i];delete s[i],_(c).each(function(t){t(e)})},t._boxSetForBounds=function(t){if(!t)return null;for(var e=t.getNorthEast(),i=t.getSouthWest(),n=l*p,s=l*g,o=[],a=d(i.lat()-n);a<=d(e.lat()+n);a+=1)for(var r=d(i.lng()-s);r<=d(e.lng()+s);r+=1)if(o.push([a/h,r/h]),o.length>c)return console.log("Cache box limit exceeded",i.lat(),i.lng(),e.lat(),e.lng()),[];return o},t._boxSetFingerprint=function(t){return _(t).flatten().join("_")},t._resetCounts=function(){this._boxesHandled=0,this._boxesFetched=0,this._boxesEvicted=0},t._boxesInCache=function(){return _(n).keys()}},window.ws_simple_init=t.exports=function(){return function(t,e){t||(t={}),e||(e=[]);for(var i=0;i<e.length;i++)if(void 0===t[e[i]])throw"Missing "+e[i]+" in init.";for(var n in t)this[n]=t[n]}}(),window.RentalsAddThis=t.exports=function(){var t=function(t){this._init(t)},e=t.prototype;return e.start=function(){return this._start(),this},e.whenReady=function(t){return this._queue.push(t),this._flush(),this},e._init=function(t){this.app=t,this._queue=[],window.addthis&&this._goodToGo()},e._start=function(){},e._loadAddThisJS=function(){this._didLoad=!0,$.getScript("//s7.addthis.com/js/250/addthis_widget.js#pubid=ra-4ea87059456ece80",_(function(t,e,i){this._goodToGo()}).bind(this))},e._goodToGo=function(){this._didLoad=this._ok=!0,this._flush()},e._flush=function(){if(!this._didLoad)return this._loadAddThisJS();if(this._ok){var t=this._queue;this._queue=[],_(t).each(function(t){t()})}},t}();var e=t.exports=function(){var t={maps:{}},e=function(t,e,i){t.ws_with=function(t,e){var n=this.coerced||(this.coerced={});i.call(this,t,function(i){e(n[t]||(n[t]=i))})},e&&(t.ws_coerce=function(t){var e;return this.ws_with(t,function(t){e=t}),e})},i=function(t,e,i){return t._ws_={app:e.app,amenity:e.amenity,idol:e,id:i||e.id},t};return t.maps.LatLng=function(t,e){this.lat_=t,this.lng_=e},function(){var i=t.maps.LatLng.prototype;i.lat=function(t){return this._acc("lat_",t)},i.lng=function(t){return this._acc("lng_",t)},i.toUrlValue=function(t){return""+this.lat_+","+this.lng_},i._acc=function(t,e){return _(e).isUndefined()||(this[t]=e-0),this[t]},e(i,!0,function(t,e){e({google:function(t,e){return new google.maps.LatLng(t,e)}}[t](this.lat_,this.lng_))});var n=function(){var t=function(t){return t*Math.PI/180};return function(e,i){var n=6371,s=t(i.lat()-e.lat()),o=t(i.lng()-e.lng()),a=Math.sin(s/2)*Math.sin(s/2)+Math.cos(t(e.lat()))*Math.cos(t(i.lat()))*Math.sin(o/2)*Math.sin(o/2),r=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),u=n*r;return u.toFixed(3)}}();i.distanceFrom=function(t){return 1e3*n(this,t)}}(),t.maps.Marker=function(t){this._init(t)},function(){var n=t.maps.Marker.prototype;n._init=function(t){ws_simple_init.call(this,t),_(t.visible).isUndefined()&&(this.visible=!0)},n.setPosition=function(t){this.position=t,_(this.coerced).each(function(e,i){e.setPosition(t.ws_coerce(i))})};var s=function(t){var e=i(new google.maps.Marker({position:this.position.ws_coerce("google"),icon:_(this).spelunk(["amenity","badgeIcon"])||this.icon}),this);this.zIndexGroup&&e.setZIndexGroup(this.zIndexGroup),this.clickHandler&&google.maps.event.addListener(e,"click",this.clickHandler),t(e)};e(n,!0,function(t,e){({google:s})[t].call(this,e)})}(),t.maps.InfoWindow=function(t){this._init(t)},function(){var n=t.maps.InfoWindow.prototype,s=function(){var t=0;return function(){t++||($("head").append("<link />"),$("head").children(":last").attr({rel:"stylesheet",type:"text/css",href:"//cdn2.walk.sc/2/css/miniwindow_vcnyvsr4.css"}))}}();n._init=function(t){s(),ws_simple_init.call(this,t),this.classes||(this.classes=[])},n.setContent=function(t){this.content=t},n.setOptions=function(t){t.content&&(this.content=t.content),t.classes&&(this.classes=t.classes),$.browser.msie&&($.browser.version>=8&&this.addClass("IE8"),$.browser.version<8&&this.addClass("IE7"),$.browser.version<7&&this.addClass("nonub"))},n.setPosition=function(t,e,i){this.position=t},n.setOffset=function(t,e){this.offset_x=t,this.offset_y=e},n.addClass=function(t){return this.removeClass(t),this.classes.push(t),this},n.removeClass=function(t){return this.classes=_(this.classes).reject(function(e){return e==t}),this},n.makeDiv=function(){var t="ws_miniwindow_body "+(this.isSmall?"small":"large"),e=$("<div />",{"class":"ws_miniwindow"}),i=$("<div />",{"class":t}),n=$("<div />",{"class":"ws_miniwindow_nub"});_(this.classes).each(_(e.addClass).bind(e)),this.div=e.append(i.append(this.content)).append(n);var s=_(_(function(){var t=$(".ws_miniwindow");t[0]?t.unbind().click(_(function(t){t.stopPropagation()}).bind(this)):_(s).delay(50)}).bind(this)).max_attempts(100);return _(s).defer(),this.div};var o=function(t){var e=new MiniWindow({idol:this});this.noOffset||e.setOffset(1,-25),t(i(e,this))};e(n,!0,function(t,e){({google:o})[t].call(this,e)})}(),t.maps.Polyline=function(t){this._init(t)},function(){var n=t.maps.Polyline.prototype;n._init=function(t){ws_simple_init.call(this,t),_(t.visible).isUndefined()&&(this.visible=!0)};var s=function(t){t(i(new google.maps.Polyline({strokeColor:this.strokeColor,path:_(this.path).map(function(t){return t.ws_coerce("google")})}),this))};e(n,!0,function(t,e){({google:s})[t].call(this,e)})}(),t.maps.Polygon=function(t){this._init(t)},function(){var n=t.maps.Polygon.prototype;n._init=function(t){ws_simple_init.call(this,t),_(t.visible).isUndefined()&&(this.visible=!0)};var s=function(t){var e=new google.maps.Polygon(this);this.clickHandler&&google.maps.event.addListener(e,"click",this.clickHandler),t(i(e,this))};e(n,!0,function(t,e){({google:s})[t].call(this,e)})}(),t.maps.LatLngBounds=function(t){this._init(t)},function(){var n=t.maps.LatLngBounds.prototype;n._init=function(t){this.extend(t)},n._toOLArray=function(){return[this._sw.lng(),this._sw.lat(),this._ne.lng(),this._ne.lat()]},n.getNorthEast=function(){return this._ne},n.getSouthWest=function(){return this._sw},n.contains=function(t){return t.lat()>this._sw.lat()&&t.lng()>this._sw.lng()&&t.lat()<this._ne.lat()&&t.lng()<this._ne.lng()},n.extend=function(e){if(e){this._sw&&this._ne||(this._sw=new t.maps.LatLng(e.lat(),e.lng()),this._ne=new t.maps.LatLng(e.lat(),e.lng()));var i=this;return _([["_sw",-1],["_ne",1]]).each(function(t){_(["lat","lng"]).each(function(n){e[n]()*t[1]>i[t[0]][n]()*t[1]&&i[t[0]][n](e[n]())})}),this}};var s=function(t){var e=this._toOLArray();t(i(new google.maps.LatLngBounds(new google.maps.LatLng(e[1],e[0]),new google.maps.LatLng(e[3],e[2])),this))};e(n,!0,function(t,e){({google:s})[t].call(this,e)})}(),t}(),i=t.exports=function(){function t(t){var e="0123456789ABCDEF";return String(e.substr(t>>4&15,1))+e.substr(15&t,1)}function e(e,i,n){return"#"+t(e)+t(i)+t(n)}var i=this,n=i.$||require("./fake-jquery");_=i._||require("./underscore-1.3.3");var s=110900,o=6378137,a=Math.PI/180,r=.0015,u=function(t,e){return[s,Math.cos(t*a)*a*o]},l=function(){try{return!(!ArrayBuffer||!Uint8ClampedArray)}catch(t){return!1}}(),c=function(t,e,i,n){e||(e=[]);var s=_(e).map(function(t){return"set"+t.substr(0,1).toUpperCase()+t.substr(1)});n&&console.log("ChainableSettersMixin",t,e,i),t.setOptions=function(t){return t||(t={}),n&&console.log("setOptions",t),_(_(e).zip(s)).each(function(e){n&&console.log("this["+e[1]+"]("+e[0]+")",this),void 0!==t[e[0]]&&this[e[1]](t[e[0]])},this),this},_.each(_(e).zip(s),function(e){t[e[1]]=function(){var t=this["_"+e[1]]||(this["_"+e[1]]=function(t){i?this[i].call(this,e[0],t):this[e[0]]=t});return t.apply(this,[].slice.call(arguments)),this}})},h={LatLng:function(){var t=function(t,e){this.lat(t),this.lng(e)},e=t.prototype;return e.lat=function(t){return this._v("_lat",t)},e.lng=function(t){return this._v("_lng",t)},e._v=function(t,e){return void 0!==e&&(this[t]=e),this[t]||0},t}(),LatLngBounds:function(){var t=function(t){this._init(t)},e=t.prototype;return e._init=function(t){d.LatLng(e),this.extend(t)},e.getNorthEast=function(){return this._ne},e.getSouthWest=function(){
return this._sw},e.contains=function(t){return t.lat()>this._sw.lat()&&t.lng()>this._sw.lng()&&t.lat()<this._ne.lat()&&t.lng()<this._ne.lng()},e.extend=function(t){if(t){this._sw&&this._ne||(this._sw=new this.LatLng(t.lat(),t.lng()),this._ne=new this.LatLng(t.lat(),t.lng()));var e=this;return _([["_sw",-1],["_ne",1]]).each(function(i){_(["lat","lng"]).each(function(n){t[n]()*i[1]>e[i[0]][n]()*i[1]&&e[i[0]][n](t[n]())})}),this}},t}(),Polygon:function(){var t=function(t){this._init(t)},e=t.prototype;return c(e,["paths"]),e._init=function(t){d.MVCArray(e),this.setOptions(t)},e.getPaths=function(t){return this._paths},e._setPaths=function(t){var e=this.MVCArray;this._paths=new e(_(t).map(function(t){return new e(t)}))},t}(),MVCArray:function(){var t=function(t){this._init(t)},e=t.prototype;return e._init=function(t){this._array=t},e.getArray=function(t){return this._array},t}()},d=_(h).reduce(function(t,e,n){return t[n]=function(t,e){return t||(t={}),t[n]||(t[n]=i.google&&!e?google.maps[n]:h[n]),t[n]},t},{}),p=function(t){var e=function(e){return e?(_({PNAMES:"name",PWEIGHTS:"weighting",PFOLLOWON:"followon"}).each(function(t,n){i[n]||(i[n]=_(e).oreduce(function(e,i){e[i.id]=i[t]}))}),t(i._partnerInfo=e)):t(e)},s=i._partnerInfo;return s?e(s):void n.ajax({url:"/auth/rentals/partners",dataType:"json",success:e,failure:_(e).bind({},null)})},g=function(t){return t.push(t[t.length-1]),t.unshift(t[0]),function(i,n,s){for(var o=1;o<t.length-1&&t[o][0]<i;o++);var a=_([0,1,2,3]).map(function(e){var n=i-t[o-1][0],a=t[o][0]-t[o-1][0],r=s?0:Math.min(n/(a||1),1),u=1-r;return t[o-1][1][e]*u+t[o][1][e]*r});return n?a:e.apply({},a)}},f={makeGatherReqs:function(t,e,i){return function(n,s){var o=this;if(void 0!==s&&!_(n).isObject()){var a=n;n={},n[a]=s}_(o).extend(n);var r=_(t).select(function(t){return void 0!==o[t]});i&&console.log(t,r,_(n).keys()),t.length==r.length&&o[e].call(o)}},CountDownHash:function(t,e){var i={};return _(t).each(function(t){i[t]=!0}),function(t){i[t]&&(delete i[t],_(i).isEmpty()&&e())}},byte2Hex:t,makeGetScoreColor:g,getScoreColor:g([[0,[223,68,51]],[55,[235,237,129]],[75,[173,228,108]],[95,[78,173,66]]]),getHeatmapColor:g([[0,[110,25,41,50]],[20,[241,157,31,100]],[40,[255,213,37,200]],[45,[255,226,44,200]],[50,[255,252,48,200]],[60,[220,252,47,240]],[70,[165,250,43,250]],[75,[137,243,42,245]],[80,[109,234,43,245]],[85,[78,221,44,245]],[90,[45,205,46,255]],[95,[19,193,46,255]],[98,[9,185,48,255]],[100,[4,175,48,255]]]),prepTemplateTree:function(){var t=function(e,i,n){i instanceof Object?e[n]=_(i).oreduce(t):e[n]=_(i).template()};return function(e){return _(e).oreduce(t)}}(),scaleInMeters:u,snapToGrid:function(t,e){return scale=1e6,e||(e=r),e*=scale,t*=scale,t+=e/2,t/=e,t=Math.floor(t),t*=e,t/=scale},makeGetDistWithScale:function(t,e){var i=u(t,e),n=i[0],s=i[1];return function(i){var o=(t-i[0])*n,a=(e-i[1])*s;return Math.sqrt(o*o+a*a)/1609.34}},domainRoundRobinAJAXUrl:function(){var t=0,e=i.window?["ajax1.walkscore.com","ajax2.walkscore.com","ajax3.walkscore.com","ajax4.walkscore.com"]:["calc.walkscore.com"];return function(i){return"https://"+e[t++%e.length]+i}}(),haveArrayBuffer:l,retryAjax:function(){var t=function(e,i,s){e.error=--i?_(t).bind(this,e,i,s):s,n.ajax(e)};return function(e,i){var n=e.error||function(){throw"Could not fetch: "+e.url};t(e,i||3,n)}}(),makeBuffer:function(){var t=null,e=0,i=1<<20,n={"double":8,"float":4,int32:4,uint32:4,uint16:2,int16:2,uint8:1,int8:1};try{var s={"double":Float64Array,"float":Float32Array,uint32:Uint32Array,int32:Int32Array,uint16:Uint16Array,int16:Int16Array,uint8:Uint8Array,int8:Int8Array}}catch(o){var s={}}return function(o,a,r){var u=a||"uint32",c=n[u],h=o*c,d=i-e;if(l&&r){if(h>i)return new s[u](new ArrayBuffer(h));(h>d||!t)&&(t=new ArrayBuffer(i),e=0);for(var p=0;!f&&4>p;)try{f=new s[u](t,e+p,o)}catch(g){p++}return e+=h+p,f}for(var f=new Array(o),m=0;o>m;m++)f[m]=0;return f}}(),tzDateFromUTCDate:function(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))},urlifyAddress:function(t){return t=t.replace(/^\s*/,"").replace(/\s*$/,"").replace(/-/g,".dash.").replace(/#/g,".num.").replace(/\//g,".slash.").replace(/&/g," and ").replace(/,/g," ").replace(/\s+/g,"-"),encodeURIComponent(t).replace(/'/g,"%27")},encodeLocalityName:function(t){return encodeURIComponent(t.replace(/ /g,"_").replace(/\//g,".slash."))},getUrlParamFromString:function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+t+"=([^&#]*)",n=new RegExp(i),s=n.exec(e);if(null==s)return"";var o=s[1];return o=decodeURIComponent(o).replace(/\+/g," ")},formatNumber:function(t,e,i,n){var s=isFinite(+t)?+t:0,o=isFinite(+e)?Math.abs(e):0,a="undefined"==typeof n?",":n,r="undefined"==typeof i?".":i,u="",l=function(t,e){var i=Math.pow(10,e);return""+Math.round(t*i)/i};return u=(o?l(s,o):""+Math.round(s)).split("."),u[0].length>3&&(u[0]=u[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,a)),(u[1]||"").length<o&&(u[1]=u[1]||"",u[1]+=new Array(o-u[1].length+1).join("0")),u.join(r)},priceRangeString:function(t,e,i){"0"==e&&(e=t);var n=t?formatNumber(t):formatNumber(e),s=(formatNumber(e),t===1/0||e===-(1/0)),i=i||"Call for price";return t==e||s?!t||s?price_range_str=i:price_range_str="<span>$"+n+"</span>":price_range_str="from <span>$"+n+"</span>",price_range_str},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},boprof:function(){var t=(new Date).getTime();return function(e){var i=(new Date).getTime();console.log(e,i-t),t=i}},logExceptions:function(t,e){return function(){try{return e.apply({},[].slice.call(arguments))}catch(s){throw i.window&&_(function(){trackEventNonInteractive(ACTIVE_COMPONENT,"JSError "+t,s.name+": "+s.message),n.ajax({url:"/auth/p/error",data:{c:ACTIVE_COMPONENT,l:t,n:s.name,m:s.message}})}).defer(),s}}},withPartnerInfo:p,NeedsPartnerInfoMixin:function(t){var e=t._init;t._init=function(){var t=arguments,n=this;p(function(){_(["PWEIGHTS","PNAMES","_partnerInfo","PFOLLOWON"]).each(function(t){n[t]=i[t]}),e.apply(n,t)})}},ChainableSettersMixin:c,LoggerMixin:function(t,e){var i=[e];try{i.unshift(process.pid)}catch(n){}t.log=function(){this.verbose&&console.log.apply(console,[(new Date).toISOString()].concat(i.concat([].slice.call(arguments))))}},PassThroughSettersMixin:function(t,e,i,n){n&&console.log("PassThroughSettersMixin",t,e,i),_(i).each(function(i){var s="_set"+i.substr(0,1).toUpperCase()+i.substr(1);t[s]=function(){n&&console.log("this["+e+"]["+s+"]",this),this[e][s].apply(this[e],[].slice.call(arguments))}})},ProfilingMixin:function(t){t._profile=function(){var t={};return function(e,i){if(this.profile){t[e]||(t[e]=[0,0]);var n=(new Date).getTime()-i;t[e][0]++,t[e][1]+=n,console.log(e,n,t[e][1]/t[e][0])}}}()},CountsMixin:function(t,e){t.getCounts=function(){return this.counts||this.resetCounts()},t.setCounts=function(t){this.counts=t},t.resetCounts=function(){return this.counts=_(e).oreduce(function(t,e){t[e]=0})},t.strCounts=function(t){return t||(t=this.counts),_(e).chain().filter(function(e){return void 0!==t[e]}).map(function(e){return[t[e],e]}).flatten().value().join(" ")}},ConstituentsMixin:function(t,e){t._initConstituents=function(t,e){var e=e||{};if(PWEIGHTS=this.PWEIGHTS,PNAMES=this.PNAMES,i.simpleLoginApp&&this!==i.simpleLoginApp){var n={topMenus:RentalsTopMenus,facebook:RentalsFacebookConnector,facebookView:RentalsFacebookView,curator:PlaceDataCuratorConstituent};_(n).each(_(function(n,s){t[s]&&i.simpleLoginApp[s]&&(delete t[s],i.simpleLoginApp[s].setApp&&i.simpleLoginApp[s].setApp(this),e[s]=i.simpleLoginApp[s])}).bind(this))}_(this._composition=t).each(_(function(t,e){this[e]=new t(this)}).bind(this)),_(this).extend(e||{}),this._did_init_all_the_things=!0,(this.watch_slow||this.watch_all||this.watch_some)&&_(t).each(_(function(t,e){(this.watch_slow||this.watch_all||_(this.watch_some.split(",")).contains(e))&&_(this[e]).watch(e,this.watch_slow)}).bind(this)),this._sprayMethod("start",e),this._did_start_all_the_things=!0},t._sprayMethod=function(t,e){return _(this._composition).oreduce(_(function(i,n,s){this[s][t]&&!(e||{})[s]&&(i[s]=this[s][t]())}).bind(this))}},MapPolyfillMixins:d,decodeGooglePolygonPaths:function(t){return _(t.split(" ")).map(function(t){return(i.google?google.maps.geometry.encoding.decodePath:require("./poly-decoder"))(t)})},decodeGeoJSONPolygonPaths:function(t){var e=d.LatLng();return _(_(t.coordinates).flattenOneLevel()).map(function(t){return _(t).map(function(t){return new e(t[1],t[0])})})},decodeWKTPolygonPaths:function(t){var e=d.LatLng();return _(t).chain().select(function(t){return t}).map(function(t){return _(t.substr(0,t.length-1).substr(11).split(",")).map(function(t){var i=t.split(" ");return new e(i[1],i[0])})}).value()},boundsFromCommaSeparatedLatLng:function(t){var e=t.split(","),i=d.LatLngBounds(),n=d.LatLng();return new i(new n(e[0]-0,e[1]-0))},boundsFromBoxKey:function(t){var e=_(t.split("_")).map(function(t){return t-0}),i=[e[0]+.25,e[1]+.25],n=d.LatLngBounds(),s=d.LatLng();return new n(new s(e[0],e[1])).extend(new s(i[0],i[1]))},boundsFromHood:function(t){var e=t._bounds;return new google.maps.LatLngBounds(new google.maps.LatLng(e._sw.lat_,e._sw.lng_)).extend(new google.maps.LatLng(e._ne.lat_,e._ne.lng_))},makeIndices:function(t){_(t).each(function(t,e){this[t]=e})},makeFlags:function(t){_(t).each(function(t,e){this[t]=1<<e})},getPerformanceLevel:function(){var t=-1;return function(){if(t>=0)return t;t=0;for(var e=0;3>e;e++)(function(){for(var e=(new Date).getTime(),i={},n=0,s=0;1<<30>s&&4>n;s++){var o=s%1e3,a="_"+o;s%1e4==0&&(n=(new Date).getTime()-e),i[a]||(i[a]=[]),i[a].push({val:s}),i[a].push(i[a][1&s?"shift":"pop"]())}t+=(s-1)/1e3})();return t=Math.min(Math.floor(t/4),4)}}(),PERF_ABYSMAL:0,PERF_POOR:1,PERF_OK:2,PERF_GOOD:3,PERF_GREAT:4};return f}.call(this);window.walkscore||(window.walkscore={});for(var n in e)e.hasOwnProperty(n)&&(walkscore[n]=e[n]);window.ensureWSUnderscoreMixins=t.exports=function(){var t=!1,e=this;return function(i){return t?i:(i||(i=e._),i.mixin({sum:function(t){return i(t).reduce(function(t,e){return t+e},0)},bindsplat:function(t,e,i){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(e||{},i.concat(n))}},slice:function(t,e){var n={};return i(e).each(function(e){t.hasOwnProperty(e)&&(n[e]=t[e])}),n},dict_slice:function(t,e,n){return n?i(t).oreduce(function(t,n,s){i(e).include(s)||(t[s]=n)}):i(e).oreduce(function(e,i){e[i]=t[i]})},flattenOneLevel:function(t){return i.reduce(t,function(t,e){return i.isArray(e)?t.concat(e):(t[t.length]=e,t)},[])},trim:function(t){return i(t).oreduce(function(t,e,i){e&&(t[i]=e)})},flattenObject:function(t,e,n){var n=defaultIfNotSet(n,0),s=[];for(var o in t){var a=getObjectType(t);e>n&&"Object"==a||"Array"==a?s=s.concat(i(t[o]).flattenObject(e,n+1)):s.push(t[o])}return s},recharge:function(t,e){var i=0;return function(){var n=this,s=arguments,o=(new Date).getTime();o-i>e&&(i=o,t.apply(n,s))}},thump:function(t,e,n){var s=0,o=function(){var a=this,r=arguments;t.apply(a,r),(!n||++s<n)&&i(o).delay(e)};o()},dumpMethod:function(t,e){t[e]=i(t[e]).wrap(function(i){var n=Array.prototype.slice.call(arguments,1);console.log(e,"in",n);var s=i.apply(t,n);return console.log(e,"out",s),s})},spelunk:function(t,e){for(var e=i(e).clone();t&&e.length;)t=t[e.shift()];return t},spefunc:function(t,e,n){for(var e=i(e).clone(),s=t;t&&e.length;)s=t,t=t[e.shift()];return i(t||n||function(){}).bind(s)},oreduce:function(t,e,n,s){return i(t).reduce(function(t,i,n){return e(t,i,n),t},n||{},s)},max_attempts:function(t,e){return i(t).wrap(function(t){var i=Array.prototype.slice.call(arguments,1);return e-- >0?t.apply(this,i):void 0})},lump:function(t,e){return t.slice(0,Math.floor(t.length/e)*e)},indexOf:function(t,e){"use strict";if(void 0===t||null===t)throw new TypeError;var i=Object(t),n=i.length>>>0;if(0===n)return-1;var s=0;if(arguments.length>1&&(s=Number(arguments[2]),s!==s?s=0:0!==s&&s!==1/0&&s!==-(1/0)&&(s=(s>0||-1)*Math.floor(Math.abs(s)))),s>=n)return-1;for(var o=s>=0?s:Math.max(n-Math.abs(s),0);n>o;o++)if(o in i&&i[o]===e)return o;return-1},watch:function(t,e,n){n||(n=-1);for(method in t)i(t[method]).isFunction()&&function(s){t[s]=i(t[s]).wrap(function(o){for(var a=[arguments.callee.caller.caller],r=0;9>r&&a[0].caller;r++)a.unshift(a[0].caller);var u=Array.prototype.slice.call(arguments,1),l=(new Date).getTime(),c=o.apply(t,u),h=(new Date).getTime()-l,d={args:u,retval:c,time:h,stack:a.reverse()};return h>n&&console.log.apply(console,i([(new Date).getTime(),e?e:[],s,d]).flatten()),c})}(method)},onInstantiation:function(t,e){var i=function(){},n=function(){e(t.apply(this,arguments))};return i.prototype=t.prototype,n.prototype=new i,n.prototype.constructor=n,n},sort:function(t,e){return t.sort(e)}}),t=!0,i)}}.call(this),window._&&ensureWSUnderscoreMixins(),window._ws_=i;for(var n in i)i.hasOwnProperty(n)&&(window[n]=i[n])}.call(window),function(){"use strict";function haveLocalStorage(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(t){return!1}}window.app_loader=function(){var t=[];return function(e){if(t.push(e),!(t.length>1)){var i=function(){ensureWSUnderscoreMixins(),window.have_google=_(window.google).spelunk(["maps","Map"]),have_google&&ensure_ws_v3_extensions(),_(t).each(function(t){_(t).defer()})},n=new CountDownHash(["google","page"],i);return window.google_ready=function(){n("google")},function(){n("page")}}}}(),window.ensure_ws=function(){return window.ws||(window.ws=_({LARGE_DISTANCE:999999999999,zIndexGroups:{AMENITY_MARKERS:0,TRANSIT_MARKERS:1,HOUSE_MARKER:2,SELECTED_MARKERS:3}}).extend(walkscore.maps))},window.console||(window.console={log:function(){}}),haveLocalStorage()||(window.localStorage={getItem:function(){},setItem:function(){},removeItem:function(){},clear:function(){},key:function(){}}),window.logPageView=function(t,e){logUserLocationEvent.call(this,{slug:t,rid:e})},window.logUserLocationEvent=function(t){var e=(this||window).ACTIVE_COMPONENT.replace(/ /g,"_"),i=t.slug||"";t.data||(t.data={}),t.data.d||(t.data.d="current"),_({rid:"rid",evt:"e",id:"i"}).each(function(e,i){_(t[i]).isUndefined()||(t.data[e]=t[i],delete t[i])}),i&&"/"!=i[0]&&(i="/"+i),$.ajax(_({url:"/auth/_pv/"+e+i,dataType:"json"}).extend(t))},window.getUserLocationState=function(t){t.data=_(t.data||{}).extend({q:1}),logUserLocationEvent(t)},window.safeString=function(t,e,i){return"string"!=typeof t?"":(e&&(t=" "+t),i&&(t+=" "),t)},window.isEmptyString=function(t){return"string"==typeof t&&0==t.length},window.urlifyLocation=function(t,e,i){return urlifyAddress(t)+safeUrlLatLng(e,i)},window.safeUrlLatLng=function(t,e){return t&&e?"/lat="+t+"/lng="+e:""},window.encodeAddress=function(t){return encodeURIComponent((t||"").replace(/\-/g,".dash.").replace(/\#/g,".num.").replace(/\//g,".slash.").replace(/,/g," ").replace(/\s/g,"-").replace(/--/g,"-"))},window.unencodeAddress=function(t){return decodeURIComponent(t||"").replace(/-/g," ").replace(/\.dash\./g,"-").replace(/\.num\./g,"#").replace(/\.slash\./g,"/")},window.urlifyLatLng=function(t){return"loc/lat="+t.lat()+"/lng="+t.lng()},window.urlifyParam=function(t,e){return null==e?"":t+"="+encodeURIComponent(e)},window.getUrlParam=function(t){return _(window["url_"+t]).isUndefined()?getUrlParamFromString(t,window.location.href):window["url_"+t]},window.pathFromUrl=function(t){return/.+?\:\/\/.+?(\/.+?)(?:#|\?|$)/.exec(t)[1]},window.activateShareButton=function(t){if(t=t||{},0!=$("#share-button, .share-button").length||t.nodes){var e=function(e){return window.ws_addThis||(window.ws_addThis=new window.RentalsAddThis(t.app),window.ws_addThis.start()),t.clickHandler?t.clickHandler(e):showShareDialog(e,t.url,t.title),!1};$("#address-bar-links").css("display","block");var i=t.nodes||$("#share-button, .share-button");i.css("display","block").unbind().click(e),$("#address-bar #share-button").click(function(){trackEvent(ACTIVE_COMPONENT,"share link clicked","address bar")})}},window.clearSelection=function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var t=window.getSelection();t&&t.removeAllRanges&&t.removeAllRanges()}},window.loadTileAsync=function(){var t=document.createElement("script");t.type="text/javascript",t.src="/tile/show-walkscore-tile.php",document.getElementsByTagName("head")[0].appendChild(t)},window.loadCSS=function(t){var e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e)},window.rand=function(t){return Math.floor(Math.random()*t+1)},window.parseJson=function(jsonStr){if(!jsonStr||"string"!=typeof jsonStr||0==jsonStr.length)return null;if(window.JSON&&window.JSON.parse)return JSON.parse(jsonStr);try{return eval("("+jsonStr+")")}catch(err){return null}},window.ENV_PRODUCTION=!0,window.DEBUG_BLOCK_COOKIE=!1,window.DEBUG_BLOCK_API=!1,window.DEBUG_BLOCK_LOCALSTORAGE=!1,window.DEBUG_OUTPUT_ACTIVE=!1,window.DEBUG_AUDIT_GEOCODE=!1,window.DEBUG_ADS=!1,window.DEBUG_CURATION=!1,window.WS_M_NOT_FOUND="<p>The address you entered could not be found. Please check your address and try again.</p>",window.SIDEBAR_THRESHOLD=850,window.BROWSER_PREFIXES=["webkit","ms","o","moz","khtml"]}(),function(){"use strict";var t="cookie_data_version_1";window.BasicCookie=function(e,i){return e&&"string"==typeof e&&0!=e.length?(this.name=e,this.clear(),this.setExtraId(i),this.data=parseJson(get_cookie(this.name)),void(this.hasData()&&this.data.version!=t?this.deleteCookie():this.hasData()||this.clear())):void dbug("bad cookie name: "+e)},BasicCookie.prototype.clear=function(){this.data=null},BasicCookie.prototype.hasData=function(){return this.data&&(!this.extraId||this.extraId==this.data.extraId)},BasicCookie.prototype.hasDataFor=function(t){return this.data&&t==this.data.extraId},BasicCookie.prototype.setExtraId=function(t){this.extraId=t||null},BasicCookie.prototype.getData=function(t){return _.isUndefined(t)?this.data:null!==this.data&&null!==this.data[t]?this.data[t]:null},BasicCookie.prototype.addData=function(t,e){this.data||(this.data=new Object),this.data[t]=e},BasicCookie.prototype.getGeoData=function(t){var e=this.getData(t);if(!e)return null;var i=new GeoData;return i.loadJSON(e),i},BasicCookie.prototype.addGeoData=function(t,e){this.addData(t,e.toJSON())},BasicCookie.prototype.save=function(e){if(!this.data)return!1;this.extraId&&(this.data.extraId=this.extraId),this.data.version=t;var i=JSON.stringify(this.data);return set_cookie(this.name,i,e||90,"/","walkscore.com"),!0},BasicCookie.prototype.deleteCookie=function(){delete_cookie(this.name),this.clear()},window.set_cookie=function(t,e,i,n,s,o){var a=t+"="+escape(e);if(i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),a+="; expires="+r.toGMTString()}n&&(a+="; path="+escape(n)),s&&(a+="; domain="+escape(s)),o&&(a+="; secure"),document.cookie=a},window.get_cookie=function(t){var e=document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return e?unescape(e[2]):null},window.delete_cookie=function(t){var e="/",i="walkscore.com",n=t+"=";n+=e?";path="+e:"",n+=i?";domain="+i:"",n+=";expires=Thu, 01-Jan-1970 00:00:01 GMT",document.cookie=n}}(),function(){"use strict";window.roundNumber=function(t,e){e=defaultIfNotSet(e,0);var i=Math.round(t*Math.pow(10,e))/Math.pow(10,e);return i},window.convertMeters=function(t,e){return"mi"==e?t/1609.34:t/1e3},window.convertMetersForDisplay=function(t,e,i,n,s,o){var a=convertMeters(t,e);n&&(a=roundNumber(a,n)),0>=a&&1==n?a="0.0":0>=a&&2==n&&(a="0.01");var r=String(a);return o&&(r+=" "),i&&(r+=e),s&&(r="0"==r.substr(0,1)?r.substr(1):r),r},window.convertTimeForDisplay=function(t,e,i){var n=Math.floor(t/3600);t%=3600;var s=Math.floor(t/60),o="";return n&&(o+=n+(e?"":" hr ")),!s||i&&"hours"==i||(o+=s+(e?"":" minutes")),o}}(),function(){"use strict";window.WSIDAuth=function(t){this._init(t)},function(){var t=WSIDAuth.prototype;t.if_free=function(t){return this._add_continuation(e,t)},t.if_paid=function(t){return this._add_continuation(i,t)};var e="free",i="paid";t._init=function(t){_(ws_simple_init).bind(this)(t,["wsid","domain"]),this._continuation_queue_=[],this._fire()},t._add_continuation=function(t,e){return this._continuation_queue_.push({type:t,continuation:e}),this._process_queue(),this},t._process_queue=function(){if(this._type_)for(var t;t=this._continuation_queue_.shift();)t.type==this._type_&&t.continuation()},t._fire=function(){$.ajax({url:"/auth/amenity_map_auth",type:"GET",dataType:"json",data:{wsid:this.wsid,domain:this.domain},success:_(this._handle_response).bind(this),error:_(this._handle_response).bind(this,null),timeout:3e3})},t._handle_response=function(t){this._type_=t&&t.status&&1!=t.status?e:i,this._process_queue()}}()}(),function(){"use strict";window.LocalCache=function(){function t(t){this.key=t,this.size=10,this.expiration=e,this._default=null}var e=864e5,i=t.prototype;i.setKey=function(t){return this.key=t,this},i.setLocation=function(t){return this.geoData=t,this},i.setSize=function(t){return this.size=t,this},i.setExpiration=function(t){return this.expiration=t,this},i.setDefault=function(t){return this._default=t,this},i.isPersistent=function(){return this.storedSuccessfully},i.fetch=null,i.store=null,i.clear=null;var n,s;s=function(){return!0},n=function(){this._data=this._data||[]},t.clearLike=function(e){t.noPost=!0};var o=function(t,e){return t.lat==e.lat&&t.lng==e.lng},a=function(t,e){return t.time-e.time>this.expiration},r=function(){if(!(this.geoData&&this.geoData.getLatLng&&this.geoData.getLatLng()))throw"Missing GeoData in LocalCache, with cache key "+this.key},u=function(){if(!this.key)throw"Missing key in LocalCache"};return i.clear=function(){this.store()},i.store=function(t){_(r).bind(this)(),_(u).bind(this)(),_(n).bind(this)();var e={lat:this.geoData.getLat(),lng:this.geoData.getLng(),time:(new Date).getTime()},i=_(this._data).detect(_(o).bind(this,e));for(i&&(e.time=i.time,this._data=_(this._data).reject(_(o).bind(this,e))),t&&(e.data=simplifyDataStructure(t),this._data.push(e));this._data.length>this.size;)this._data.shift();for(;!_(s).bind(this)()&&this._data.length>=1;)this._data.shift()},i.fetch_raw=function(){return this.fetch(!0)},i.fetch=function(t){_(r).bind(this)(),_(u).bind(this)(),_(n).bind(this)();var e={lat:this.geoData.getLat(),lng:this.geoData.getLng(),time:(new Date).getTime()};window._ws_init_local_cache_posts&&_ws_init_local_cache_posts[this.key]&&(this._data.push(_ws_init_local_cache_posts[this.key]),delete _ws_init_local_cache_posts[this.key]),this._data=_(this._data).reject(_(a).bind(this,e));var i=_(this._data).detect(_(o).bind(this,e));return i?t?i:i.data:simplifyDataStructure(this._default)},i.empty=function(t){_(r).bind(this)(),_(u).bind(this)(),_(n).bind(this)(),this._data=[],_(s).bind(this)()},t}()}(),function(){"use strict";window.SimpleCache=function(){this.data={},this.put=function(t,e){this.data[t]=e},this.get=function(t){return _.isUndefined(this.data[t])?null:this.data[t]},this.hasKey=function(t){return!_.isUndefined(this.data[t])},this.clear=function(t){this.data[t]=null,delete this.data[t]},this.clearAll=function(){for(var t in this.data)delete this.data[t]}}}(),function(){window.isIE=function(){return navigator.userAgent.toLowerCase().indexOf("msie")>=0},window.isIE6=function(){return $.browser.msie&&$.browser.version<7},window.isChrome=function(){return-1!=navigator.userAgent.toLowerCase().indexOf("chrome")},window.isIpad=function(){return null!=navigator.userAgent.match(/iPad/i)},window.isIOS=function(){return function(t){return _([/ipad/i,/ipod/i,/iphone/i]).detect(function(e){return t.match(e)})}(navigator.userAgent)},window.isAndroid=function(){return null!=navigator.userAgent.match(/Android/i)},window.isWinPhone=function(){return null!=navigator.userAgent.match(/Windows Phone/i)},window.getResModifier=function(){return isHighRes()?"@2x":""},window.isHighRes=function(){return(window.devicePixelRatio||1)>1},window.hasHistory=function(){return!(!window.history||!history.pushState)}}(),function(){"use strict";window.GeoData=function(t,e,i,n,s,o,a,r,u,l){ensure_ws(),this.setData=function(t,e,i,n,s,o,a,r,u,l){this.query=safeString(t),this.preSnapLatLng=l,this.setLatLng(e),this.countryCode=safeString(i).toUpperCase(),this.countryName=safeString(n),this.formattedAddress=safeString(s),this.adminArea=safeString(o),this.thoroughfare=safeString(a),this.locality=safeString(r),this.postalCode=safeString(u),this.overrideUnits=null},this.setLatLng=function(t){this.latLng=t||null,this.preSnapLatLng||(this.preSnapLatLng=this.latLng),this.latLng&&this.snap()},this.setLocBase=function(t){this.locBase=t},this.snap=function(){this.preSnapLatLng||(this.preSnapLatLng=this.latLng),this.latLng=new ws.LatLng(snapToGrid(this.getLat()),snapToGrid(this.getLng()))},this.fillDataFromGeoData=function(t){isEmptyString(this.query)&&(this.query=t.query),this.preSnapLatLng||(this.preSnapLatLng=t.preSnapLatLng),null==this.latLng&&this.setLatLng(t.latLng),isEmptyString(this.countryCode)&&(this.countryCode=t.countryCode),isEmptyString(this.countryName)&&(this.countryName=t.countryName),isEmptyString(this.formattedAddress)&&(this.formattedAddress=t.formattedAddress),isEmptyString(this.adminArea)&&(this.adminArea=t.adminArea),isEmptyString(this.thoroughfare)&&(this.thoroughfare=t.thoroughfare),isEmptyString(this.postalCode)&&(this.postalCode=t.postalCode),isEmptyString(t.locality)||(this.locality=t.locality),isEmptyString(t.formattedAddress)||(this.formattedAddress=t.formattedAddress),t.locBase&&(this.locBase=t.locBase)},this.loadJSON=function(t){var e=t.y&&t.x?new ws.LatLng(t.y,t.x):null,i=t.py&&t.px?new ws.LatLng(t.py,t.px):null;return this.setData(decodeURIComponent(t.q),e,decodeURIComponent(t.cc),decodeURIComponent(t.cn),decodeURIComponent(t.fa),decodeURIComponent(t.aa),decodeURIComponent(t.tf),decodeURIComponent(t.l),decodeURIComponent(t.pc),i),this.locBase=decodeURIComponent(t.lb),this},this.toJSON=function(){var t={lb:encodeURIComponent(this.locBase),q:encodeURIComponent(this.query),cc:encodeURIComponent(this.countryCode),cn:encodeURIComponent(this.countryName),fa:encodeURIComponent(this.formattedAddress),aa:encodeURIComponent(this.adminArea),tf:encodeURIComponent(this.thoroughfare),l:encodeURIComponent(this.locality),pc:encodeURIComponent(this.postalCode)};return this.latLng&&(t.y=this.latLng.lat(),t.x=this.latLng.lng()),this.preSnapLatLng&&(t.py=this.preSnapLatLng.lat(),t.px=this.preSnapLatLng.lng()),t},this.overrideDefaultUnits=function(t){"mi"!=t&&"km"!=t||(this.overrideUnits=t)},this.getUnits=function(){return this.overrideUnits?this.overrideUnits:!this.countryCode||"US"!=this.countryCode&&"GB"!=this.countryCode?"km":"mi"},this.getQuery=function(){return this.query},this.getLatLng=function(){return this.latLng},this.getLat=function(){return this.latLng?this.latLng.lat():null},this.getLng=function(){return this.latLng?this.latLng.lng():null},this.getPreSnapLat=function(){return this.preSnapLatLng?this.preSnapLatLng.lat():null},this.getPreSnapLng=function(){return this.preSnapLatLng?this.preSnapLatLng.lng():null},this.getLocBase=function(){return this.locBase},this.getCountryCode=function(){return this.countryCode},this.getCountryName=function(){return this.countryName},this.getAdminArea=function(){return this.adminArea},this.getThoroughfare=function(){return this.locBase==GeoData.prototype.LOCBASE_REVERSE_GEOCODE_WITH_ADDRESS_OVERRIDE?this.query:this.thoroughfare},this.getCity=function(){return this.locality},this.getTransitScoreCity=function(){var t=this.locality;return"NZ"==this.countryCode&&(t=this.adminArea),t},this.getPostalCode=function(){return this.postalCode},this.getPreSnapLatLng=function(){return this.preSnapLatLng},this.correctCityNameForDisplay=function(){return"DC"==this.adminArea?"Washington D.C.":this.locality},this.getUrlifiedLocation=function(){var t=_(["LOCBASE_GEOCODE","LOCBASE_GEOCODE_PLUS_REVERSE","LOCBASE_GEOCODE_FROM_SERVER"]).detect(_(function(t){return this.locBase==this[t]}).bind(this));return t?urlifyAddress(this.query):this.locBase==GeoData.prototype.LOCBASE_REVERSE_GEOCODE?urlifyLatLng(this.latLng):urlifyLocation(this.query,this.latLng.lat(),this.latLng.lng())},this.getFormattedAddress=function(){return this.formattedAddress},this.getShortFormattedAddress=function(){var t=[];return this.thoroughfare&&t.push(this.thoroughfare),this.locality&&t.push(this.correctCityNameForDisplay()),t.length>0?t.join(" "):this.query},this.getBestFormattedAddress=function(){return this.locBase==GeoData.prototype.LOCBASE_REVERSE_GEOCODE_WITH_ADDRESS_OVERRIDE?this.query:this.thoroughfare?this.getShortFormattedAddress():this.formattedAddress?this.formattedAddress:this.query},this.hasData=function(){return null!=this.latLng&&""!=this.countryCode},this.hasCity=function(){return""!=this.locality},this.hasAdminArea=function(){return""!=this.adminArea},this.hasCountry=function(){return""!=this.countryCode},this.getCityStateZip=function(){return""!=this.adminArea||""!=this.postalCode?this.locality+", "+this.adminArea+" "+this.postalCode:this.locality},this.getUrl=function(t){return t||(t=""),isEmptyString(this.query)?this.latLng?"/score/"+urlifyLatLng(this.latLng)+"?"+t:void 0:"/score/"+urlifyAddress(this.query)+"?"+t},this.getRentalsUrl=function(t){return t||(t=""),isEmptyString(this.query)?this.latLng?"/apartments/search/loc?lat="+this.latLng.lat()+"&lng="+this.latLng.lng()+"&"+t:void 0:"/apartments/search/"+urlifyAddress(this.query)+"?"+t},this.setData(t,e,i,n,s,o,a,r,u,l)},GeoData.prototype.LOCBASE_GEOCODE=20,GeoData.prototype.LOCBASE_REVERSE_GEOCODE=21,GeoData.prototype.LOCBASE_REVERSE_GEOCODE_WITH_ADDRESS_OVERRIDE=22,GeoData.prototype.LOCBASE_GEOCODE_PLUS_REVERSE=23,GeoData.prototype.LOCBASE_GEOCODE_FROM_SERVER=24,GeoData.prototype.hasStreetNumber=function(){return!!this.streetNumber},window.initGeoDataFromURL=function(){ensure_ws();var e=getUrlParam("lat"),i=getUrlParam("lng"),n=e.length>0&&i.length>0?new ws.LatLng(e,i):null,s=getUrlParam("country"),o=getUrlParam("street",!0,!0);if("loc"==o)o="";else if(!e&&!i&&/^\[[0-9\-\.]+\s[0-9\-\.]+\]$/.test(o))var a=o.substr(1,o.length-2).split(" "),n=new ws.LatLng(a[0],a[1]);var r=getUrlParam("polygon");r&&!(e||i||o)&&(n=_(google.maps.geometry.encoding.decodePath(r)).reduce(function(t,e){return t.extend(e),t},new google.maps.LatLngBounds).getCenter());var u=new GeoData(t(o),n,s),l=getUrlParam("units");return l&&u.overrideDefaultUnits(l),u},window.replaceAll=function(t,e,i){for(var n=t.indexOf(e);-1!=n;)t=t.replace(e,i),n=t.indexOf(e);return t};var t=function(t){return t=replaceAll(t,"&"," and ")};window.getLocationKey=function(t){var e=t.getQuery(),i=t.getLat(),n=t.getLng(),s=i&&n?"_"+String(i)+"_"+String(n):"";return e+s}}(),function(){"use strict";window.latLngFromGoogleResponse=function(t,e){if(t&&t.length>e&&t[e].geometry){var i=t[e].geometry.location;return new google.maps.LatLng(i.lat(),i.lng())}return null},window.googleResponseHasCountry=function(t,e){if(t&&t.length>e&&t[e].address_components){var i=_(t[e].address_components).detect(function(t){return _(t.types).detect(function(t){return"country"==t})});return i.short_name}return!1},window.geoDataFromGoogleWithinRange=function(t,e,i,n,s){if(!e)return null;s||(s=Math.min(3,e.length));var o=_(_.range(s)).detect(_(function(n){var s=googleResponseHasCountry(e,n),o=google.maps.geometry.spherical.computeDistanceBetween(latLngFromGoogleResponse(e,n),t);return s&&i>o}).bind(this));return _.isUndefined(o)?null:geoDataFromGoogleResponse(e,n,Number(o))},window.geoDataFromGoogleResponse=function(t,e,i){if(ensure_ws(),0==(t||[]).length)return new GeoData;e||(e="");var n=null,s=null,o=null,a=null,r=null,u=null,l=null,c=null,h=null,d="",p=_.isUndefined(i)?t:[t[i]];if(_(p).detect(function(t){var e=t.geometry.location;s=new ws.LatLng(e.lat(),e.lng()),r=t.formatted_address;var i=[];return _(t.address_components).each(function(t){_(t.types).each(function(e){switch(e){case"street_number":i.unshift(t.long_name),d=t.long_name;break;case"route":i.push(t.long_name);break;
case"locality":c=t.long_name;break;case"country":a=t.long_name,o=t.short_name;break;case"administrative_area_level_1":u=t.short_name;break;case"postal_code":h=t.long_name}}),l=i.join(" ")}),o}),o){DEBUG_AUDIT_GEOCODE&&(dbug("---NEW GEOCODE---"),dbug("query: "+e),dbug("latlng: "+dumpGLL(s)),dbug("countryCode: "+o),dbug("countryName: "+a),dbug("formattedAddress: "+r),dbug("administrativeAreaName: "+u),dbug("thoroughfare: "+l),dbug("localityName: "+c),dbug("postalCode: "+h),dbug("---------------"));var n=new GeoData(e,s,o,a,r,u,l,c,h,s);n.streetNumber=d}else if(t.Placemark){for(var g=1;g<t.Placemark.length;g++)if(t.Placemark[g].AddressDetails.Country){o=String(t.Placemark[g].AddressDetails.Country.CountryNameCode);break}var n=new GeoData(e,s,o)}return n}}(),function(){"use strict";window.CustomGetTileUrl=function(t,e){if(window.BASE_TILE_URL){var i=1<<e,n=i-t.y-1;return BASE_TILE_URL+e+"/"+t.x+"/"+n+".png"}return"//pp.walk.sc/map_tiles/walkscore/v3/17/"+t.x+"/"+t.y+"/"+e+".png"},window.CustomGetBikeTileUrl=function(t,e,i){return"//pp.walk.sc/map_tiles/bikescore/%s/17/".replace(/%s/,t)+e.x+"/"+e.y+"/"+i+".png"},window.CustomGetTileFuncFromBaseUrl=function(t){return function(e,i){var n=1<<i,s=n-e.y-1;return t+i+"/"+e.x+"/"+s+".png"}}}(),function(){"use strict";window.setInputExampleText=function(t,e){var i=_(t).isString()?$(t):t;return i.addClass("example-text"),Modernizr.input.placeholder?i.attr("placeholder",e):(i.unbind("focus").unbind("blur").bind("focus",function(t){this.value==e&&$(this).val("").removeClass("placeholder")}).bind("blur",function(t){""==this.value&&$(this).addClass("placeholder").val(e)}),void(""==getActiveText(i)&&i.addClass("placeholder").val(e)))},window.setActiveText=function(t,e){var i=_(t).isString()?$(t):t;i.val(e),i.trigger("blur"),e?i.removeClass("placeholder"):Modernizr.input.placeholder||i.addClass("placeholder")},window.getActiveText=function(t){var e=_(t).isString()?$(t):t;return!e.hasClass("placeholder")||Modernizr.input.placeholder?e.val():""},window.limitText=function(t,e,i){var n=i-t.val().length;0>n&&(t.val(t.val().substring(0,i)),n=0),20>n?e.addClass("form-error-message"):e.removeClass("form-error-message"),50>n?e.html(n+" characters remaining"):e.html("")}}(),function(){"use strict";window.fixNYBoroughs=function(t,e){var i=_(["Brooklyn","Queens","Bronx","Staten Island","Manhattan"]);return"NY"==e&&i.include(t)?"New York":t},window.sluggify=function(t){return t=replaceAll(t," ","-"),t=replaceAll(t,"'",""),t=replaceAll(t,'"',""),t=replaceAll(t,".",""),t=replaceAll(t,"&","and"),t=replaceAll(t,":",""),t=replaceAll(t,",",""),t.toLowerCase()}}(),function(){"use strict";Function.prototype.inheritsFrom=function(t){return t.constructor==Function?(this.prototype=new t,this.prototype.constructor=this,this.prototype.parent=t.prototype):(this.prototype=t,this.prototype.constructor=this,this.prototype.parent=t),this},window.defaultIfNotSet=function(t,e){return"undefined"!=typeof t?t:e},window.paramIsSet=function(t){return"undefined"!=typeof t},window.bindCallback=function(t,e){return function(){return e.apply(t,arguments)}},window.simplifyDataStructure=function(t){var e,i=getObjectType(t);switch(i){case"Array":e=[];for(var n=0;n<t.length;n++)e.push(simplifyDataStructure(t[n]));break;case"Object":e={};for(var s in t)t.hasOwnProperty&&t.hasOwnProperty(s)&&(e[s]=simplifyDataStructure(t[s]));break;case"String":case"Number":case"Boolean":return t;default:_(t).isNull()&&(e=null)}return e},window.getObjectType=function(t){var e=Object.prototype.toString.call(t).match(/^\[object ([^\]]+)\]$/);return e?e[1]:"Unknown"},window.getScoreDescription=function(t){return t>=90?"Walker&rsquo;s Paradise":t>=70?"Very Walkable":t>=50?"Somewhat Walkable":"Car-Dependent"},window.generateAmenityKey=function(e,i,n,s){var o=String(i.lat()),a=String(i.lng());s||(-1!=o.indexOf(".")&&(o=o.substr(0,o.indexOf(".")+4),o=o.replace(/\.?0+$/,"")),-1!=a.indexOf(".")&&(a=a.substr(0,a.indexOf(".")+4),a=a.replace(/\.?0+$/,"")));var r=e.toLowerCase();r=replaceAll(r," ",""),r=replaceAll(r,"'",""),r=replaceAll(r,'"',""),r=replaceAll(r,"%",""),r=replaceAll(r,"&",""),r=replaceAll(r,"<",""),r=replaceAll(r,">",""),r=t.convert(r);var u=r.substr(0,Math.min(5,r.length)),l=r.substr(Math.max(0,r.length-5),5),c=u+l+"_"+o+"_"+a;return"Curated"==n&&(c+="_ws"),c};var t={map:null,convert:function(e){t.init();for(var i="",n=0;n<e.length;n++){var s=e.charAt(n);i+=s>="A"&&"Z">=s||s>="a"&&"z">=s?t.map[s]:s}return i},init:function(){if(null==t.map){for(var e=new Array,i="abcdefghijklmnopqrstuvwxyz",n=0;n<i.length;n++)e[i.charAt(n)]=i.charAt((n+13)%26);for(var n=0;n<i.length;n++)e[i.charAt(n).toUpperCase()]=i.charAt((n+13)%26).toUpperCase();t.map=e}}};window.am_convertMetersForDisplay=function(t,e){return convertMeters(t,e)<.1?convertMetersForDisplay(t,e,!0,2,!0):convertMetersForDisplay(t,e,!0,1,!0).replace(/^(\d{2,})\.\d/,"$1")},window.htmlToText=function(t){return t=replaceAll(t,"<","&lt;"),t=replaceAll(t,">","&gt;"),t=replaceAll(t,"&mdash;","&amp;mdash;"),t=replaceAll(t,"&rsquo;","&amp;rsquo;")},window.leadsWithNumber=function(t){var e=/^[0-9]+$/;return!!t.substr(0,1).match(e)},window.StringList=function(){this.list=[],this.length=function(){return this.list.length},this.get=function(t){return this.list[t]},this.indexOf=function(t){for(var e in this.list)if(this.list[e]==t)return e;return-1},this.isInList=function(t){return-1!=this.indexOf(t)},this.addIfUnique=function(t){this.isInList(t)||this.list.push(t)},this.add=function(t){this.list.push(t)}},window.getLeadingNumber=function(t){if(!leadsWithNumber(t))return!1;var e=t.match(/[\d\.]+/g);return e&&e[0]?Number(e[0]):!1},window.supersluggify=function(t){return t.replace(/\s/g,"-").replace(/&/g,"and").replace(/\W/g,"").toLowerCase()},window.get_image_size=function(t,e){var i=new Image;$(i).load(function(){e(i.width,i.height)}).error(function(){e()}).attr({src:t})},window.cleanNumber=function(t){if(null==t)return"";var e=t;return e=replaceAll(e,"(",""),e=replaceAll(e,")",""),e=replaceAll(e,"-",""),e=replaceAll(e," ","")}}(),function(){"use strict";window.ParameterManager=function(t){this._init(t)},function(){var t=ParameterManager.prototype;t.add_free=function(t,i,n){this._add(e,t,i,n)},t.add_paid=function(t,e,n){this._add(i,t,e,n)},t.do_with_one=function(t,e){this._queues_[t]||(this._queues_[t]=[]),this._queues_[t].push(e),this._process_queue(t)},t.do_with_all=function(t){this.do_with_one("",t)},t.do_with_some=function(t,e){var i={},n=CountDownHash(t,function(){e(i)});_(t).each(_(function(t){this.do_with_one(t,function(e){i[t]=e,n(t)})}).bind(this))};var e="free",i="paid";t._init=function(t){_(ws_simple_init).bind(this)(t,["auth"]),this._values_={},this._queues_={}},t._add=function(t,e,n,s){if(!_(this._queues_).isEmpty())throw"ParameterManager: All parameters must be added prior to registering callbacks";this._values_[e]=void 0,s||(s="");var o=function(t){this._values_[e]=t?n||s:s,this._process_queue(e),this._process_queue("")};t==i?this.auth.if_free(_(o).bind(this,!1)).if_paid(_(o).bind(this,!0)):_(o).bind(this)(!0)},t._process_queue=function(t){if(!_(this._queues_).isEmpty()){var e=this._values_;for(var i in e)if((!t||i==t)&&_(e[i]).isUndefined())return;_(this._queues_[t]||[]).each(function(i){i(t?e[t]:e)}),this._queues_[t]=[]}}}()}(),function(){"use strict";window.trackEvent=function(t,e,i,n){!ENV_PRODUCTION&&DEBUG_OUTPUT_ACTIVE&&console&&console.log?console.log("Track Event:",t,"|",e,"|",i,"|",n):window.ga&&ga("send","event",t,e,i,n)},window.trackEventNonInteractive=function(t,e,i,n){!ENV_PRODUCTION&&DEBUG_OUTPUT_ACTIVE&&console&&console.log?console.log("Track Non-Interactive Event:",t,"|",e,"|",i,"|",n):window.ga&&ga("send","event",t,e,i,n,{nonInteraction:1})},window.trackActiveUser=function(t){},window.trackNavigation=function(t,e,i,n){e&&i&&trackEvent(e,i,safeString(n)),t&&(document.location=t)},window.trackNavigationNewWindow=function(t,e,i,n){e&&i&&trackEvent(e,i,safeString(n)),t&&window.open(t,"newwin"+rand(9999))}}(),window.trimURL=function(t){var e=t.indexOf("://");return-1!=e?t.substr(e+3):void 0},function(){DEFAULT_PLACE_IMAGE="//cdn2.walk.sc/2/images/tile/place-default.gif";var t=function(t){var e=this.app.map,i=[];if(e&&e.optionFlags.infoWindow==AmenityMap.SMALL_INFO_WINDOWS){i.push('<div class="iw iw-park">'),i.push('<div class="iw-title">');var n=e.geoData.getUrl()+"?utm_source="+tileDomain+"&utm_campaign=ws_tile&show="+encodeURIComponent(t.getKey());nolink_bubbles?i.push(t.name):i.push('<a href="'+n+'" target="_blank" title="Click to view details" onclick="trackEvent(\''+ACTIVE_COMPONENT+"', 'result  clickthrough', '"+t.getCategory()+"');\">"+t.name+"</a>"),i.push("</div>"),nolink_bubbles||i.push('<div><a href="'+n+'&utm_medium=bubble_details" target="_blank" title="Click for more info" onclick="trackEvent(\'tile\', \'result details clickthrough\', \''+t.getCategory()+"');\">Photos and reviews</a></div>"),i.push(this.p.as.removeFlagHtml(t)),i.push("</div>")}else{i.push('<div class="iw iw-park">'),i.push('<div class="iw-title">');var n=t.url?t.url:null;n?i.push('<a href="'+n+'" target="_blank" title="Click to view details" onclick="trackEvent(\''+ACTIVE_COMPONENT+"', 'result  clickthrough', '"+t.getCategory()+"');\">"+t.name+"</a>"):i.push(t.name),i.push("</div>"),i.push('<div id="iw-body">Park data from <a href="http://www.openstreetmap.org/" target="_blank" onclick="trackEvent(\''+ACTIVE_COMPONENT+"', 'result attribution clickthrough', 'openstreetmap');\">OpenStreetMap</a></div>"),i.push("</div>")}return $(i.join(""))[0]},e={"":{is_ready:function(){return!0},fetchPrepop:function(t,e,i){var n=_(window).spelunk(["_amenity_prepop",t.name]);return n||i?(this.callback=e,this.query=t,_(_(this.receiveResults).bind(this,n)).defer()):!1},fetch:function(t,e){if(!this.fetchPrepop(t,e)){var i=this.id+"_"+(t.search?t.search.join("_"):""),n=this.p.as.cache.get(i);if(this.requestOut&&!n)return _(_(this.fetch).bind(this,t,e)).delay(250);if(this.query=t,this.callback=e,this.cacheKey=i,n)return _(_(this.receiveResults).bind(this,n)).defer();this.requestOut=!0;var s=_(this.handleAjaxResponse).bind(this),o=this.prepopFromServer(t);o?s(o):$.ajax(_(_(this.ajaxRequest(t)).extend({success:s,error:s})).extend(this.extraAjaxParams())),this.p.as.listPointer++,this.p.as.runNextQuery()}},prepopFromServer:function(t){},params:function(t){return _({lat:encodeURI(this.p.as.geoData.getLat()),lon:encodeURI(this.p.as.geoData.getLng())}).extend(this._extraParams||{})},setParams:function(t){this._extraParams=t},ajaxRequest:function(t){return{type:"GET",url:this.url(t),data:this.params(t)}},extraAjaxParams:function(){return{}},handleAjaxResponse:function(t,e){var i="string"==typeof t?parseJson(t):t;this.resultListFinder&&(i=this.resultListFinder(i)),delete this.requestOut,i&&this.p.as.cache.put(this.cacheKey,i),this.receiveResults(i)},receiveResults:function(t){this.p.as.handleResults(new RawResults(t||null,this.query),this.callback,this.nameFinder)},makeAmenitiesFromRawResults:function(t){var e=t.getQuery(),i=this.app.amenityManager.getIconAndIconSel(e),n=i[0],s=i[1],o=(e.getName(),this.app.geoData.getLatLng());return _(_(t.results||[]).map(_(function(t){return this.createAmenity(t,o,n,s,e)||[]}).bind(this))).flatten()},buildHTML:function(t,e){var i=this.app.map,n=this.getReviewHelper(),s=[],o=this.app.nearbyManager&&t.displayQuery.actsLikeCustom(),a=i.optionFlags.infoWindow==AmenityMap.SMALL_INFO_WINDOWS,r=i.optionFlags.showReviews,u=r,l=a?40:112,c=!a&&this.app.resultPanels?this.app.resultPanels.formatDistance(t.getDist()):"",h=u?this.getImageHtml(null,l,c,!0):"",d="iw "+(u?"with-image":"no-image");if(i.optionFlags.infoWindow==AmenityMap.SMALL_INFO_WINDOWS){var p=r?'<div class="iw-reviews"></div>':"";s.push('<div class="'+d+'">'),s.push('<div class="iw-title">'+t.name+"</div>"),s.push(h),s.push('<div class="iw-contact-info"><div class=iw-street>'+t.getStreetAddress()+"</div></div>"),s.push(p),o&&s.push('<div><a onclick="amenityMapApp.nearbyManager.removeCurrentQuery()">Remove '+t.displayQuery.name+"</a></div>"),s.push(this.p.as.removeFlagHtml(t)),s.push("</div>")}else{var p='<div class="iw-reviews">'+(null!=t.phoneNumber?'<div class="unlinked-reviews-text">Searching...</div>':"")+"</div>";s.push('<div class="'+d+'">'),s.push('<div class="iw-title">'+t.name+"</div>"),s.push(h),s.push('<div class="iw-contact-info">'),s.push("<div class=iw-street>"+t.getLocation(!0)+"</div>"),t.getPhoneNumber()&&s.push("<div class=iw-phone>"+this.formatPhoneNumber(t.getPhoneNumber())+"</div>"),s.push("</div>"),s.push(p),s.push(this.p.as.removeFlagHtml(t,!0)),s.push('<div class="close-btn"></div>'),s.push("</div>")}var g=$(s.join(""));return this.wireUpHTML(g,t),r&&n.getAmenityData(i.gmap,t,_(function(t,e){e&&e.url&&g.attr("data-url",e.url);var s=n.getReviewsHtml(e,t.getCategory(),a);i.updateInfoWindow(t,g,".iw-reviews",s),this.wireUpHTML(g,t)}).bind(this)),u&&this.getPlaceImage(t.id,l,_(function(e){i.updateInfoWindow(t,g,".iw-image",this.getImageHtml(e,l,c)),this.wireUpHTML(g,t)}).bind(this)),g},wireUpHTML:function(t,e){t.find(".close-btn").unbind().click(_(function(){this.app.map.closePreviouslyOpenedWindow()}).bind(this));var i=t.attr("data-url");if(this.app.map.optionFlags.showReviews&&i||!nolink_bubbles){var n=this.app.map.geoData.getUrl()+"?utm_source="+tileDomain+"&utm_campaign=ws_tile&show="+e.id,s=[{elem:".iw-reviews .ratings-image",medium:"result_review_stars",action:"result stars clickthrough"},{elem:".iw-reviews .reviews-text a",medium:"result_review_link",action:"result review-link clickthrough"}];_(s).each(_(function(s){t.find(s.elem).unbind().click(_(function(t){var o=i||n+"&utm_medium="+s.medium;return window.open(o,"wswin"+rand(99999)),trackEvent(ACTIVE_COMPONENT,s.action,e.getCategory()),!1}).bind(this)).css("cursor","pointer")}).bind(this))}},buildToolTipHTML:function(t,e){var i=$("<div />",{"class":"summary"}),n=t.toolTipBody=$("<div />").append($("<div />",{"class":"img_div"})).append(i),s="Finding reviews&hellip;",o=e&&e.yelpBiz;_([["name",t.name],["yelp",s],["reviewcount","&nbsp;"]]).each(function(t){t[1]&&i.append($("<div />",{"class":t[0]}).append($("<span />",{"class":"label"}).html(t[2]||"")).append($("<span />",{"class":"value"}).html(t[1]||"")))});var a=this.getReviewHelper(),r=function(t,e,n){t.yelpLookupDone=!0,t.yelpBiz=e,t.toolTipBody.find(".yelp .value").empty().append(e?$("<img />",{src:e.rating_img_url}):"No reviews found."),e&&i.find(".reviewcount .value").html(e.review_count+" reviews");var s=a.getImageUrl(e)||"//cdn2.walk.sc/2/images/search/placeholder_amenity.gif";if(s){var o=$("<img />");n?o.css("display","block"):o.load(function(){$(this).css("display","block")}),t.toolTipBody.children(".img_div").append(o.attr("src",s))}};return t.yelpLookupDone?r(t,o,!0):a.getAmenityData(this.app.app.map,t,r),n},createAmenity:function(t,e,i,n,s){var o=s.getName(),a=this.resultClass(),r=this.resultParameters(t,s);return r&&r.name?new a(_({app:this.app,rawCenter:e,icon:i,iconSel:n,category:o,dataSource:this.id,address:t.formatted_address||"",city:"",region:"",phoneNumber:""}).extend(r)):void 0}},Curated:{},"app-created":{buildHTML:function(t){return t.getResultHTML()}},Google:{is_ready:function(){return!this.queryOut},fetchResults:function(t){var e=this.query.getSearch(t),i=this.p.as.cache.get(e);if(i)return _(_(this.receiveResults).bind(this,i,t)).defer();this.pagesPerSearch=Math.ceil(this.p.as.targetResultSetSize/(8*this.query.getNumSearches())),this.gPlacesSearch||(this.gPlacesSearch=new google.maps.places.PlacesService(this.app.app.map));var n=_(function(e){this.allResults=e,this.onCallback(t)}).bind(this);this.queryOut=!0,this.gPlacesSearch.nearbySearch({location:new google.maps.LatLng(this.p.as.geoData.getLat(),this.p.as.geoData.getLng()),radius:5e3,keyword:e},n)},onCallback:function(t){this.queryOut=!1,this.p.as.cache.put(this.query.getSearch(t),this.allResults),this.receiveResults(this.allResults,t)},receiveResults:function(t,e){for(var i=0;i<t.length;i++)this.results.push(t[i]);e++,e<this.query.getNumSearches()?this.fetchResults(e):this.p.as.handleResults(new RawResults(this.results.length?this.results:null,this.query),this.callback,function(t){return t.titleNoFormatting})},fetch:function(t,e){this.query=t,this.callback=e,this.results=[],this.allResults=[],this.fetchResults(0)},getPhoneNumber:function(t,e){var i=function(t,i){var n="";i==google.maps.places.PlacesServiceStatus.OK&&t.formatted_phone_number&&(n=t.formatted_phone_number),e(n)},n=new google.maps.places.PlacesService(this.app.app.map);n.getDetails({reference:t},i)},resultClass:function(){return AmenityResult},nameFinder:function(t){return t.titleNoFormatting},resultParameters:function(t){return{lat:t.geometry.location.lat(),lng:t.geometry.location.lng(),name:t.name,address:t.formatted_address,fetchPhone:this.getPhoneNumber,reference:t.reference}}},"Transit-API":{url:function(){return"/data/get-transit-data.php"},prepopFromServer:function(t){return _(window).spelunk(["_get_data_prepop","tst"])},params:function(){return{q:"stops",lat:encodeURI(this.p.as.geoData.getLat()),lon:encodeURI(this.p.as.geoData.getLng())}},makeAmenitiesFromRawResults:function(t){return this.app.amenityManager.initializeTransitResultsAndRoutes(t,this.app.geoData),this.app.amenityManager.getFeaturedTransitResults()},buildHTML:function(t){var e=this.app.map,i=[],n=t.getRoutes(),s=new RouteList,o=new StringList;for(var a in n)o.addIfUnique(n[a].getAgencyUrl()),s.add(n[a]);if(s.sortByTypeAndName(),e&&e.optionFlags.infoWindow==AmenityMap.SMALL_INFO_WINDOWS){var r=e.geoData.getUrl()+"?utm_source="+tileDomain+"&utm_campaign=ws_tile&show=t_"+encodeURIComponent(t.getKey());i.push('<div class="iw">'),i.push('<div class="iw-title">'),nolink_bubbles?i.push(t.name):i.push('<a href="'+r+'&utm_medium=bubble_details" target="_blank" title="Click for more info" onclick="trackEvent(\'tile\', \'result name clickthrough\', \''+t.getCategory()+"');\">"+t.name+"</a>"),i.push("</div>"),i.push('<div class="iw-body">');for(var u=Math.min(14,s.length()),a=0;u>a;a++){var l=s.getRoute(a);a>0&&i.push(", "),i.push(l.getName())}i.push("</div>"),i.push("</div>")}else{i.push('<div class="iw">'),i.push('<div class="iw-title">'+t.name+"</div>"),i.push('<div class="iw-body">');for(var u=Math.min(14,s.length()),a=0;u>a;a++){var l=s.getRoute(a);i.push('<div class="iw-transit-route '+l.getCategory()+'">'+l.getName()+"</div>")}u<s.length()&&i.push('<div style="float:right;">and '+(s.length()-u)+" additional routes</div>"),i.push("</div>");for(var a=0;a<o.length();a++)i.push('<div class="iw-body" style="clear: both;"><a href="'+o.get(a)+'" target="_blank" onclick="trackEvent(\''+ACTIVE_COMPONENT+"', 'transit result agency clickthrough', '"+trimURL(o.get(a))+"');\">"+trimURL(o.get(a))+"</a></div>");i.push("</div>")}return $(i.join(""))[0]},buildToolTipHTML:function(t){var e=$("<div />",{"class":"summary transit"});return routes=t.routes||[],imgBase="//cdn2.walk.sc/2/images/icons/",_([0,1,2]).each(function(t){r=routes[t],r&&e.append($("<div />",{"class":"iw-transit-route "+r.category}).html(r.name))}),e}},"Education.com":{url:function(){return"/data/get-school-data.php"},resultClass:function(){return AmenityResult},resultParameters:function(t){var e=t.school;if(e&&e.enrollment&&e.enrollment>=10)return{lat:e.latitude,lng:e.longitude,url:e.url,name:e.schoolname,address:e.address,city:e.city,region:e.state,phoneNumber:e.phonenumber,stuTeaRatio:e.studentteacherratio,gradelevel:e.gradelevel,gradesserved:e.gradesserved,schooltype:e.schooltype,enrollment:e.enrollment}},buildHTML:function(t){var e=this.app.map,i=[];if(e&&e.optionFlags.infoWindow==AmenityMap.SMALL_INFO_WINDOWS){var n=e.geoData.getUrl()+"?utm_source="+tileDomain+"&utm_campaign=ws_tile&show="+encodeURIComponent(t.getKey());i.push('<div class="iw iw-school">'),i.push('<div class="iw-title">'),nolink_bubbles?i.push(t.name):i.push('<a href="'+n+'" target="_blank" title="Click to view details" onclick="trackEvent(\''+ACTIVE_COMPONENT+"', 'result  clickthrough', '"+t.getCategory()+"');\">"+t.name+"</a>"),i.push("</div>"),i.push("<div>"+t.getStreetAddress()+"</div>"),nolink_bubbles||i.push('<div><a href="'+n+'&utm_medium=bubble_details" target="_blank" title="Click for more info" onclick="trackEvent(\'tile\', \'result details clickthrough\', \''+t.getCategory()+"');\">View details</a></div>"),i.push(this.p.as.removeFlagHtml(t)),i.push("</div>")}else i.push('<div class="iw iw-school">'),i.push('<div class="iw-title"><a href="'+t.url+'" target="_blank" title="Click to view details" onclick="trackEvent(\''+ACTIVE_COMPONENT+"', 'result  clickthrough', '"+t.getCategory()+"');\">"+t.name+"</a></div>"),t.schooltype&&i.push("<strong>Type:</strong> "+t.schooltype+"<br />"),t.gradesserved&&i.push("<strong>Grades:</strong> "+t.gradesserved+"<br />"),t.stuTeaRatio&&i.push("<strong>Student/Teacher ratio:</strong> "+t.stuTeaRatio+"<br />"),t.enrollment&&i.push("<strong>Enrollment:</strong> "+t.enrollment+"<br />"),i.push(t.getLocation(!0)+"<br />"),null!=t.phoneNumber&&i.push(t.getPhoneNumber()),i.push('<div class="schools-logo"><a target="_blank" href="'+t.url+'" onclick="trackEvent(\''+ACTIVE_COMPONENT+"', 'result attribution clickthrough', 'education.com');\"><img src=\"//cdn2.walk.sc/2/images/education-logo.jpg\"></a></div>"),i.push("</div>");return $(i.join(""))[0]},buildToolTipHTML:function(t){var e=$("<div />",{"class":"summary school"});return _([["name","name"],["grades","gradesserved","Grades: "],["enrollment","enrollment","Erollment: "]]).each(function(i){e.append($("<div />",{"class":i[0]}).append($("<span />",{"class":"label"}).html(i[2]||"")).append($("<span />",{"class":"value"}).html(t[i[1]]||"")))}),e}},"Parks-API":{url:function(){return"/data/get-parks-data.php"},resultClass:function(){return AmenityResult},extraAjaxParams:function(){return{timeout:6e4}},resultParameters:function(t){return t.name&&t.center?{lat:t.center[0],lng:t.center[1],url:safeString(t.url),name:t.name}:void 0},buildHTML:t},"Parks-V2":{fetch:function(t,e){if(!this.p.app.getBounds)throw new Error("App must implement getBounds to use Parks-V2");if(!this.p.app.parksService)throw new Error("App needs a parksService to use Parks-V2");this.p.app.parksService.withBounds(this.p.app.getBounds(),_(function(i){this.query=t,this.callback=e,this.receiveResults(i)}).bind(this))},nameFinder:function(t){return t.name},resultClass:function(){return AmenityResult},resultParameters:function(t,e){return{lat:t.lat,lng:t.lng,name:t.name,url:t.url,encpoly:t.encpoly}},buildToolTipHTML:function(t,e){var i=$("<div />",{"class":"summary"}),n=$("<img />",{"class":"park-tooltip-default",src:"//cdn2.walk.sc/2/images/icons/park2.png"}),s=t.toolTipBody=$("<div />").append(n).append(i);return _([["name",t.name]]).each(function(t){t[1]&&i.append($("<div />",{"class":t[0]}).append($("<span />",{"class":"label"}).html(t[2]||"")).append($("<span />",{"class":"value"}).html(t[1]||"")))}),s},buildHTML:t},Bing:{url:function(){return"/data/get-bing-phonebook-results.php"},params:function(t){return{lat:this.p.as.geoData.getLat(),lng:this.p.as.geoData.getLng(),q:encodeURI(t.search.join(" & "))}},resultListFinder:function(t){return _(t).spelunk(["SearchResponse","Phonebook","Results"])},nameFinder:function(t){return t.Business},resultClass:function(){return AmenityResult},resultParameters:function(t,e){return{lat:t.Latitude,lng:t.Longitude,url:safeString(t.Url),name:t.Business,address:t.Address,city:t.City,region:t.State,phoneNumber:t.PhoneNumber}}},Places:{url:function(){return"/data/get-google-places-results.php"},params:function(t){return{latlng:[this.p.as.geoData.getLat(),this.p.as.geoData.getLng()].join(","),types:encodeURI(t.search.join("|"))}},resultListFinder:function(t){return t.results},nameFinder:function(t){return t.name},resultClass:function(){return AmenityResult},resultParameters:function(t,e){return{lat:t.geometry.location.lat,lng:t.geometry.location.lng,name:t.name}}},PlacesTextSearch:{url:function(){return"/data/get-google-places-textsearch-results.php"},params:function(t){return{latlng:[this.p.as.geoData.getLat(),this.p.as.geoData.getLng()].join(","),query:encodeURI(t.search.join("|"))}},resultListFinder:function(t){return t.results},nameFinder:function(t){return t.name},resultClass:function(){return AmenityResult},resultParameters:function(t,e){return{lat:t.geometry.location.lat,lng:t.geometry.location.lng,name:t.name}}},PlacesV1:{url:function(){return"/auth/places/v1/get-places-amenity-list-endpoint"},params:function(t){return{lat:this.p.as.geoData.getLat(),lng:this.p.as.geoData.getLng(),cat_id:t.search[0]}},resultListFinder:function(t){return t},nameFinder:function(t){return t.name},resultClass:function(){return AmenityResult},resultParameters:function(t,e){if(_(window).spelunk(["google","maps"])){if(!(t.icon instanceof google.maps.MarkerImage)){var i=_(function(t){return this.app.amenityManager.iconFactory.createIconFromSS(t.split("/")[1],this.app.highRes)}).bind(this),n=t.icon;t.icon=i(n),t.iconSel=i(n+"-on")}}else{if(t.iconSel)var s=t.icon.url,o=t.iconSel.url;else var s="//cdn2.walk.sc/2/images/places/pin/"+t.icon+(this.app.resModifier||"")+".png",o="//cdn2.walk.sc/2/images/places/pon/"+t.icon+(this.app.resModifier||"")+".png";t.icon=s,t.iconSel=o}return t.phoneNumber=t.phone,t}},Local:{fetch:function(t,e){this.p.app.localAmenityService.withCategory(t.name,_(function(i){this.query=t,this.callback=e,this.receiveResults(i)}).bind(this))},nameFinder:function(t){return t.stdname},resultClass:function(){return AmenityResult},resultParameters:function(t,e){var i=function(e,i){return _([_(i).map(function(e){return t[e]||[]})]).flatten().join(e)},n=i(" ",["housenumber","predirectional","streetname","streettype","postdirectional","apttype","aptnumber"]),s=i("-",["areacode","exchange","phonenumber"]);return{pid:t.pid,lat:t.lat,lng:t.lng,name:t.stdname,address:n,city:t.city,region:t.state,phoneNumber:s}}},CarShares:function(){var t={zip_car:"ZipCar<sup>&reg;</sup>",igo:"I-GO<sup>&reg;</sup>",enterprise:"Enterprise CarShare<sup>&reg;</sup>",wecar:"WeCar<sup>&reg;</sup>",getaround:"Getaround",city_carshare:"City CarShare<sup>&reg;</sup>",hertz:"Hertz On Demand<sup>&trade;</sup>"},e={zip_car:"www.zipcar.com",igo:"www.igo.com",enterprise:"www.enterprisecarshare.com",wecar:"www.wecar.com",getaround:"www.getaround.com",city_carshare:"www.citycarshare.org",hertz:"www.hertzondemand.com"};return{fetch:function(t,e){if(!this.p.app.getBounds)throw new Error("App must implement getBounds to use CarShares");if(!this.p.app.carShareService)throw new Error("App needs a carShareService to use CarShares");this.p.app.carShareService.withBounds(this.p.app.getBounds(),_(function(i){this.query=t,this.callback=e,this.receiveResults(i)}).bind(this))},nameFinder:function(t){return t.name},resultClass:function(){return AmenityResult},resultParameters:function(t,e){return{lat:t.lat,lng:t.lng,name:t.name,url:t.url,provider:t.custom_key}},buildHTML:function(i,n){var s=[],o="";return s.push('<div class="iw">'),i.url,s.push('<div class="iw-title">'+i.name+"</div>"),s.push('<div><span class="label">Provider: </span><span class="value">'+t[i.provider]+"</span></div>"),s.push('<p><a href="http://'+e[i.provider]+'" target="_blank" title="Click to view details" onclick="trackEvent(\''+ACTIVE_COMPONENT+"', 'car share clickthrough', '"+i.provider+"');\">"+e[i.provider]+"</a></p>"),s.push(o),s.push("</div>"),$(s.join(""))[0]},buildToolTipHTML:function(e){var i=$("<div />",{"class":"summary car-share"}),n=$("<img />",{"class":"car-share-tooltip-default",src:"//cdn2.walk.sc/2/images/icons/car-share.png"}),s=e.toolTipBody=$("<div />").append(n).append(i);return _([["name",e.name],["provider",t[e.provider],"Provider: "],["cars",e.cars,"Cars: "]]).each(function(t){t[1]&&i.append($("<div />",{"class":t[0]}).append($("<span />",{"class":"label"}).html(t[2]||"")).append($("<span />",{"class":"value"}).html(t[1]||"")))}),s}}}(),Yelp:{url:function(){return"http://api.yelp.com/v2/search"},ajaxRequest:function(t){var e={consumerKey:"YeAjHh30B0O9ktMHfR2DxA",consumerSecret:"I4Bus4pi8HfFre3lIa2vCDsPutA",accessToken:"XnTIdBWQmqSdTe_YitwmUwvyzcKKP3Ma",accessTokenSecret:"N8fHqMQTV1KiqAFKSEADWiKfB8s",serviceProvider:{signatureMethod:"HMAC-SHA1"}},i=(t.search.join(","),{consumerSecret:e.consumerSecret,tokenSecret:e.accessTokenSecret}),n=this.app.geoData.getLatLng(),s=[["category_filter",t.search.join(",")],["ll",n.lat()+","+n.lng()],["callback","cb"],["oauth_consumer_key",e.consumerKey],["oauth_consumer_secret",e.consumerSecret],["oauth_token",e.accessToken],["oauth_signature_method","HMAC-SHA1"]],o={action:this.url(t),method:"GET",parameters:s};OAuth.setTimestampAndNonce(o),OAuth.SignatureMethod.sign(o,i);var a=OAuth.getParameterMap(o.parameters);return{url:o.action,data:a,dataType:"jsonp",jsonpCallback:"cb",cache:!0}},resultListFinder:function(t){return t.businesses},nameFinder:function(t){return t.name},resultClass:function(){return AmenityResult},resultParameters:function(t,e){var i=t.location||{},n=i.coordinate||{};return{lat:n.latitude,lng:n.longitude,url:safeString(t.Url),yelpBiz:t.rating?t:null,name:t.name,address:(i.address||[])[0],city:i.city,region:i.state_code,phoneNumber:t.phone}}}};for(var i in e)e[i].id=i;var n=DataSourceManager.prototype,s=function(t,e){var i=function(t){_(this).extend(t)};i.prototype=new(e||function(){});for(var n in t)i.prototype[n]=t[n];return i};n.init=function(){var t=s(e[""]);this.p=this,this.m=_(_(e).keys()).reduce(_(function(i,n){return i[n]=new(s(e[n],t))(this),i}).bind(this),{})},n.setAmenityService=function(t){return this.as=t,this},n.dispatch=function(t,e){var i=this.m[t][e];return i?_(i).bind(this.m[t]):void 0},n.getReviewHelper=function(){var t=_(this).spelunk(["app","map","reviewHelper"])||_(this).spelunk(["app","reviewHelper"]);return t},n.getPlaceImage=function(t,e,i){$.ajax({type:"GET",url:"/auth/places/v1/get-place-photos",data:{place_id:t,size:e,aspect:"s"},success:function(t){i(t.length?t[0]:null)},error:function(){i(null)}})},n.getImageHtml=function(t,e,i,n){var s=n?"":"background-image: url("+(t||DEFAULT_PLACE_IMAGE)+");";return'<div class="iw-image img-shadow '+(n?"preload":"")+'"><div style="'+s+" width:"+e+"px; height:"+e+'px;"></div>'+(n?'<span class="progress"></span>':"")+(i?'<p class="caption-in">'+i+"</p>":"")+"</div>"},n.formatPhoneNumber=function(t){return 10==t.length&&(t=t.substr(0,3)+"-"+t.substr(3,3)+"-"+t.substr(6)),t}}(),function(){var t=AmenityQuery.prototype;t.getService=function(){return this.service},t.getName=function(){return this.name},t.getShortName=function(){return this.short_name},t.getIconName=function(){return this.icon},t.getSearch=function(t){return this.search[t]},t.getNumSearches=function(){return this.search.length},t.getExceptions=function(t){return this.exceptions},t.isCustom=function(){return this.isCustomQuery},t.getGroupName=function(){return this.groupName},t.actsLikeCustom=function(){return this.isCustomQuery||this.showOnCustomCard}}(),AmenityService.prototype.removeFlagHtml=function(t,e){var i='onclick="app.showRemoveAmenityDialog(currently_open_amenity);"';return t.displayQuery.isCustomQuery?"":e?'<div class="edit-place"><a '+i+'><div class="icon flag"></div>Edit place</a></div>':'<div class="info-link b-btn light" '+i+'><div class="icon"></div></div>'},ActionQueue.prototype.length=function(){return this.list.length},ActionQueue.prototype.add=function(t,e){this.list.push({data:t,callback:e})},ActionQueue.prototype.getCurrentData=function(){return this.list[0].data},ActionQueue.prototype.getCurrentCallback=function(){return this.list[0].callback},ActionQueue.prototype.getDataAt=function(t){return this.list[t].data},ActionQueue.prototype.getCallbackAt=function(t){return this.list[t].callback},ActionQueue.prototype.removeCurrent=function(){this.list.splice(0,1)},ActionQueue.prototype.removeAt=function(t,e){var e=defaultIfNotSet(e,1);this.list.splice(t,e)},RawResults.prototype.gotData=function(){return null!=this.results},RawResults.prototype.getService=function(){
return this.query.service},RawResults.prototype.getGroupName=function(){return this.query.groupName},RawResults.prototype.getResults=function(){return this.results},RawResults.prototype.getResult=function(t){return null==this.results?null:this.results[t]},RawResults.prototype.getResultsLength=function(){return null==this.results?0:this.results.length},RawResults.prototype.getQuery=function(){return this.query},RawResults.prototype.filterOutExceptions=function(t){var e=this.query.getExceptions();if(e&&t){var i=[];for(var n in this.results){var s=(t(this.results[n])||"").toLowerCase();s&&(_(e).detect(function(t){return-1!=s.indexOf(t)})||i.push(this.results[n]))}this.results=i}return this},function(){var t=LocalAmenityService.prototype;t.setQueryList=function(t){return i=t,this},t.setBucketMin=function(t){return c=t,this},t.setLocation=function(t){return e=t,y(),this},t.withCategory=function(t,e){return g(t,e),this},t.withFiltered=function(t,e){return g(t,e,!0),this},t.withAll=function(t){return g("",t),this},t.withAllFiltered=function(t){return g("",t,!0),this},t.expect=function(t){return m(t),this},t.populate=function(t,e){return v(t,e),this};var e,i,n={},s={},o={},a={},r=!1,u=!1,l=1,c=8,h="localeze_server",d="customQueries",p=$.browser.msie&&$.browser.version<8,g=function(t,e,i){n[t]||(n[t]=[]),n[t].push([e,i]),f(),y()},f=function(){if(u)for(var t in n)if(!a[t]){var e=n[t];n[t]=[],_(e).each(function(e){var n=e[0],o=e[1],a=_(t?[s[t]||[],_((i.by_name[t]||{}).includes||[]).map(function(t){return s[t.name]||[]})]:[_(s).values()]).flatten();o?b(a,n):n(a)})}},m=function(t){if(r)throw new Error("Must call expect before setLocation");a[t]=!0},v=function(t,e){if(!a[t])throw new Error("Receiving amenities for unexpected category: "+t);delete a[t],s[t]=e,f()},y=function(){r||e&&_(n).keys().length&&(r=!0,u=!1,s={},p?C(null):i?w():new DataFetcher(h).requestPrivate(d,e,w))},w=function(t){i||(i=new QueryList(t,d));var n=_(i.getAllQueries()).chain().map(function(t){if("local"!=(t.api||""))return[];var e=t.search||[];_(e).each(function(e){o[e]=t.name});for(var i=t;i.isChild();)i=i.parentQuery();return i.name}).flatten().uniq().value(),s={custom:"customize",customQueries:"customize",travelQueries:"tile-travel",commercialQueries:"tile-commercial"}[i.groupName||""]||"";$.ajax({url:"/local-amenities",type:"GET",dataType:"json",timeout:6e4,success:C,error:_(C).bind({},null),data:{lat:e.latLng.lat(),lng:e.latLng.lng(),bucket_min:c,slice:s,r:1,buckets:n.join("||")}})},b=function(t,i){i(_(t||[]).filter(function(t){var i=new ws.LatLng(t.lat,t.lng);return i.distanceFrom(e.latLng)/1e3*.621371192<l}))},C=function(t){_(t||[]).each(function(t){var e=t.bucket;s[e]||(s[e]=[]),s[e].push(t)}),u=!0,f()}}(),function(){var t=CarShareService.prototype;t._URL="/auth/rentals/carshares",t.getProviders=function(){return this._getProviders()},BoxCachedAmenityMixin(t),t._getProviders=function(){return _(this._results||[]).oreduce(function(t,e){t[e.custom_key]=!0})}}(),function(){var t=ParksService.prototype;t._URL="/auth/rentals/parks",BoxCachedAmenityMixin(t,{buffer:5})}(),WSEvent.prototype.getActionIdx=function(t,e,i){if(t){var n=this.evts[t];if(!n)return-1;for(var s=n.length,o=s-1;o>=0;o--)if(n[o].action==e&&n[o].binding==i)return o}return-1},WSEvent.prototype.addListener=function(t,e,i){if(this.evts[t]){if(-1==this.getActionIdx(t,e,i)){var n=this.evts[t];n[n.length]={action:e,binding:i}}}else this.evts[t]=[],this.evts[t][0]={action:e,binding:i}},WSEvent.prototype.removeListener=function(t,e,i){if(this.evts[t]){var n=this.actionExists(t,e,i);n>=0&&this.evts[t].splice(n,1)}},WSEvent.prototype.fireEvent=function(t,e,i){if(i||(i=[]),this.evts){var n=this.evts[e];if(n)for(var s=0;s<n.length;s++){var o=n[s].action;n[s].binding?o&&o.apply(n[s].binding,i):o&&o(i,t)}}return!1};var appEvents=new WSEvent;!function(){var t;GoogleGeocoder.prototype.geocode=function(e,i){return t||(t=new google.maps.Geocoder),e.latLng&&(e.latLng=e.latLng.ws_coerce("google")),t.geocode(e,i)}}(),AmenityMap.DEFAULT_ZOOM=15,AmenityMap.LARGE_INFO_WINDOWS=30,AmenityMap.SMALL_INFO_WINDOWS=31,AmenityMap.prototype.init=function(t,e,i){this.elem=t,this.geoData=e,this.optionFlags=i;var n="number"==typeof this.optionFlags.zoom?this.optionFlags.zoom:this.DEFAULT_ZOOM;this.mapWidget&&(this.mapWidget.goTo(e.getLatLng(),n),this.gmap=this.mapWidget.map),e&&this.mod_do("goTo")(e.getPreSnapLatLng(),n),$.browser.msie||t.click(_(this.closePreviouslyOpenedWindow).bind(this));var s=t;if(this.transitShedMaxTime=this.optionFlags.transitShedMaxTime||60,e){var o=_(_(function(){this.activeModule?this.activateModule(this.activeModule):_(o).delay(100)}).bind(this)).max_attempts(300);if(this.optionFlags.enableRecenter&&(this.recenter=function(){this.mod_do("resize")()}),this.optionFlags.enableJiggle)if(0==s.height()){var a=_(function(){s.height()?(this.mod_do("resize")(),_(o).delay(100)):_(a).delay(100)}).bind(this);a()}else $(window).bind("mouseover mousedown",_(_(function(){this.mod_do("resize")(),o()}).bind(this)).memoize(function(){return"only once"}))}this.shown={},this.order={},this.onlyVisibleCat=null,this.reviewHelper=new YelpHelper,this.optionFlags.showContextMenu&&this.activateContextMenu(),this.setShowRange()},AmenityMap.prototype.GMap=function(){return this.gmap},AmenityMap.prototype.showResult=function(t){this.mod_do("addOverlay")(t.getMarker())},AmenityMap.prototype.setIWSize=function(t){this.optionFlags.infoWindow=t},AmenityMap.prototype.a_d=function(t,e){var i=t.query?t.query.getService():t.getDataSource();return this.dataSourceManager.dispatch(i,e)},AmenityMap.prototype.addCustomTypeControl=function(t){return this.customTypeControl=new CustomMapTypeControl(this.gmap),this.customTypeControl.addToContainer(this.elem.parent()),this.customTypeControl},AmenityMap.prototype.routeAllAmenities=function(){for(var t=_(this.shown).flattenObject(1),e=0;e<t.length;e++)this.queueAmenityRoute(t[e],!0);this.fetchQueuedRoutes()},AmenityMap.prototype.enableRouting=function(){this.displayedRoutes={},this.permanentRoutes={},this.routing=new RoutingService,this.routing.setDefaultStart(this.geoData.getPreSnapLatLng())},AmenityMap.prototype.hidePermanentRoutesExcept=function(t){for(var e in this.permanentRoutes)e!=t.getHighResKey()&&this.hideRoute(e,!0)},AmenityMap.prototype.restorePermanentRoutes=function(){for(var t in this.permanentRoutes)this.displayedRoutes[t]||this.showRoute(t)},AmenityMap.prototype.queueAmenityRoute=function(t,e){var i=t.getHighResKey();this.displayedRoutes[i]||t.isRemoved()||(this.routing.queueRoute(i,this.geoData.getPreSnapLatLng(),t.getPoint(),bindCallback(this,this.onRouteReceived),{permanent:e,name:t.getName()}),this.displayedRoutes[i]=!0),e&&(this.permanentRoutes[i]=!0)},AmenityMap.prototype.fetchQueuedRoutes=function(){this.routing.runQueuedRequests()},AmenityMap.prototype.onRouteReceived=function(t,e){t&&this.displayedRoutes[e.id]&&this.mod_do("addOverlay")(t)},AmenityMap.prototype.showRoute=function(t){var e=this.routing.getCachedRoute(t);e&&(this.displayedRoutes[t]=!0,this.mod_do("addOverlay")(e))},AmenityMap.prototype.hideRoute=function(t,e){if(this.displayedRoutes[t]&&(e||!this.permanentRoutes[t])){var i=this.routing.getCachedRoute(t);i&&this.mod_do("removeOverlay")(i),delete this.displayedRoutes[t]}},AmenityMap.prototype.showAmenityMarkers=function(t,e){_(e||[]).each(_(function(e){e.isRemoved()?e.isRemoved()&&this.attemptRemoveMarker(t,e):this.attemptShowMarker(t,e)}).bind(this))},AmenityMap.prototype.updateAmenityMarkers=function(t,e){var i=_(this).spelunk(["previouslyOpenedWindow","amenity"]);for(var n in this.shown[t])this.attemptRemoveMarker(t,this.shown[t][n]);this.showAmenityMarkers(t,e),i&&i.category==t&&this.shown[t][i.getHighResKey()]&&this.showAmenityInfo(i)},AmenityMap.prototype.removeAmenityMarkers=function(t,e){if(e&&e.length>0)for(var i=0;i<e.length;i++)this.attemptRemoveMarker(t,e[i])},AmenityMap.prototype.attemptShowMarker=function(t,e){var i=this.onlyShowRange,n=i[0],s=i[1];if("object"!=typeof this.shown[t]&&(this.shown[t]={},this.order[t]=[]),!this.shown[t][e.getHighResKey()]){this.shown[t][e.getHighResKey()]=e,this.order[t].push(e);var o=this.order[t].length-1;if((!this.onlyVisibleCat||this.onlyVisibleCat==t)&&(!this.onlyShowCustom||e.displayQuery.isCustom())){var a=o>=n&&s>o;this.mod_do("addOverlay")(e.getMarker()),this.mod_do("setMarkerVisibility")(e.getMarker(),a)}}},AmenityMap.prototype.attemptRemoveMarker=function(t,e){if(this.shown[t]&&this.shown[t][e.getHighResKey()]){var i=e.getHighResKey();delete this.shown[t][i],this.order[t]=_(this.order[t]).reject(function(t){return t.getHighResKey()==i}),this.mod_do("deselectAmenityMarker")(e),this.mod_do("removeOverlay")(e.getMarker()),this.closePreviouslyOpenedWindow()}},AmenityMap.prototype.setShowRange=function(t,e){return _(t).isUndefined()?this.onlyShowRange=this._oSRDef||(this._oSRDef=[0,8]):this.onlyShowRange=[t,e]},AmenityMap.prototype.onlyShowCat=function(t,e,i){this.onlyVisibleCat=t,this.onlyShowCustom=!1;var n=this.setShowRange(e,i);e=n[0],i=n[1];var s=[];for(var o in this.order)_(this.order[o]).each(_(function(n,a){var r=!1;o==t&&a>=e&&i>a&&(s.push(n),r=!0),this.mod_do("setMarkerVisibility")(n.getMarker(),r)}).bind(this));if(s.length>1&&this.mod_do("fitBounds")(_(s).reduce(function(t,e){return t.extend(e.getPoint())},new ws.LatLngBounds(this.geoData.getLatLng()))),this.lastSelected){var a=this.lastSelected.getHighResKey();_(s).detect(function(t){return t.getHighResKey()==a})||this.closePreviouslyOpenedWindow()}},AmenityMap.prototype.onlyShowCustomCats=function(){this.onlyShowCustom=!0,this.onlyVisibleCat=null,this.lastSelected&&!this.lastSelected.displayQuery.actsLikeCustom()&&this.closePreviouslyOpenedWindow();var t=[];for(var e in this.shown)_(this.shown[e]).each(_(function(e){e.displayQuery.actsLikeCustom()?(t.push(e),this.mod_do("setMarkerVisibility")(e.getMarker(),!0)):this.mod_do("setMarkerVisibility")(e.getMarker(),!1)}).bind(this));t.length>1&&this.mod_do("fitBounds")(_(t).reduce(function(t,e){return t.extend(e.getPoint())},new ws.LatLngBounds(this.geoData.getLatLng())))},AmenityMap.prototype.restoreAllCats=function(){this.closePreviouslyOpenedWindow(),this.mod_do("goTo")(this.geoData.getPreSnapLatLng(),this.optionFlags.zoom||AmenityMap.DEFAULT_ZOOM);var t=this.setShowRange(),e=t[0],i=t[1];for(var n in this.shown)n!=this.onlyVisibleCat&&_(this.order[n]).each(_(function(t,n){var s=n>=e&&i>n;this.mod_do("setMarkerVisibility")(t.getMarker(),s)}).bind(this));this.onlyVisibleCat=this.onlyShowCustom=null},AmenityMap.prototype.selectAmenityMarker=function(t,e){this.deselectLastSelectedAmenityMarker();var i=this.mod_do("selectAmenityMarker",_(function(){this.lastSelected=t}).bind(this));this.optionFlags.highlightSelectedAmenity?i(t,e):i(null),this.optionFlags.showRouteOnSelect&&this.hidePermanentRoutesExcept(t)},AmenityMap.prototype.deselectLastSelectedAmenityMarker=function(){this.lastSelected&&(this.optionFlags.highlightSelectedAmenity&&this.lastSelected.getMarkerSel&&this.mod_do("deselectAmenityMarker")(this.lastSelected),this.optionFlags.showRouteOnSelect&&this.restorePermanentRoutes()),this.lastSelected=null},AmenityMap.prototype.getCachedIWContent=function(t){return t.getUniqueId?this.cache.get(t.getUniqueId()):null},AmenityMap.prototype.cacheIWContent=function(t,e){t.getUniqueId&&this.cache.put(t.getUniqueId(),e)},AmenityMap.prototype.showAmenityInfoWithSlowPan=function(t,e,i,n){this.showAmenityInfo(t,n,e,i)},AmenityMap.prototype.showAmenityInfo=function(t,e,i,n){this.selectHandler&&(GEvent.removeListener(this.selectHandler),this.selectHandler=null);var s=this.getCachedIWContent(t);if(!s){var s=this.buildAmenityHTML(t);this.cacheIWContent(t,s)}window.currently_open_amenity=t,this.showAmenityInfoInternal(t,s,e),this.optionFlags.autoShowTransit&&"Transit-API"==t.getDataSource()&&this.addTransitLayer(),this.mod_do("customPanTo")(t.getPoint(),i,n)},AmenityMap.prototype.forceClosePreviouslyOpenedWindow=function(){this.previouslyOpenedWindow&&this.mod_do("closeInfoWindow")(this.previouslyOpenedWindow),this.previouslyOpenedWindow=null,this.deselectLastSelectedAmenityMarker()},AmenityMap.prototype.closePreviouslyOpenedWindow=function(){return ensureWSUnderscoreMixins(),_(function(){this.forceClosePreviouslyOpenedWindow(),this.mod_deselect()}).recharge(50)}(),AmenityMap.prototype.showAmenityInfoInternal=function(t,e,i){DEBUG_CURATION&&dbug("showing: "+t.getName()+" with key: "+t.getKey());var n=this.optionFlags.infoWindow==AmenityMap.SMALL_INFO_WINDOWS;this.iwContent=$(e),this.a_d(t,"wireUpHTML")(this.iwContent,t);var s=new ws.InfoWindow({content:this.iwContent,isSmall:n});s.setOptions({}),this.forceClosePreviouslyOpenedWindow(),s.amenity=t,this.previouslyOpenedWindow=s,this.mod_do("openInfoWindow")(s,t,i),this.selectAmenityMarker(t,i)},AmenityMap.prototype.addTransitLayer=function(){this.gmap.addTransitLayer()},AmenityMap.prototype.removeTransitLayer=function(){this.gmap.removeTransitLayer(),GEvent.removeListener(this.transitLayerListener)},AmenityMap.prototype.buildAmenityHTML=function(t){return this.a_d(t,"buildHTML")(t)},AmenityMap.prototype.updateInfoWindow=function(t,e,i,n){e.find(i).replaceWith(n),this.cacheIWContent(t,e[0].outerHTML)},AmenityMap.prototype.htmlTitle=function(){},AmenityMap.prototype.htmlCurationLinks=function(t){var e=[];return e.push('<div class="curate-links dull-link"><a class="flagged remove-place-link">Remove place</a>'),_(["Curated","Google","Local"]).include(t.getDataSource())&&e.push('<a class="edit-place-link">Edit</a>'),e.push("</div>"),e.join("")},AmenityMap.prototype.activateContextMenu=function(){this.mod_do("activateContextMenu")()},AmenityMap.prototype.showAds=function(){var t=Array.prototype.slice.call(arguments),e=_(_(function(){this.gmap?showAdsOnMap.apply(this.gmap,t):_(e).delay(100)}).bind(this)).max_attempts(100);e()},AmenityMap.prototype.isBigEnoughForAds=_(function(){return this.elem.width()*this.elem.height()>=100368}).memoize(function(){return"only once"}),AmenityMap.prototype.renderBox=function(t,e,i,n){var s=[new ws.LatLng(t,e),new ws.LatLng(t,n),new ws.LatLng(i,n),new ws.LatLng(i,e),new ws.LatLng(t,e)],o=new google.maps.Polygon({paths:s,fillColor:"#4ead42",strokeWeight:1,strokeOpacity:.5,strokeColor:"#4ead42",fillOpacity:.2});this.mod_do("addOverlay")(o)};var mapKeyDisplayer=function(t,e){return function(){var i=$("#g-overlay"),n="dunno";_(function(){var s=i.find(".enticement"),o=s.length?"yes":"no";if(o!=n){n=o,$("#"+t).remove();var a=$("<div />",{id:t,"class":"map_key"}).css("right",s.width()+16+"px").css("height",s.height()+"px");s.closest("#g-overlay")&&a.css("top",s.closest("#g-overlay").css("top")),_(e()).each(function(t){a.append(t)}),i.after(a)}}).thump(250,40)}};AmenityMap.prototype.showWalkabilityKey=mapKeyDisplayer("walkability_map_key",function(){return[$("<img />",{id:"walkability_map_spectrum",src:"//cdn2.walk.sc/2/images/map-spectrum-25.png"}),$("<div />",{"class":"worst"}).html("25"),$("<div />",{"class":"best"}).html("100"),$("<div />",{"class":"background"})]}),AmenityMap.prototype.hideWalkabilityKey=function(){$("#walkability_map_key").remove()},AmenityMap.prototype.showWalkShedKey=mapKeyDisplayer("walkshed_map_key",function(){return[$("<div />",{"class":"walkshed_color"}),$("<div />",{"class":"walkshed_label"}).html("15 min walk"),$("<div />",{"class":"background_solid"})]}),AmenityMap.prototype.hideWalkShedKey=function(){$("#walkshed_map_key").remove()},AmenityMap.prototype.showTransitKey=mapKeyDisplayer("transit_map_key",function(){return[$("<div />",{"class":"transit_label"}),$("<div />",{"class":"background_solid"})]}),AmenityMap.prototype.hideTransitKey=function(){$("#transit_map_key").remove()},AmenityMap.prototype.showTransitSlider=function(){var t=$("#transit_map_key"),e=t.find(".transit_label"),i=$("<div />",{id:"transit_slider"}).css("width","200px").css("right",t.width()+$("#g-overlay").width()+"px");$("#g-overlay").after(i);var n=_(function(t){e.html(t+" min transit"),this.transitShed.setTravelTime(t)}).bind(this),s=this.transitShedMaxTime;i.slider({range:!1,min:0,value:s,max:this.transitShedMaxTime,slide:function(t,e){n(e.value)}}),_(_(function(){this.gmap.fitBounds(this.transitShed.getBoundingBox()),this.gmap.setZoom(this.gmap.getZoom()+1),this.transitShed.setMap(this.gmap),n(s)}).bind(this)).delay(100)},AmenityMap.prototype.hideTransitSlider=function(){this.transitShed.setMap(null),$("#transit_slider").remove()},function(){"use strict";var t=[{name:"Google Map",id:"mod_google_map",api:"google",is_default:!0,enable:function(t){this.googleMap||(this.googleMap=new GoogleMap(this.app)),this.gmap||(this.gmap=this.googleMap.ensure()),t&&t(this.gmap)},activate:function(){this.googleMap.activate()},deactivate:function(){this.googleMap.deactivate()},resize:function(){this.googleMap.resize();var t=this.gmap.lastCenter;google.maps.event.trigger(this.gmap,"resize"),t&&this.gmap.setCenter(t)},goTo:function(t,e){this.gmap.goTo(t,e)},addOverlay:function(t){this.gmap.addOverlay(t)},fitBounds:function(t){this.gmap.fitBounds(t)},removeOverlay:function(t){this.gmap.removeOverlay(t)},setMarkerVisibility:function(t,e){t.ws_with("google",function(t){t.setVisible(e)})},customPanTo:function(t,e,i){this.gmap.customPanTo(t,e,i)},selectAmenityMarker:function(t){var e=this.gmap;t&&t.getMarkerSel&&t.getMarkerSel().ws_with("google",function(t){e.addOverlay(t)})},deselectAmenityMarker:function(t){var e=this.gmap;t&&t.getMarkerSel&&t.getMarkerSel().ws_with("google",function(t){e.removeOverlay(t)})},openInfoWindow:function(t,e){t.removeClass&&t.removeClass("transparent").removeClass("nonub");var i=this.gmap;t.ws_with("google",function(t){e?e.getMarker().ws_with("google",function(e){t.open(i,e)}):t.open(i)})},closeInfoWindow:function(t){t.ws_with("google",function(t){t.close()})},handleNewCategory:function(){_(_(function(){delete this.mod_catchup.handleNewCategory}).bind(this)).defer()},activateContextMenu:_(function(){var t,e=$("<a />",{id:"context-menu-score-link",target:"_blank"}).html("Get Walk Score").click(function(){trackEvent(ACTIVE_COMPONENT,"map context menu get score")}),i=$("<div />",{"class":"context"}).css("visibility","hidden").css("width","100px").append(e).append("<img src='//cdn2.walk.sc/2/images/crosshairs.gif'>");$("#"+this.googleMap.div_id).append(i),google.maps.event.addListener(this.googleMap.map,"rightclick",function(e){t=e.latLng,i.css("top",e.pixel.y).css("left",e.pixel.x).css("visibility","visible");var n="/score/"+urlifyLocation("loc",t.lat(),t.lng());return i.find("a").attr("href",n),!1}),google.maps.event.addListener(this.googleMap.map,"click",function(t){i.css("visibility","hidden")})}).memoize(function(){return"only once"})},{name:"Google Map",id:"mod_polygon",prereq:"mod_google_map",enable:function(t){this.googleMap||(this.googleMap=new GoogleMap(this.app)),this.gmap||(this.gmap=this.googleMap.ensure()),this.app.parameterManager.do_with_one("polygon",_(function(e){if(!e)return t(!1);var i=this.polyMapPolygon=new google.maps.Polygon({paths:google.maps.geometry.encoding.decodePath(e),fillColor:"#ff9600",strokeColor:"#ff9600",fillOpacity:.35,strokeOpacity:.5,strokeWeight:2});return this.polyMapBounds=_(_(_(i.getPaths().getArray()).map(function(t){return t.getArray()})).flatten()).reduce(function(t,e){return t.extend(e),t},new google.maps.LatLngBounds),t(!0)}).bind(this))},activate:function(){this.polyMapPolygon.setMap(this.gmap),_(_(function(){google.maps.event.addListenerOnce(this.gmap,"bounds_changed",_(function(){this.optionFlags.zoom=this.gmap.getZoom()}).bind(this)),this.gmap.fitBounds(this.polyMapBounds)}).bind(this)).defer()},deactivate:function(){this.polyMapPolygon.setMap(null)}},{name:"Street View",id:"mod_street_view",is_default:!0,prereq:"mod_google_map",enable:function(t){return this.gmap?(this.svPano=this.gmap.getStreetView(),this.svPano.setEnableCloseButton(!1),this.svService=new google.maps.StreetViewService,void this.svService.getPanoramaByLocation(this.geoData.getLatLng().ws_coerce("google"),100,function(e,i){t(i==google.maps.StreetViewStatus.OK)})):t(!1)},activate:function(){_(this.app).spefunc(["map","closePreviouslyOpenedWindow"])(),this.svPano.setVisible(!0),_(_(function(){this.gmap.removeOverlay(this.app.houseResult.getMarker())}).bind(this)).defer()},deactivate:function(){this.svPano.setVisible(!1),_(this.app).spefunc(["map","closePreviouslyOpenedWindow"])()},goTo:function(t,e){this.gmap.customPanTo(t)},selectAmenityMarker:function(t,e){!e&&t&&t.getMarkerSel&&this.gmap.addOverlay(t.getMarkerSel())},openInfoWindow:function(t,e,i){t.isSmall&&!i&&t.addClass("transparent").addClass("nonub").ws_with("google",_(function(t){t.open(this.svPano,e?e.getMarker():null)}).bind(this))},closeInfoWindow:function(t){t.isSmall&&t.ws_with("google",function(t){t.close()})},handleNewCategory:function(){this.activateModule("mod_google_map")}},{name:"Satellite",id:"mod_satellite",is_default:!0,prereq:"mod_google_map",enable:function(t){return this.gmap?void t(!0):t(!1)},activate:function(){this.gmap.setMapTypeId(google.maps.MapTypeId.SATELLITE)},deactivate:function(){this.gmap.setMapTypeId(google.maps.MapTypeId.ROADMAP)}},{name:"Walkability Map",id:"mod_walkability",is_default:!0,prereq:"mod_google_map",enable:function(t){this.googleMap||(this.googleMap=new GoogleMap(this.app)),this.gmap||(this.gmap=this.googleMap.ensure()),t(!0),this.heatMap=new google.maps.ImageMapType({getTileUrl:CustomGetTileUrl,opacity:.45,tileSize:new google.maps.Size(256,256),isPng:!0})},activate:function(){this.gmap.overlayMapTypes.push(this.heatMap),this.showWalkabilityKey()},deactivate:function(){this.gmap.overlayMapTypes.pop(),this.hideWalkabilityKey()}},{name:"15 Minute Walk",id:"mod_walkshed",is_default:!0,prereq:"mod_google_map",enable:function(t){this.googleMap||(this.googleMap=new GoogleMap(this.app)),this.gmap||(this.gmap=this.googleMap.ensure()),have_google?this.walkShedService=(new WalkShedService).setLocation(this.geoData).withWalkShed(t):t(!1)},activate:function(){var t=_(this.walkShedService.getPoints()||[]).map(function(t){return new google.maps.LatLng(t[1],t[0])});t.length&&(this.walkShedPolygon||(this.walkShedPolygon=new google.maps.Polygon({fillColor:"#4ead42",strokeColor:"#4ead42",fillOpacity:.2,strokeOpacity:.4}),this.walkShedPolygon.setPath(t)),this.walkShedPolygon.setMap(this.gmap),_(_(function(){this.gmap.fitBounds(_(t).reduce(function(t,e){return t.extend(e)},new ws.LatLngBounds(this.geoData.getLatLng())).ws_coerce("google")),this.gmap.setZoom(this.gmap.getZoom()+1)}).bind(this)).defer(),this.showWalkShedKey())},deactivate:function(){this.walkShedPolygon&&this.walkShedPolygon.setMap(null),this.hideWalkShedKey()}},{name:"Nearby Photos",id:"mod_panoramio",prereq:"mod_google_map",enable:function(t){this.googleMap||(this.googleMap=new GoogleMap(this.app)),this.gmap||(this.gmap=this.googleMap.ensure()),have_google&&!this.panoramioLayer&&(this.panoramioLayer=new google.maps.panoramio.PanoramioLayer),t(this.panoramioLayer)},activate:function(){this.panoramioLayer.setMap(this.gmap)},deactivate:function(){this.panoramioLayer.setMap(null)}},{name:"Transit Shed",id:"mod_transit",is_default:!1,not_in_all:!0,prereq:"mod_google_map",enable:function(t){this.googleMap||(this.googleMap=new GoogleMap(this.app)),this.gmap||(this.gmap=this.googleMap.ensure()),Modernizr.load({load:"//cdn2.walk.sc/2/js/sheds_vcnyvsr4.js",complete:_(function(){var e={traversal_time:this.transitShedMaxTime,computation_timeslice:200};this.transitShed=new Sheds.transit(e).setLocation(this.app.geoData.getLatLng()).onDataReceived(t)}).bind(this)})},activate:function(){this.showTransitKey(),this.showTransitSlider()},deactivate:function(){this.hideTransitSlider(),this.hideTransitKey()}}],e=_(t).reduce(function(t,e){return t[e.id]=e,t},{}),i=!1,n=function(t){$("#map-module-selector").removeClass("active"),i=!1},s=function(t){$("#map-module-selector").addClass("active"),i=!0},o=function(t){i?n():s(),t.stopPropagation()},a=AmenityMap.prototype;a.initModuleControls=function(){var e=this.modules_enabled;this.have_initialized=!0;var i=_(t).select(function(t){return e[t.id]});$("body").click(n);var s=$("#map-module-selector");if(i.length>1){var a=$("<div />",{"class":"options"});s.empty().append($("<div />",{"class":"enticement"}).bind("selectstart mousedown",function(){return!1}).html(i[1].name+"...").click(o)).append(a),_(i).each(_(function(t){var e=$("<div />",{id:t.id}).bind("selectstart mousedown",function(){return!1}).html(t.name).click(_(this.activateModule).bind(this,t.id)).click(n);t.id==this.activeModule&&e.addClass("selected"),a.append(e)}).bind(this)),n(),$("#g-overlay").css("opacity",0).removeClass("disabled").addClass("visible").animate({opacity:1},500)}else $("#g-overlay").addClass("disabled");if(this.activate_on_initialization){var r=this.activate_on_initialization;delete this.activate_on_initialization,this.modules_enabled[r]||(r="any"),this.activateModule(r)}},a.allModules=function(){return _(t).chain().reject(function(t){return t.not_in_all}).map(function(t){return t.id}).value()},a.defaultModules=function(){return _(t).chain().select(function(t){return t.is_default}).map(function(t){return t.id}).value()};var r={};a.enableModule=function(t){this.modules_enabled||(this.modules_enabled={});var i=e[t];if(i){var n=_(_(_(function(e){this.modules_enabled[t]=e,delete r[t],_(r).keys().length||this.initModuleControls()}).bind(this)).debounce(1)).memoize(function(){return"only_once"});r[t]=_(i.enable||function(t){t(!0)}).bind(this,n),_(function(){n(!1)}).delay(5e3)}},a.finalizeModules=function(){_(_(r).keys()).each(function(t){r[t]()})},a.activateModule=function(i,n){var s=this.modules_enabled;if(!this.have_initialized&&!s[i])return this.activate_on_initialization=i;s[i]||n||(i=_(t).select(function(t){return s[t.id]})[0].id);var o=e[i];this.deactivateModule(),this.activeModule=i,$("#"+i).addClass("selected");var a=o.prereq;a&&(e[a].activate||function(){}).call(this),(o.activate||function(){}).call(this),this.mod_catchup&&_(this.mod_catchup).each(function(t){t()})},a.deactivateModule=function(){var t=this.activeModule;if(t){this.forceClosePreviouslyOpenedWindow(),$("#"+t).removeClass("selected"),(e[t].deactivate||function(){}).call(this);var i=e[t].prereq;i&&(e[i].deactivate||function(){}).call(this)}},function(){var t;a.lock=function(e){if(t)throw new Error("Already locked");t=this.activeModule,e&&e!=t&&this.activateModule(e),$("#g-overlay").css("visibility","hidden")},a.unlock=function(){t!=this.activeModule&&this.activateModule(t),t=null,$("#g-overlay").css("visibility","visible")}}(),a.mod_do=function(t,i){var n=_(function(){var s=this.activeModule,o=e[s]||{},a=Array.prototype.slice.call(arguments),r=o.api||e[o.fallback||"mod_google_map"].api||e.mod_google_map.api,u=_(a).map(function(t){return s&&(t||{}).ws_coerce&&r?t.ws_coerce(r):t});s&&(o[t]||e[o.fallback||"mod_google_map"][t]||e.mod_google_map[t]).apply(this,u),this.mod_catchup||(this.mod_catchup={});var l=a[0],c=_(["addOverlay","setMarkerVisibility"]).include(t)?[t,l.id].join("_"):t;this.mod_catchup[c]=_(n).bindsplat(this,a);var h={goTo:["fitBounds"],fitBounds:["goTo"],removeOverlay:[["addOverlay",(l||{}).id].join("_")],addOverlay:[["removeOverlay",(l||{}).id].join("_")]};_(h[t]||[]).each(_(function(t){delete this.mod_catchup[t]}).bind(this)),i&&i()}).bind(this);return n},a.mod_deselect=function(){_(["selectAmenityMarker","openInfoWindow"]).each(_(function(t){delete this.mod_catchup[t]}).bind(this))}}();var MobileAmenityMap=function(){function t(t){this.app=t,this.cache=new SimpleCache,this.DEFAULT_ZOOM=16}t.prototype=new AmenityMap;var e=t.prototype;return e.buildAmenityHTML=function(t,e){var i=this.app.resultPanels,n=i.pageId(t);return i.makeAmenityPage(t),'<a href="#'+n+'" id="info_'+n+'">'+t.getName()+"</a>"},t}();!function(){var t=SecondaryMap.prototype,e=0;t.activate=function(){this.show(),this.ensure()},t.deactivate=function(){this.hide()},t.show=function(){var t=this.app.map.elem,e=this._ensure_div();e.offset(t.offset())},t.hide=function(){$("#"+this.div_id).offset({top:-1e3,left:-1e3})},t.ensure=function(){return this._ensure_div(),this._ensure_map()},t.resize=function(){var t=this.app.map.elem,e=$("#"+this.div_id);e.width(t.width()).height(t.height()).offset(t.offset())},t._ensure_div=function(){var t=this.app.map.elem,i=$("#"+this.div_id);return t[0]&&!this._did_make_div&&(this._did_make_div=!0,this.div_id+="-"+e++,i=$("<div />",{id:this.div_id}).insertAfter(t),i.css("position","absolute").css("z-index",t.css("z-index")||0).width(t.width()).height(t.height()).offset({top:-1e3,left:-1e3})),i}}(),function(){var t=GoogleMap.prototype=new SecondaryMap;t._ensure_map=function(){if(this.map)return this.map;if(ensure_ws_v3_extensions(),!have_google)return null;var t=this.app.map,e=_(t.optionFlags.gmapOptions||{}).extend({styles:[{featureType:"poi.business",stylers:[{visibility:"off"}]}]}),i=this.map=this.app.map.gmap||new google.maps.Map($("#"+this.div_id)[0],e);i._ws_=t,google.maps.event.addListener(i,"click",_(t.closePreviouslyOpenedWindow).bind(t));var n=function(){i.lastCenter=i.getCenter()};return google.maps.event.addListener(i,"center_changed",n),google.maps.event.addListener(i,"zoom_changed",n),window.wsProfiler&&wsProfiler.event("google map instantiated"),i}}(),function(){var t=WalkShedService.prototype;t.setLocation=function(t){return i=t,this},t.noAjax=function(t){return e=!0,this},t.withWalkShed=function(t){return o(t),r(),this},t.withNothing=function(t){return t(null),this},t.setWalkShed=function(t){return l(t),this},t.getPoints=function(){return n};var e,i,n,s=[],o=function(t){s.push(t),a()},a=function(){if(n)for(;s.length;)s.shift()(n)},r=function(){e||(e=!0,$.ajax({url:"/data/get-walkshed.php",type:"GET",dataType:"json",success:_(u).bind(this),error:_(u).bind(this,null),data:{lat:i.latLng.lat(),lng:i.latLng.lng()}}))},u=function(t){var e=t||{status:-1};l(1!=e.status||e.walk_shed.is_suspicious?null:e.walk_shed)},l=function(t){t&&(n=t.geometry.coordinates[0]),a()}}();