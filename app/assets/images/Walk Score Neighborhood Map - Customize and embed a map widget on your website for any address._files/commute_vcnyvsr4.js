function CommuteApp(t,e){this.geoData=null,this.container=e,this.initApp({geoData:t}),this.workGeoData=null,this.score=null,this.workScore=null,this.init=function(){appEvents.addListener("coreGeocode",this.onGeocode,this),appEvents.addListener("scoreCompleted",this.onScoringCompleted,this),this.walkScoreCore.init(t,"tabs")},this.onGeocode=function(t){this.geoData=t,$(".paragraph-homeaddr").html(this.geoData.getShortFormattedAddress());var e=getGoToAddressFunc(t);$(".fromAddressLink").click(function(){trackEvent(ACTIVE_COMPONENT,"home address text link"),e()}),this.createHTModule(),this.createTransitAppsModule()},this.activate=function(){$(".commute-query").blur(),this.resetCommuteMapApp(),this.onScoringCompleted(this.container.walkScoreCore.score)},this.deactivate=function(){this.container.map.restoreAllCats(),this.resetCommuteMapApp()},this.resetCommuteMapApp=function(){this.commuteMapApp&&(this.commuteMapApp.deactivate(),delete this.commuteMapApp)},this.onScoringCompleted=function(t,e){this.score=t;var i=getUrlParam("to");if(this.container){var a=this.container.commute_address;delete this.container.commute_address,"t"==this.container.fixed_commute&&$(".commute-panel .address-form").html($("<h2 />").html("to "+(this.container.commute_display_address||a))),i=a||getActiveText(".commute-panel .commute-query")}else{this.sharer=new Sharer(this.geoData,t);var s=this.sharer;$("#share-container #share-button").bind("click",function(t){s.showShareOptions(t.pageX,t.pageY)}).css("display","block")}if(this.cookie=new BasicCookie("commute"),i&&"none"!=i&&this.cookie.hasDataFor(i)){var n=this.cookie.getGeoData("toAddress");this.onWorkAddressGeocoded(n)}else if(!i&&this.cookie.hasData()){var n=this.cookie.getGeoData("toAddress");this.onWorkAddressGeocoded(n)}else if(i&&"none"!=i){var n=new GeoData(i);this.walkScoreCore.getGeocoder().autoFillPartialGeoData(n,bindCallback(this,this.onWorkAddressGeocoded))}else $("#commute-content").css("display","none"),$("#commute-entry-helptext").css("display","block"),this.container&&(this.initial_query_value="travel"==industry?"Type address for directions":"Where do you commute?",setInputExampleText(".commute-panel .commute-query",this.initial_query_value))},this.onWorkAddressGeocoded=function(t){if(this.workGeoData=t,this.workGeoData.getLatLng()){var e=this;if(this.container){var i=$("<div />",{"class":"text_clear_button"}).click(_(function(){this.initial_query_value="",setActiveText(".commute-query",""),appEvents.fireEvent(null,"commuteAddressChanged",[null]),this.clearCommuteCookie(),i.remove(),this.activate()}).bind(this)),a=$(".commute-query"),s=this.initial_query_value=this.workGeoData.getQuery();a.after(i),setActiveText(".commute-query",s),a.bind("keyup change paste cut focus blur",function(){a.val()?i.removeClass("hidden"):i.addClass("hidden")}),appEvents.fireEvent(null,"commuteAddressChanged",[this.workGeoData])}else $(".commute-query").val(this.workGeoData.getQuery()).clearableTextField(),$(".commute-query").bind("focus",function(){""==this.value&&e.clearCommuteCookie()});$(".paragraph-workaddr").html(this.workGeoData.getShortFormattedAddress()),$("#commute-content").css("display","block"),$("#commute-content").css("visibility","visible"),$("#commute-entry-helptext").css("display","none"),this.updateCookie(),this.container?this.onWorkAddressScored():this.walkScoreCore.getScorer().scoreLocation(t,bindCallback(this,this.onWorkAddressScored))}else{var n=$("#commute-address-query-panel");n.find(".query").val(this.workGeoData.getQuery()),n.children(".form-error-message").html("Address not found, please try again").css("display","block"),$("#commute-entry-helptext").css("display","block")}},this.onWorkAddressScored=function(t,e){if(this.workScore=t,this.container)this.commuteMapApp&&this.resetCommuteMapApp(),this.commuteMapApp=new CommuteMapApp(null,this.container),this.commuteMapApp.activate(),this.commuteMapApp.showingDetails=this.container.resultPanels.maybeEnableChart(),this.commuteMapApp.showingDetails||$("#commute-controls").addClass("info-dense");else{var i=getGoToAddressFunc(this.workGeoData);$("#commute-to-score").css("display","inline").children("a").append("Walk Score: "+this.workScore).click(function(){trackEvent(ACTIVE_COMPONENT,"commute to address score link"),i()}),$(".toAddressLink").click(function(){trackEvent(ACTIVE_COMPONENT,"work address text link"),i()}),this.updateIframe()}},this.updateIframe=function(){var t="/commute-map.php";t+=urlifyParam("?home",this.geoData.getQuery()),t+=urlifyParam("&hll",this.geoData.getLat()+","+this.geoData.getLng()),t+=urlifyParam("&hgoog",this.geoData.getFormattedAddress()),t+=urlifyParam("&hstreet",this.geoData.getThoroughfare()),t+=urlifyParam("&hcity",this.geoData.getCity()),t+=urlifyParam("&hstate",this.geoData.getAdminArea()),t+=urlifyParam("&hpost",this.geoData.getPostalCode()),t+=urlifyParam("&hcc",this.geoData.getCountryCode()),t+=urlifyParam("&hs",this.score),t+=urlifyParam("&work",this.workGeoData.getQuery()),t+=urlifyParam("&wll",this.workGeoData.getLat()+","+this.workGeoData.getLng()),t+=urlifyParam("&wgoog",this.workGeoData.getFormattedAddress()),t+=urlifyParam("&wstreet",this.workGeoData.getThoroughfare()),t+=urlifyParam("&wcity",this.workGeoData.getCity()),t+=urlifyParam("&wstate",this.workGeoData.getAdminArea()),t+=urlifyParam("&wpost",this.workGeoData.getPostalCode()),t+=urlifyParam("&wcc",this.workGeoData.getCountryCode()),t+=urlifyParam("&ws",this.workScore),t+="&units="+this.geoData.getUnits();var e=document.getElementById("commute-module");dbug("updating iframe"),e&&e.contentWindow?e.contentWindow.location.replace(t):e&&e.contentDocument?e.contentDocument.location.replace(t):e.src=t},this.updateCookie=function(){this.cookie.addGeoData("toAddress",this.workGeoData),this.cookie.setExtraId(this.workGeoData.getQuery()),this.cookie.save()},this.createHTModule=function(){this.htModule=new HTModule,this.htModule.initializeFromServices(this.geoData)},this.createTransitAppsModule=function(){this.commuteAppsModule=new CommutingAppsModule,this.commuteAppsModule.initialize(this.geoData)},this.clearCommuteCookie=function(){this.cookie&&this.cookie.hasData()&&this.cookie.deleteCookie()}}function HTModule(){this.geoData=null,this.form=$("#h-t-form"),this.gotZestimate=!1,this.gotZmortgage=!1,this.initializeFromServices=function(t){if(this.geoData=t,"US"!=this.geoData.getCountryCode())return void $("#h-t-module").css("display","none");this.activateWhyLink(),this.checklist=new Checklist(["zestimate","zmortgage","cnt"],bindCallback(this,this.finalizeHTContent));var e=this,i="/data/zillowdata.php?address="+encodeURI(this.geoData.getThoroughfare())+"&citystatezip="+encodeURI(this.geoData.getCityStateZip());$.ajax({url:i,type:"GET",timeout:2500,success:function(t){e.onZEstimateReceived(t)},error:function(){e.onZEstimateReceived(null)}});var i="/data/get-cnt-data.php?lat="+encodeURI(this.geoData.getLat())+"&lng="+encodeURI(this.geoData.getLng());$.ajax({url:i,type:"GET",timeout:2500,success:function(t){e.onCNTDataReceived(t)},error:function(){e.onCNTDataReceived(null)}})},this.onZEstimateReceived=function(t){var e=25e4,i=parseJson(t);i&&i.z_est&&(e=i.z_est,this.gotZestimate=!0),i&&i.z_link&&(this.form.find("#ht-payment").siblings(".hide").children("a").attr("href",i.z_link),$("#h-t-info-homedetails").css("display","inline").children("a").attr("href",i.z_link).css("display","inline"));var a=this,s="/data/get-zmortgage-data.php?price="+encodeURI(unformatNumber(e))+"&zip="+encodeURI(this.geoData.getPostalCode());$.ajax({url:s,type:"GET",timeout:2500,success:function(t){a.onZMortgageDataReceived(t)},error:function(){a.onZMortgageDataReceived(null)}}),this.checklist.check("zestimate")},this.onZMortgageDataReceived=function(t){var e=1250,i=this.form.find("#ht-payment"),a=parseJson(t);this.gotZestimate&&a&&a.response&&a.response.thirtyYearFixed&&a.response.thirtyYearFixed.rate&&a.response.thirtyYearFixed.monthlyPrincipalAndInterest&&a.response.monthlyPropertyTaxes&&a.response.monthlyHazardInsurance?(e=Number(a.response.thirtyYearFixed.monthlyPrincipalAndInterest)+Number(a.response.monthlyPropertyTaxes)+Number(a.response.monthlyHazardInsurance),this.gotZmortgage=!0,$("#h-t-info-nozest").css("display","none")):i.siblings(".hide").html("(rent or mortgage)"),i.siblings(".hide").css("display","inline"),i.val(formatNumber(e)),this.checklist.check("zmortgage")},this.onCNTDataReceived=function(t){var e=45058,i=827,a=parseJson(t);if(a&&a.monthly_income&&a.regional_monthly_transportation_cost&&(e=12*a.monthly_income,i=a.monthly_transportation_cost),this.form.find("#ht-income").val(formatNumber(e)),this.form.find("#ht-transportation-costs").val(formatNumber(i)),this.checklist.check("cnt"),a&&(a.link&&$("#h-t-info-cntlink").attr("href",a.link),isSet(a.monthly_co2)&&isSet(a.regional_monthly_co2)&&isSet(a.monthly_transportation_cost)&&isSet(a.regional_monthly_transportation_cost)&&isSet(a.region))){var s=getPctDiffString(a.monthly_transportation_cost,a.regional_monthly_transportation_cost,2),n=getPctDiffString(a.monthly_co2,a.regional_monthly_co2,2);if(0!=getLeadingNumber(s)&&0!=getLeadingNumber(n)){var o=roundNumber(12*a.monthly_co2,2),r="<p>Transportation costs at this location are on average "+s+" than the "+a.region+" average. </p>";r+="<p>Greenhouse gas emissions are "+o+" metric tons per year or "+n+" than the average in this area.</p>",$("#h-t-info-tinfo").append(r).css("display","block")}}},this.finalizeHTContent=function(){this.updateValues();var t=this;this.form.find("input[type=text]");this.form.find("#ht-income").blur(function(){t.updateValues(),trackEvent(ACTIVE_COMPONENT,"h-t edit income")}),this.form.find("#ht-payment").blur(function(){t.updateValues(),trackEvent(ACTIVE_COMPONENT,"h-t edit payment")}),this.form.find("#ht-transportation-costs").blur(function(){t.updateValues(),trackEvent(ACTIVE_COMPONENT,"h-t edit transportation costs")});var t=this;this.form.submit(function(){return t.updateValues(),!1})},this.updateValues=function(){this.form.find("input[type=text]").each(function(){this.value=formatNumber(Math.max(0,unformatNumber(this.value)))});var t=unformatNumber(this.form.find("#ht-income").eq(0).val())/12,e=unformatNumber(this.form.find("#ht-payment").eq(0).val()),i=unformatNumber(this.form.find("#ht-transportation-costs").eq(0).val());if(t>0){var a=formatNumber(100*(e+i)/t)+"% of my income";$("#h-t-chart-headline").children("h2").html(a).siblings("span").css("display","inline")}else{var a="$"+formatNumber(e+i);$("#h-t-chart-headline").children("h2").html(a).siblings("span").css("display","none")}var s=t-e-i,n=t;0>s&&(s=0,n=e+i);var o=roundNumber(100*e/n),r=roundNumber(100*i/n),h=roundNumber(100*s/n);$("#h-t-chart").css("display","block");var l="http://chart.apis.google.com/chart?cht=p&chs=390x140";l+="&chd=t:"+h+","+r+","+o,l+="&chl=Income+Left:+$"+formatNumber(s)+"|",l+="Transportation:+$"+formatNumber(i)+"|",l+="Mortgage:+$"+formatNumber(e),l+="&chp=4.7",$("#h-t-pie-chart").children("img").attr("src",l)},this.activateWhyLink=function(){var t=[];t.push("<h2>Goal: 45% of income or less</h2>"),t.push("<p>Traditionally, housing is considered affordable if it costs 30% or less of your income.  The Center for Neighborhood Technology suggests <a href=\"http://htaindex.org/\" target=\"_blank\" onclick=\"trackEvent('commute', 'why popup link clickthrough', 'H+T index');\">spending less than 45% of your income</a> on housing plus transportation.</p>"),t=t.join(""),$("#h-t-why").bind("click",function(e){showDialog(t,"wide-dialog",!0,e.pageX-265,e.pageY,{blockModal:!0}),trackEvent(ACTIVE_COMPONENT,"h-t why link")})}}function CommutingAppsModule(){this.initialize=function(t){t.getCity()&&$("#commuting-apps").find(".for-city").html("for "+t.getCity());var e=getCityGoRoundNearbyAppsUrl(t);$("#more-apps-link").children().attr("href",e);var i=getProxiedCityGoRoundApplicationSearchApiUrl(t),a=this;$.getJSON(i,function(t,e){a.onAppsDataReceived(t,e)})},this.onAppsDataReceived=function(t,e){$("#commuting-apps").find(".progress").hide();var i=[],a=this.getTopAppsForCategory(t,"Public Transit",4);if(a.length>=4)i=this.selectAtMostTwoApps(a);else{var s=this.getTopAppsFromEachCategory(t,4);i=this.selectAtMostTwoApps(s)}var n=this.htmlForMultipleTransitApps(i);$("#commuting-apps .app-gallery").html(n)},this.htmlForTransitApp=function(t,e){var i=e%2==0?"even":"odd",a=t.is_featured?'<img class="featured" src="http://www.citygoround.org/images/editors-choice3.gif" alt="Editors Choice" />':"",s='<div class="app '+i+'">';return s+='<a target="_blank" href="http://www.citygoround.org'+t.details_url+"\" onclick=\"trackEvent('commute', 'app thumbnail clickthrough', '"+t.title+"');\">",s+='<img src="http://www.citygoround.org'+t.default_80sq_screen_shot_url+'" class="app-thumb" alt="Application Screen Shot" />',s+="</a>",s+='<div class="app-details-container">',s+='<h5><a href="http://www.citygoround.org'+t.details_url+"\" onclick=\"trackEvent('commute', 'app title clickthrough', '"+t.title+"');\">"+t.title+"</a></h5>",s+="<label>By "+t.author_name+"</label>",s+='<div class="rating"><div style="width:'+79*t.rating/5+'px;"></div><p>('+t.rating_count+" ratings)</p>"+a+"</div>",s+="</div>",s+='<p class="app-description">'+t.description+"</p>",s+="</div>"},this.htmlForMultipleTransitApps=function(t){if(0==t.length)return"<p>No apps found.</p>";var e="",i=this;return $(t).each(function(t,a){e+=i.htmlForTransitApp(a,t),t%2==1&&(e+='<br class="clear-all" />')}),e},this.selectAtMostTwoApps=function(t){var e=[];if(1==t.length)e.push(t[0]);else if(2==t.length)e.push(t[0]),e.push(t[1]);else if(t.length>2){for(var i=rand(t.length)-1,a=rand(t.length)-1;a==i;)a=rand(t.length)-1;e.push(t[i]),e.push(t[a])}return e},this.appHasTag=function(t,e){for(var i=0;i<t.tags.length;i++)if(t.tags[i]==e)return!0;return!1},this.getTopAppsForCategory=function(t,e,i){var a=this,s=[];return $.each(t,function(t,i){a.appHasTag(i,e)&&s.push(i)}),s.slice(0,i)},this.getTopAppsFromEachCategory=function(t,e){var i=[],a=[],s=[],n=[],o=this;return $.each(t,function(t,e){o.appHasTag(e,"Public Transit")?i.push(e):o.appHasTag(e,"Biking")?a.push(e):o.appHasTag(e,"Walking")?s.push(e):o.appHasTag(e,"Driving")&&n.push(e)}),i=i.slice(0,e),a=a.slice(0,e),s=s.slice(0,e),n=n.slice(0,e),i.concat(a).concat(s).concat(n)}}WalkScoreApp=function(){function t(t){}var e={coreGeocode:"onGeocode",coreGeocodeFailed:"onFailedGeocode",dataRequestsComplete:"onDataRequestsComplete",scoreCompleted:"onScoringCompleted",scoreQueriesAvailable:"onScoreQueriesReceived",customQueriesAvailable:"onCustomQueriesReceived",overviewQueriesAvailable:"onOverviewQueriesReceived",travelQueriesAvailable:"onTravelQueriesReceived",commercialQueriesAvailable:"onCommercialQueriesReceived"},i={};return WAp=t.prototype,WAp.initApp=function(t){for(var a in t)t.hasOwnProperty(a)&&(this[a]=t[a]);for(var a in i)if(!this.hasOwnProperty(a))return void alert("Missing "+a+" in app init");var s="walkscore";$.browser.msie&&$.browser.version<8&&(s="walkscore_ie7"),this.profile=t.profile?t.profile:s,this.dataFetcher?this.dataFetcher.setProfile(this.profile):this.dataFetcher=new DataFetcher(this.profile),this.dataSourceManager=new DataSourceManager(this);var n=new AmenityService(this);this.localAmenityService=new LocalAmenityService,this.noAmenityLocalStorage&&(n.noAmenityLocalStorage=!0);var o=new Geocoder;this.walkScoreCore=new WalkScoreCore(this.profile,this.dataFetcher,n,o,this.optionFlags),this.walkScoreCore.app=this,this.geoData=null,this.cache=new SimpleCache;for(var r in e)appEvents.addListener(r,this[e[r]],this);this.appQueryList&&this.walkScoreCore.request(this.appQueryList,this.geoData)},WAp.updateAmenitySet=function(t,e,i){if(DEBUG_CURATION&&dbug("APP: update amenity set "+t),"Transit"!=t&&this.queryList){var a=this.queryList.getQueryByName(t);a&&!a.isChild()&&this.updateAmenitySetInternal(a,t,e,i)}},WAp.updateAmenitySetInternal=function(t,e,i,a){this.resultPanels&&this.resultPanels.addAmenityContent(e,i,a),this.map&&this.map.updateAmenityMarkers(e,i)},WAp.initAmenityManager=function(t){this.amenityManager=new AmenityManager(this,this.geoData),this.amenityManager.setResultSetCap(t),this.walkScoreCore.amenityManager=this.amenityManager},WAp.onOverviewQueriesReceived=function(t){this.onDisplayQueriesReceived(t,"overviewQueries")},WAp.onCustomQueriesReceived=function(t){this.onDisplayQueriesReceived(t,"customQueries")},WAp.onTravelQueriesReceived=function(t){this.onDisplayQueriesReceived(t,"travelQueries")},WAp.onCommercialQueriesReceived=function(t){this.onDisplayQueriesReceived(t,"commercialQueries")},WAp.onDisplayQueriesReceived=function(t,e){this.displayInitiated||(this.displayInitiated=!0,e&&e==this.appQueryList&&(t||dbug("no json for display queries"),this.queryList=new QueryList(t,e),this.initializePanelManager(),this.localAmenityService.setQueryList(this.queryList).setLocation(this.geoData),this.onResultPanelsInitialized&&this.onResultPanelsInitialized(),this.lazyQueryExecution||this.walkScoreCore.getAmenityService().runQueryList(this.queryList,_(this.onDisplayQueryCompleted).bind(this),_(this.onAllDisplayQueriesCompleted).bind(this))))},WAp.initializePanelManager=function(){this.resultPanelID&&(this.resultPanels=new PanelManager(this,$("#"+this.resultPanelID).eq(0),this.geoData,this.listLimit),this.resultPanels.initializePanelsFromQueryList(this.queryList))},WAp.request=function(t,e){this.walkScoreCore.request(t,e)},WAp.getMap=function(){return this.map},WAp.addNewResult=function(t,e){this.showRescoreAlert&&this.showRescoreAlert();var i=this.amenityManager.addNewResult(t,e,!0);return i&&this.selectAmenity(i),i},WAp.updateResult=function(t,e,i){this.showRescoreAlert&&this.showRescoreAlert(),this.amenityManager.deleteResult(i.getCategory(),i.getKey(),!1);var a=this.amenityManager.addNewResult(t,e,!0);return a&&this.selectAmenity(a),a},WAp.showAmenityMarkers=function(t,e){this.map.showAmenityMarkers(t,e)},WAp.selectAmenityByCategory=function(t,e){var i=this.amenityManager.getResult(t,e);this.selectAmenity(i)},WAp.selectAmenity=function(t,e){this.map.showAmenityInfo(t,e)},WAp.showRemoveAmenityDialog=function(t,e,i){var a=function(t){var e=_(t||{}).spelunk(["place","place_page_path"]);return e?(window.open(e+"?utm_medium=bubble_flag","_blank"),!0):void 0};trackEvent(ACTIVE_COMPONENT,"remove result clickthrough",t.getCategory()),a({place:t})||$.ajax({url:"/auth/places/v1/add-place",data:{place:JSON.stringify(unpackPlaceData(t))},dataType:"json",type:"GET",cache:!1,success:a,error:a})},WAp.showRestoreAmenityDialog=function(t,e,i){this.dataCurator.initRestorePlace(t,e,i)},WAp.showAddPlaceDialog=function(t,e,i){this.dataCurator.initAddPlace(this.queryList,t,this.walkScoreCore.getGeocoder(),e,i)},WAp.showEditAmenityDialog=function(t,e,i){this.dataCurator.initEditPlace(t,this.queryList,this.walkScoreCore.getGeocoder(),e,i)},WAp.removeAmenities=function(t){this.showRescoreAlert&&this.showRescoreAlert(),this.amenityManager.processRemovals(t,!0)},WAp.restoreAmenity=function(t){this.showRescoreAlert&&this.showRescoreAlert(),this.amenityManager.restoreAmenity(t),this.selectAmenity(t)},WAp.deleteAmenity=function(t,e){this.showRescoreAlert&&this.showRescoreAlert(),this.amenityManager.deleteResult(t,e,!0)},WAp.toggleAllTransit=function(t){this.allTransitShown?(this.map.removeAmenityMarkers("Transit",this.amenityManager.getAllTransitResults()),this.map.showAmenityMarkers("Transit",this.amenityManager.getFeaturedTransitResults()),$(t).html("Show more stops"),trackEvent(ACTIVE_COMPONENT,"hide some transit stops")):(this.map.removeAmenityMarkers("Transit",this.amenityManager.getFeaturedTransitResults()),this.map.showAmenityMarkers("Transit",this.amenityManager.getAllTransitResults()),$(t).html("Show fewer stops"),trackEvent(ACTIVE_COMPONENT,"show all transit stops")),this.allTransitShown=!this.allTransitShown},WAp.checkForHighlightedResult=function(t){if(!this.foundHighlight){try{var e=decodeURIComponent(getUrlParam("show"))}catch(i){return}if(thisObj=this,!isEmptyString(e)){var a=forEach(t,function(t,i){return t&&t.getKey()==e?t:void 0});a&&!a.isRemoved()&&(this.foundHighlight=!0,_(function(){thisObj.selectAmenity(a)}).delay(2e3),this.map.GMap().customPanTo(a.getPoint(),-90,60))}}},WAp.withUser=function(t){this.openIdConnector?this.openIdConnector.withInfo(t):t(null)},t}(),PanelManagerBase=function(){function t(){}var e={app:!0,container:!0,geoData:!0,titleMaxLength:!0,noneFoundHtml:!0};return PMp=t.prototype,PMp.initPM=function(t){for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);for(var i in e)if(!this.hasOwnProperty(i))return void alert("Missing "+i+" in app init");this.panels=[],this.allPanelsExpanded=!1},PMp.numPanels=function(){return this.panels.length},PMp.getPanelByIndex=function(t){return this.panels[t]},PMp.getPanel=function(t){for(var e in this.panels)if(this.panels[e].getCategory()==t)return this.panels[e];return null},PMp.getPanelIndex=function(t){for(var e in this.panels)if(this.panels[e].getCategory()==t)return e;return-1},PMp.addAmenityContent=function(t,e,i){var a=this.getPanel(t);a&&a.addContent(t,e,i)},PMp.onEntryClick=function(t){trackEvent(ACTIVE_COMPONENT,"result list click",t.getCategory()),this.app.selectAmenity(t,!0)},PMp.onEntryClickByIndex=function(t,e){trackEvent(ACTIVE_COMPONENT,"result list click",t),this.app.selectAmenityByCategory(t,e)},PMp.onRemovedEntryClick=function(t,e,i){trackEvent("overview","removed amenity info click",t.getCategory()),this.app.showRestoreAmenityDialog(t,e,i)},PMp.formatDistanceForDisplay=function(t){return convertMetersForDisplay(t,this.geoData.getUnits(),!0,2,!1)},PMp.showAddPlace=function(t,e,i){this.app.showAddPlaceDialog(t,e,i)},PMp.initializePanelsFromQueryList=function(t){var e=_(t.list).filter(function(t){return!t.isChild()}),i=e.length;this.listLimit&&(this.hasOtherSet=e.length>this.listLimit,i=Math.min(e.length,this.listLimit));for(var a=0;i>a;a++)this.addContainer(e[a].getName())},t}(),AmenityPanelBase=function(t,e,i,a){function s(){}var n={panelManager:!0,category:!0,expanded:!0,geoData:!0};return APBp=s.prototype,APBp.initAmenityPanelBase=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);for(var e in n)if(!this.hasOwnProperty(e))return void alert("Missing "+e+" in app init");this.amenities=[],this.slug=sluggify(safeString(this.category)),this.panelId="pg-"+this.slug,this.headerId="ph-"+this.slug,this.contentId="pc-"+this.slug,this.extensionId="px-"+this.slug,this.getEntryId=function(t){return"pe-"+this.slug+t}},APBp.getCategory=function(){return this.category},APBp.isInDOM=function(){return $("#pg-"+this.slug).length>0},APBp.initializeInDOM=function(t,e){var i=[],a=this.expanded?"open":"";i.push('<div class="panel-group" id="'+this.panelId+'">'),i.push('<div class="group-label '+a+'" id="'+this.headerId+'"><h4>'+this.category+"</h4></div>"),i.push('<div id="'+this.contentId+'" class="result first-result"><img class="progress" src="//cdn2.walk.sc/2/images/progress.gif"/></div>'),i.push("</div>"),this.addToDOM(i.join(""),t,e)},APBp.addToDOM=function(t,e,i){i&&"before"==i?e.before(t):i&&"after"==i?e.after(t):e.append(t),this.bindClickEvents()},APBp.removeSelfFromDOM=function(){$("#"+this.panelId).remove()},APBp.repositionInDom=function(t,e){var i=$("#"+this.panelId);i.remove(),this.addToDOM(i,t,e)},APBp.addContent=function(t,e,i){this.expanded=i?!0:this.expanded,this.amenities=e;var a=this.expanded?"block":"none";if(e.length>0){var s=[];s.push('<div id="'+this.contentId+'">'),s.push(this.getEntryHTML(0,e[0],"first-result")),s.push('<div id="'+this.extensionId+'" style="display:'+a+';">');for(var n=1;n<e.length;n++)s.push(this.getEntryHTML(n,e[n]));s.push('<div class="result noclick"><p class="add-place-link"><a class="dull-link">Add place</a></p></div>'),s.push("</div></div>"),$("#"+this.contentId).replaceWith(s.join(""));var o=this.category,r=replaceAll(this.category," ","_"),h=this.panelManager;$("#"+this.extensionId).find(".see-more-link").children("a").bind("click",function(){trackEvent(ACTIVE_COMPONENT,"see more amenities",o),goToTab("nearby",{active:r})}),$("#"+this.extensionId).find(".add-place-link").children("a").bind("click",function(t){h.showAddPlace(o,t.pageX,t.pageY)}),this.bindClickEvents()}else $("#"+this.contentId).replaceWith(this.panelManager.noneFoundHtml)},APBp.getEntryHTML=function(t,e,i){var a=e.getName().substr(0,this.panelManager.titleMaxLength),s="";return e.isRemoved()?(s+='<div class="result noclick removed-result '+safeString(i)+'" id="'+this.getEntryId(t)+'">',s+='<h6><a class="removed-info"></a></h6>',s+="<h5>"+a+"</h5>",s+="</div>"):(s+='<div class="result '+safeString(i)+'" id="'+this.getEntryId(t)+'">',s+="<h6>"+this.panelManager.formatDistanceForDisplay(e.getDist())+"</h6>",s+="<h5>"+a+"</h5>",s+="</div>"),s},APBp.bindClickEvents=function(){var t=this;$("#"+this.headerId).unbind().bind("click",function(){t.toggleExpandCollapse()});for(var e=0;e<this.amenities.length;e++)this.bindEntryClick(e)},APBp.bindEntryClick=function(t){var e=this.panelManager,i=this.amenities[t];i&&(this.amenities[t].isRemoved()?$("#"+this.getEntryId(t)).find(".removed-info").click(function(t){e.onRemovedEntryClick(i,t.pageX,t.pageY)}):$("#"+this.getEntryId(t)).bind("click",function(){e.onEntryClick(i)}))},APBp.toggleExpandCollapse=function(t){var e=$("#"+this.extensionId);return e.length>0&&(t?(e.css("display",t),"block"==t?$("#"+this.headerId).addClass("open"):$("#"+this.headerId).removeClass("open"),this.expanded="block"==t):this.expanded?(e.css("display","none"),$("#"+this.headerId).removeClass("open"),this.expanded=!1,trackEvent(ACTIVE_COMPONENT,"collapse-category",this.category)):(e.css("display","block"),$("#"+this.headerId).addClass("open"),this.expanded=!0,trackEvent(ACTIVE_COMPONENT,"expand-category",this.category))),this.expanded},s}(),CommuteApp.prototype=new WalkScoreApp,function(t){function e(){i(t(this),!0)}function i(t,e){t.val().length>0?a(t,e):s(t,e)}function a(t,e){if("1"!=t.attr("has_clearable_button")){t.attr("has_clearable_button","1");var a=t.parent();a.hasClass("clear_button_wrapper")||(a=t.wrap('<div class="clear_button_wrapper" style="margin:0;padding:0;position:relative; display:inline;" />')),t.after("<div class='text_clear_button'></div>");var s=t.next(),n=s.outerHeight(),o=s.outerHeight();t.css("padding-right",parseInt(t.data("original-padding-right"))+n+1),t.width(t.width()-n-1);var r=t.position(),h={};h.left=r.left+t.outerWidth(!1)-(n+2);var l=Math.round((t.outerHeight(!0)-o)/2);h.top=r.top+l,s.css(h),s.click(function(){t.val(""),i(t),t.change()}),e&&void 0!=e&&t.focus()}}function s(t,e){var i=t.next();if("1"==t.attr("has_clearable_button")){t.removeAttr("has_clearable_button"),i.remove();i.width();t.css("padding-right",parseInt(t.data("original-padding-right"))),t.width(t.data("original-width"))}e&&void 0!=e&&t.focus()}t.fn.clearableTextField=function(){t(this).length>0&&(t(this).bind("keyup change paste cut",e),t(this).each(function(){t(this).data("original-padding-right",t(this).css("padding-right")),t(this).data("original-width",t(this).width()),i(t(this))}))}}(jQuery);