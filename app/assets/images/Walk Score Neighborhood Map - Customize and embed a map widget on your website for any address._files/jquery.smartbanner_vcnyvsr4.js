!function(s){var t=function(t){this.origHtmlMargin=parseFloat(s("html").css("margin-top")),this.options=s.extend({},s.smartbanner.defaults,t);var e=navigator.standalone;this.options.force?this.type=this.options.force:null!=navigator.userAgent.match(/iPhone|iPod/i)?(this.type="ios",this.options.title="Walk Score for iPhone"):null!=navigator.userAgent.match(/Android/i)&&(this.type="android",this.options.title="Walk Score for Android"),this.scale="auto"==this.options.scale?s(window).width()/window.screen.width:this.options.scale,this.scale<1&&(this.scale=1);var i=s("android"==this.type?'meta[name="google-play-app"]':'meta[name="ws-apple-itunes-app"]');0!=i.length&&(this.appId=/app-id=([^\s,]+)/.exec(i.attr("content"))[1],this.title=this.options.title?this.options.title:s("title").text().replace(/\s*[|\-Â·].*$/,""),this.author=this.options.author?this.options.author:s('meta[name="author"]').length?s('meta[name="author"]').attr("content"):window.location.hostname,this.isFullscreen=!0,this.topClass=this.isFullscreen?"ws-smartbanner-b":"smartbanner","undefined"!=typeof localStorage&&this.type&&!e&&this.shouldShowBanner()&&("undefined"!=typeof noBanner&&noBanner||this.render()))};t.prototype={constructor:t,createTopBanner:function(){var t,e=this.options.url?this.options.url:("android"==this.type?"market://details?id=":"https://itunes.apple.com/"+this.options.appStoreLanguage+"/app/id")+this.appId,i=this.options.price?this.options.price+" - "+("android"==this.type?this.options.inGooglePlay:this.options.inAppStore):"",n=null===this.options.iconGloss?"ios"==this.type:this.options.iconGloss;s("body").append('<div id="smartbanner" class="'+this.type+'"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+"</strong><span>"+this.author+"</span><span>"+i+'</span></div><a href="'+e+'" class="sb-button open"><span>'+this.options.button+"</span></a></div></div>"),this.options.icon?t=this.options.icon:s('link[rel="apple-touch-icon-precomposed"]').length>0?(t=s('link[rel="apple-touch-icon-precomposed"]').attr("href"),null===this.options.iconGloss&&(n=!1)):s('link[rel="apple-touch-icon"]').length>0&&(t=s('link[rel="apple-touch-icon"]').attr("href")),t?(s("#smartbanner .sb-icon").css("background-image","url("+t+")"),n&&s("#smartbanner .sb-icon").addClass("gloss")):s("#smartbanner").addClass("no-icon"),this.bannerHeight=s("#smartbanner").outerHeight()+2,this.scale>1&&(s("#smartbanner").css("top",parseFloat(s("#smartbanner").css("top"))*this.scale).css("height",parseFloat(s("#smartbanner").css("height"))*this.scale),s("#smartbanner .sb-container").css("-webkit-transform","scale("+this.scale+")").css("-msie-transform","scale("+this.scale+")").css("-moz-transform","scale("+this.scale+")").css("width",s(window).width()/this.scale))},createFullScreenBanner:function(){var t=function(s){var t="android"==s?"app-screens-android.png":"app-screens-iphone2.png";return"//cdn2.walk.sc/2/images/mobile/"+t}(this.type);switch(this.options.fullscreenVariation){case 0:var e=this.options.url?this.options.url:"android"==this.type?"http://taps.io/LaXg":"http://taps.io/LajQ";s("body").append('<div id="'+this.topClass+'" class="'+this.type+'"><div class="sb-container ws"><a href="#" class="sb-close ws close">&times;</a><div class="sb-header"><h1><span id="header-a">Our app is really fast</span><span id="header-b">Fast &amp; Free</span>.</h1></div><div class="sb-image"><img src="'+t+'" /></div><div id="sb-bottom"><a href="'+e+'" class="sb-button open o-btn tall"><span>Download Free App</span></a><a href ="#" class="sb-close dull-link"><span>No thanks</span></a></div></div></div></div>');break;case 1:var e="http://taps.io/LmBQ";s("body").append('<div id="'+this.topClass+'" class="'+this.type+' map-enticement"><div class="sb-container ws"><a href="#" class="sb-close ws close">&times;</a><div class="sb-header"><h1>For map view...</h1><h3>Download the free Walk Score app.</h3></div><div class="sb-image"><img src="'+t+'" /></div><div id="sb-bottom"><a href="'+e+'" class="sb-button open o-btn tall"><span>Download Free App</span></a></div></div></div></div>')}this.initialBodyPosition=s("body").css("position"),this.scrollPosition=s("body").scrollTop(),s("body").css("position","fixed")},render:function(){this.isFullscreen?this.createFullScreenBanner():this.createTopBanner(),this.show(),this.listen()},renderMapEnticement:function(){this.options.fullscreenVariation=1,this.render()},listen:function(){s("#"+this.topClass+" .sb-close").on("click",s.proxy(this.close,this)),s("#"+this.topClass+" .sb-button.open").on("click",s.proxy(this.install,this))},show:function(t){this.isFullscreen||(s("#"+this.topClass).stop().animate({top:0},this.options.speedIn).addClass("shown"),s("html").animate({marginTop:this.origHtmlMargin+this.bannerHeight*this.scale},this.options.speedIn,"swing",t)),trackEvent(ACTIVE_COMPONENT,this.type+" banner shown")},hide:function(t){this.isFullscreen?(s("#"+this.topClass).remove(),s("body").css("position",this.initialBodyPosition),s("body").scrollTop(this.scrollPosition)):(s("#"+this.topClass).stop().animate({top:-1*this.bannerHeight*this.scale},this.options.speedOut).removeClass("shown"),s("html").animate({marginTop:this.origHtmlMargin},this.options.speedOut,"swing",t))},close:function(s){s.preventDefault(),this.hide(),this.setTimeValueToNow("sb-closed"),trackEvent(ACTIVE_COMPONENT,this.type+" banner dismissed","Download app")},install:function(s){this.hide(),this.setTimeValueToNow("sb-installed"),trackEvent(ACTIVE_COMPONENT,this.type+" banner clicked","Download app")},setTimeValueToNow:function(s){var t=new Date;localStorage.setItem(s,JSON.stringify({timeSet:t.getTime()}))},valueIsExpired:function(s,t){var e=localStorage.getItem(s);if(null==e)return!0;e=JSON.parse(e);var i=new Date,n=new Date(e.timeSet+864e5*t);return n.getTime()<=i.getTime()},isRecentlyNewUser:function(){var s="sb-skip-count",t=(localStorage.getItem(s)||0)-0;return t<this.options.skipNFirstLoads?(localStorage.setItem(s,t+1),!0):!1},wasRecentlyClosed:function(){return!this.valueIsExpired("sb-closed",this.options.daysHidden)},wasRecentlyInstalled:function(){return!this.valueIsExpired("sb-installed",this.options.daysReminder)},shouldShowBanner:function(){return!this.isRecentlyNewUser()&&!this.wasRecentlyClosed()&&!this.wasRecentlyInstalled()},switchType:function(){var t=this;this.hide(function(){t.type="android"==t.type?"ios":"android";var e=s("android"==t.type?'meta[name="google-play-app"]':'meta[name="ws-apple-itunes-app"]').attr("content");t.appId=/app-id=([^\s,]+)/.exec(e)[1],s("#"+this.topClass).detach(),t.create(),t.show()})}},s.smartbanner=function(e){var i=s(window),n=i.data("smartbanner"),a="object"==typeof e&&e;n||i.data("smartbanner",n=new t(a)),"string"==typeof e&&n[e]()},s.smartbanner.defaults={title:"Walk Score app",author:"walkscore.com",price:"FREE",appStoreLanguage:"us",inAppStore:"On the App Store",inGooglePlay:"In Google Play",icon:"//cdn2.walk.sc/2/images/app-icon-120.png",iconGloss:!1,button:"VIEW",url:null,scale:"auto",speedIn:300,speedOut:400,daysHidden:1,daysReminder:90,skipNFirstLoads:2,force:null,fullscreenVariation:0},s.smartbanner.Constructor=t}(window.jQuery);