ensureWSUnderscoreMixins(),function(){function e(e,t){this.app=e,this.oidConnector=t,this.activeAmenity=null}var t={};!function(e){"use strict";function t(t){var a=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(a))}function a(t){var a=t.target,i=e(a);if(!i.is("[type=submit],[type=image]")){var n=i.closest("[type=submit]");if(0===n.length)return;a=n[0]}var o=this;if(o.clk=a,"image"==a.type)if(void 0!==t.offsetX)o.clk_x=t.offsetX,o.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var s=i.offset();o.clk_x=t.pageX-s.left,o.clk_y=t.pageY-s.top}else o.clk_x=t.pageX-a.offsetLeft,o.clk_y=t.pageY-a.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function i(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var n={};n.fileapi=void 0!==e("<input type='file'/>").get(0).files,n.formdata=void 0!==window.FormData;var o=!!e.fn.prop;e.fn.attr2=function(){if(!o)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function a(t){var a,i,n=e.param(t).split("&"),o=n.length,s=[];for(a=0;o>a;a++)n[a]=n[a].replace(/\+/g," "),i=n[a].split("="),s.push([decodeURIComponent(i[0]),decodeURIComponent(i[1])]);return s}function s(i){for(var n=new FormData,o=0;o<i.length;o++)n.append(i[o].name,i[o].value);if(t.extraData){var s=a(t.extraData);for(o=0;o<s.length;o++)s[o]&&n.append(s[o][0],s[o][1])}t.data=null;var r=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:l||"POST"});t.uploadProgress&&(r.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){var a=0,i=e.loaded||e.position,n=e.total;e.lengthComputable&&(a=Math.ceil(i/n*100)),t.uploadProgress(e,i,n,a)},!1),e}),r.data=null;var c=r.beforeSend;return r.beforeSend=function(e,t){t.data=n,c&&c.call(this,e,t)},e.ajax(r)}function r(a){function n(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(a){i("cannot get iframe.contentWindow document: "+a)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(a){i("cannot get iframe.contentDocument: "+a),t=e.document}return t}function s(){function t(){try{var e=n(v).readyState;i("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(a){i("Server abort: ",a," (",a.name,")"),r(P),k&&clearTimeout(k),k=void 0}}var a=u.attr2("target"),o=u.attr2("action");C.setAttribute("target",m),l||C.setAttribute("method","POST"),o!=p.url&&C.setAttribute("action",p.url),p.skipEncodingOverride||l&&!/post/i.test(l)||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),p.timeout&&(k=setTimeout(function(){w=!0,r(D)},p.timeout));var s=[];try{if(p.extraData)for(var c in p.extraData)p.extraData.hasOwnProperty(c)&&(e.isPlainObject(p.extraData[c])&&p.extraData[c].hasOwnProperty("name")&&p.extraData[c].hasOwnProperty("value")?s.push(e('<input type="hidden" name="'+p.extraData[c].name+'">').val(p.extraData[c].value).appendTo(C)[0]):s.push(e('<input type="hidden" name="'+c+'">').val(p.extraData[c]).appendTo(C)[0]));p.iframeTarget||(g.appendTo("body"),v.attachEvent?v.attachEvent("onload",r):v.addEventListener("load",r,!1)),setTimeout(t,15);try{C.submit()}catch(d){var h=document.createElement("form").submit;h.apply(C)}}finally{C.setAttribute("action",o),a?C.setAttribute("target",a):u.removeAttr("target"),e(s).remove()}}function r(t){if(!_.aborted&&!E){if(T=n(v),T||(i("cannot access response document"),t=P),t===D&&_)return _.abort("timeout"),void x.reject(_,"timeout");if(t==P&&_)return _.abort("server abort"),void x.reject(_,"error","server abort");if(T&&T.location.href!=p.iframeSrc||w){v.detachEvent?v.detachEvent("onload",r):v.removeEventListener("load",r,!1);var a,o="success";try{if(w)throw"timeout";var s="xml"==p.dataType||T.XMLDocument||e.isXMLDoc(T);if(i("isXml="+s),!s&&window.opera&&(null===T.body||!T.body.innerHTML)&&--M)return i("requeing onLoad callback, DOM not available"),void setTimeout(r,250);var l=T.body?T.body:T.documentElement;_.responseText=l?l.innerHTML:null,_.responseXML=T.XMLDocument?T.XMLDocument:T,s&&(p.dataType="xml"),_.getResponseHeader=function(e){var t={"content-type":p.dataType};return t[e]},l&&(_.status=Number(l.getAttribute("status"))||_.status,_.statusText=l.getAttribute("statusText")||_.statusText);var c=(p.dataType||"").toLowerCase(),d=/(json|script|text)/.test(c);if(d||p.textarea){var u=T.getElementsByTagName("textarea")[0];if(u)_.responseText=u.value,_.status=Number(u.getAttribute("status"))||_.status,_.statusText=u.getAttribute("statusText")||_.statusText;else if(d){var m=T.getElementsByTagName("pre")[0],f=T.getElementsByTagName("body")[0];m?_.responseText=m.textContent?m.textContent:m.innerText:f&&(_.responseText=f.textContent?f.textContent:f.innerText)}}else"xml"==c&&!_.responseXML&&_.responseText&&(_.responseXML=O(_.responseText));try{L=I(_,c,p)}catch(b){o="parsererror",_.error=a=b||o}}catch(b){i("error caught: ",b),o="error",_.error=a=b||o}_.aborted&&(i("upload aborted"),o=null),_.status&&(o=_.status>=200&&_.status<300||304===_.status?"success":"error"),"success"===o?(p.success&&p.success.call(p.context,L,"success",_),x.resolve(_.responseText,"success",_),h&&e.event.trigger("ajaxSuccess",[_,p])):o&&(void 0===a&&(a=_.statusText),p.error&&p.error.call(p.context,_,o,a),x.reject(_,"error",a),h&&e.event.trigger("ajaxError",[_,p,a])),h&&e.event.trigger("ajaxComplete",[_,p]),h&&!--e.active&&e.event.trigger("ajaxStop"),p.complete&&p.complete.call(p.context,_,o),E=!0,p.timeout&&clearTimeout(k),setTimeout(function(){p.iframeTarget||g.remove(),_.responseXML=null},100)}}}var c,d,p,h,m,g,v,_,b,y,w,k,C=u[0],x=e.Deferred();if(a)for(d=0;d<f.length;d++)c=e(f[d]),o?c.prop("disabled",!1):c.removeAttr("disabled");if(p=e.extend(!0,{},e.ajaxSettings,t),p.context=p.context||p,m="jqFormIO"+(new Date).getTime(),p.iframeTarget?(g=e(p.iframeTarget),y=g.attr2("name"),y?m=y:g.attr2("name",m)):(g=e('<iframe name="'+m+'" src="'+p.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),v=g[0],_={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var a="timeout"===t?"timeout":"aborted";i("aborting upload... "+a),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(n){}g.attr("src",p.iframeSrc),_.error=a,p.error&&p.error.call(p.context,_,a,t),h&&e.event.trigger("ajaxError",[_,p,a]),p.complete&&p.complete.call(p.context,_,a)}},h=p.global,h&&0===e.active++&&e.event.trigger("ajaxStart"),h&&e.event.trigger("ajaxSend",[_,p]),p.beforeSend&&p.beforeSend.call(p.context,_,p)===!1)return p.global&&e.active--,x.reject(),x;if(_.aborted)return x.reject(),x;b=C.clk,b&&(y=b.name,y&&!b.disabled&&(p.extraData=p.extraData||{},p.extraData[y]=b.value,"image"==b.type&&(p.extraData[y+".x"]=C.clk_x,p.extraData[y+".y"]=C.clk_y)));var D=1,P=2,S=e("meta[name=csrf-token]").attr("content"),A=e("meta[name=csrf-param]").attr("content");A&&S&&(p.extraData=p.extraData||{},p.extraData[A]=S),p.forceSync?s():setTimeout(s,10);var L,T,E,M=50,O=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},$=e.parseJSON||function(e){return window.eval("("+e+")")},I=function(t,a,i){var n=t.getResponseHeader("content-type")||"",o="xml"===a||!a&&n.indexOf("xml")>=0,s=o?t.responseXML:t.responseText;return o&&"parsererror"===s.documentElement.nodeName&&e.error&&e.error("parsererror"),i&&i.dataFilter&&(s=i.dataFilter(s,a)),"string"==typeof s&&("json"===a||!a&&n.indexOf("json")>=0?s=$(s):("script"===a||!a&&n.indexOf("javascript")>=0)&&e.globalEval(s)),s};return x}if(!this.length)return i("ajaxSubmit: skipping submit process - no element selected"),this;var l,c,d,u=this;"function"==typeof t&&(t={success:t}),l=this.attr2("method"),c=this.attr2("action"),d="string"==typeof c?e.trim(c):"",d=d||window.location.href||"",d&&(d=(d.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:d,success:e.ajaxSettings.success,type:l||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var p={};if(this.trigger("form-pre-serialize",[this,t,p]),p.veto)return i("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return i("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var h=t.traditional;void 0===h&&(h=e.ajaxSettings.traditional);var m,f=[],g=this.formToArray(t.semantic,f);if(t.data&&(t.extraData=t.data,m=e.param(t.data,h)),t.beforeSubmit&&t.beforeSubmit(g,this,t)===!1)return i("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,t,p]),p.veto)return i("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var v=e.param(g,h);m&&(v=v?v+"&"+m:m),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+v,t.data=null):t.data=v;var _=[];if(t.resetForm&&_.push(function(){u.resetForm()}),t.clearForm&&_.push(function(){u.clearForm(t.includeHidden)}),!t.dataType&&t.target){var b=t.success||function(){};_.push(function(a){var i=t.replaceTarget?"replaceWith":"html";e(t.target)[i](a).each(b,arguments)})}else t.success&&_.push(t.success);t.success=function(e,a,i){for(var n=t.context||this,o=0,s=_.length;s>o;o++)_[o].apply(n,[e,a,i||u,u])};var y=e('input[type=file]:enabled[value!=""]',this),w=y.length>0,k="multipart/form-data",C=u.attr("enctype")==k||u.attr("encoding")==k,x=n.fileapi&&n.formdata;i("fileAPI :"+x);var D,P=(w||C)&&!x;t.iframe!==!1&&(t.iframe||P)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){D=r(g)}):D=r(g):D=(w||C)&&x?s(g):e.ajax(t),u.removeData("jqxhr").data("jqxhr",D);for(var S=0;S<f.length;S++)f[S]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(n){if(n=n||{},n.delegation=n.delegation&&e.isFunction(e.fn.on),!n.delegation&&0===this.length){var o={s:this.selector,c:this.context};return!e.isReady&&o.s?(i("DOM not ready, queuing ajaxForm"),e(function(){e(o.s,o.c).ajaxForm(n)}),this):(i("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return n.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,a).on("submit.form-plugin",this.selector,n,t).on("click.form-plugin",this.selector,n,a),this):this.ajaxFormUnbind().bind("submit.form-plugin",n,t).bind("click.form-plugin",n,a)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,a){var i=[];if(0===this.length)return i;var o=this[0],s=t?o.getElementsByTagName("*"):o.elements;if(!s)return i;var r,l,c,d,u,p,h;for(r=0,p=s.length;p>r;r++)if(u=s[r],c=u.name,c&&!u.disabled)if(t&&o.clk&&"image"==u.type)o.clk==u&&(i.push({name:c,value:e(u).val(),type:u.type}),i.push({name:c+".x",value:o.clk_x},{name:c+".y",value:o.clk_y}));else if(d=e.fieldValue(u,!0),d&&d.constructor==Array)for(a&&a.push(u),l=0,h=d.length;h>l;l++)i.push({name:c,value:d[l]});else if(n.fileapi&&"file"==u.type){a&&a.push(u);var m=u.files;if(m.length)for(l=0;l<m.length;l++)i.push({name:c,value:m[l],type:u.type});else i.push({name:c,value:"",type:u.type})}else null!==d&&"undefined"!=typeof d&&(a&&a.push(u),i.push({name:c,value:d,type:u.type,required:u.required}));if(!t&&o.clk){var f=e(o.clk),g=f[0];c=g.name,c&&!g.disabled&&"image"==g.type&&(i.push({name:c,value:f.val()}),i.push({name:c+".x",value:o.clk_x},{name:c+".y",value:o.clk_y}))}return i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var a=[];return this.each(function(){var i=this.name;if(i){var n=e.fieldValue(this,t);if(n&&n.constructor==Array)for(var o=0,s=n.length;s>o;o++)a.push({name:i,value:n[o]});else null!==n&&"undefined"!=typeof n&&a.push({name:this.name,value:n})}}),e.param(a)},e.fn.fieldValue=function(t){for(var a=[],i=0,n=this.length;n>i;i++){var o=this[i],s=e.fieldValue(o,t);null===s||"undefined"==typeof s||s.constructor==Array&&!s.length||(s.constructor==Array?e.merge(a,s):a.push(s))}return a},e.fieldValue=function(t,a){var i=t.name,n=t.type,o=t.tagName.toLowerCase();if(void 0===a&&(a=!0),a&&(!i||t.disabled||"reset"==n||"button"==n||("checkbox"==n||"radio"==n)&&!t.checked||("submit"==n||"image"==n)&&t.form&&t.form.clk!=t||"select"==o&&-1==t.selectedIndex))return null;if("select"==o){var s=t.selectedIndex;if(0>s)return null;for(var r=[],l=t.options,c="select-one"==n,d=c?s+1:l.length,u=c?s:0;d>u;u++){var p=l[u];if(p.selected){var h=p.value;if(h||(h=p.attributes&&p.attributes.value&&!p.attributes.value.specified?p.text:p.value),c)return h;r.push(h)}}return r}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var a=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var i=this.type,n=this.tagName.toLowerCase();a.test(i)||"textarea"==n?this.value="":"checkbox"==i||"radio"==i?this.checked=!1:"select"==n?this.selectedIndex=-1:"file"==i?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(i)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var a=this.type;if("checkbox"==a||"radio"==a)this.checked=t;else if("option"==this.tagName.toLowerCase()){var i=e(this).parent("select");t&&i[0]&&"select-one"==i[0].type&&i.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}(jQuery),function(){"use strict";var t=e.prototype;t.wireUpAddPlaceButtons=function(e){return this._wireUpAddPlaceButtons(e),this},t.wireUpLikeButtons=function(e){return this._wireUpLikeButtons(e),this},t.wireUpReportAndEditButtons=function(e){return this._wireUpRAEB(e),this},t.wireUpReportListingButtons=function(e){return this._wireUpRLB(e),this},t.wireUpAskExpertLinks=function(e){return this._wireUpAskExpertLinks(e),this};var a=function(e){$("#curation-messaging").children().removeClass("form-error-message").addClass("progress").html(e)},i=function(e){$("#curation-messaging").children().removeClass("progress").addClass("form-error-message").html(e)},n=function(){return{center:new google.maps.LatLng(37.784915,-122.406878),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1,panControl:!1,zoomControl:!1}};t.isValidUrl=function(e){var t=new RegExp("^[A-Za-z]+://[A-Za-z0-9-_]+\\.[A-Za-z0-9-_%&?/.=+:]+$");return t.test(e)},t.getCategorySelectOptionsHtml=function(e,t){var a=this._categories,i=function(a,n){return n.children?a+'<optgroup label="'+n.name+'">'+_(n.children).reduce(i,"")+"</optgroup>":a+'<option value="'+n.id+'"'+(n.name==e||n.id==t?" selected":"")+">"+n.name+"</option>"};return _(a.positive.categories.concat([{name:"Problem Spots",children:a.negative.categories}])).reduce(i,"")},t.getPossibleDuplicatesFor=function(e){return _(this.app.placeMapManager.places).chain().reject(function(t){return t.external_id==e.external_id}).sortBy(function(t){return t.latLng.distanceFrom(e.latLng)}).map(this._getTemplate("duplicate_place_option")).value().join("")};var o={comment:'<h3>Comment:</h3><form name="curate-form" id="curate-form" class="ws-default" method="post" enctype="multipart/form-data"><% if (tvars.mobile_photo_upload) { %><div id="curate-photo-upload" class="comment"><label>Add a photo (optional)</label><span class="addphoto icon"></span><input name="photo" type="file" accept="image/*" capture="camera"/></div><% } %><textarea name="comments" class="user-comment" data-role="none" style="width:95%;" rows="3" ><%- tvars.comment || "" %></textarea><% if (tvars.photo_upload) { %><div id="curate-photo-upload" class="comment big-pad-bot"><label>Add a photo (optional)</label><span class="addphoto icon"></span><input name="photo" type="file" /></div><% } %><div id="user-login"></div><div><input id="curate-confirm" type="submit" value="Comment" class="b-btn" data-role="none"/><input id="curate-cancel" class="curate-cancel b-btn light" type="button" data-role="none" value="Cancel" /><% if (tvars.is_edit) { %><a id="curate-remove" class="dull-link">Delete Comment</a><% } %></div><div id="curation-messaging"><p class="tight-bot">&nbsp;</p></div></form>',report_comment:'<h3>Why are you reporting this comment?</h3><form name="curate-form" id="curate-form" class="ws-default"><textarea name="comments" class="user-comment" style="width:95%;" rows="3" ></textarea><div id="user-login"></div><div><input id="curate-confirm" type="submit" value="Report" class="b-btn" /><input class="curate-cancel" type="button" value="Cancel" class="b-btn light" /></div><div id="curation-messaging"><p class="tight-bot">&nbsp;</p></div></form>',delete_comment:'<h3>Are you sure you want to delete this comment?</h3><form name="curate-form" id="curate-form" class="ws-default"><div id="user-login"></div><div><input id="curate-confirm" type="submit" value="Delete" class="b-btn" /><input class="b-btn light curate-cancel" type="button" value="Cancel" class="b-btn light" /></div><div id="curation-messaging"><p class="tight-bot">&nbsp;</p></div></form>',add_edit:'<% var place = tvars.place, geoData = tvars.geoData||{}; %><h3>Edit <% tvars.type %> Place:</h3><form name="curate-form" id="curate-form" class="ws-default"><div class="float-right"><div id="add-map"></div><p class="med medsmallfont float-right">Click map to adjust location.</p></div><div class="vertical-spaced-form"><div id="place-type-select"><label>What type of place?</label><select class="prop-category_id" name="category_id"><option value="" >Choose a category</option><% print(this.getCategorySelectOptionsHtml(null, place.category_id)) %></select></div><div><label>Place Name <span>e.g. Irwin\'s Coffee Shop</span></label><input class="prop-name" name="placename" id="placename" type="text" value="<%- place.name || "" %>"></input></div><div><label>Address <span>e.g. 2123 N 40th St. Seattle, WA 98103</span></label><input name="address" id="add-address" type="text" value="<%- place.getFullAddress() || geoData.formattedAddress || "" %>"></input></div><div><label>Phone Number <span>e.g. (206)555-5555</span></label><input class="prop-phone" name="phone" type="text" value="<%- place.phone || "" %>"></input></div><div><label>Website <span>e.g. www.irwins.com</span></label><input class="prop-url" name="site" type="text" value="<%- place.url || "" %>"></input></div><% if (tvars.want_comments){ %><div><label>Comments:</label> <span id="char-counter"></span><textarea name="comment" id="comment"></textarea></div></div><% } %><div id="user-login"></div><div><p><a id="curate-confirm" class="b-btn">Submit</a><a id="curate-cancel" class="b-btn light">Cancel</a><a id="curate-remove" class="b-btn red-btn" href="#">Remove Place</a></p></div><p class="normal">It may take up to 24 hours for your edits to appear.</p><div id="curation-messaging"><p class="tight-bot"></p></div><% if (tvars.showRemovePlaceButton){ %></div><% } %></form>',remove:'<% var place = tvars.place; %><h3>Why are you removing this place?</h3><form name="curate-form" id="curate-form" class="ws-default"><div class="big-pad-top big-pad-bot indent2"><div><input type="radio" name="reason" id="reason_1"  value="nonexistent"><label for="reason_1" class="inline">Closed or doesn\'t exist</label></div><div id="dupe-listing"><input type="radio" name="reason" id="reason_2" value="duplicate"><label for="reason_2" class="inline">Duplicate of </label><select name="duplicate-place" id="duplicate_place" style="width: 200px;"><% print(this.getPossibleDuplicatesFor(place)) %></select></div><div><input type="radio" name="reason" id="reason_4"  value="notretail"><label for="reason_4" class="inline">Not a retail location</label></div><div><input type="radio" name="reason" id="reason_3" value="delete"><label for="reason_3" class="inline">Other</label></div></div><div><label for="comment">Comments:</label> <span id="char-counter"></span><textarea name="comment" id="comment"></textarea></div></div><div><input id="curate-remove" type="button" value="Remove Place" class="b-btn" /><input id="curate-cancel" type="button" value="Cancel" class="b-btn light" /></div><div id="curation-messaging"><p class="tight-bot"></p></div><div id="user-login"></div></form>',duplicate_place_option:'<% var p = tvars; %><option value="<%=p.external_id%>"><%-p.name%></option>',comment_report_thanks:"<h3>Got it</h3><p>Thanks for reporting this comment.</p>",place_remove_thanks:"<h3>Got it</h3><p>Thanks for reporting this place.</p>",ask_expert:'<h3 class="tight">Ask <%=tvars.uname%> a question about <%=tvars.pname%></h3><form name="curate-form" id="curate-form" class="ws-default"><textarea name="comments" class="user-question" style="width:95%;" rows="3" placeholder="Type your question here. Neighborhood guides are happy to answer your questions." ></textarea><div id="user-login"></div><div id="curate-buttons" style="display: none;"><input id="curate-confirm" type="submit" value="Ask Question" class="b-btn" /><input class="curate-cancel b-btn light" type="button" value="Cancel" /></div><div id="curation-messaging"><p class="notice">&nbsp;</p></div></form>',ask_expert_thanks:"<h3>Got it</h3><p>Thanks for your question.</p>",add_photo_promo:'<h3><a class="add-place">Share Your Favorite Places</a></h3><p><a class="add-place">Add photos</a> of your favorite places to Walk Score.</p><div class="photo-grid"><img src="//cdn2.walk.sc/2/images/places-great-coffee.jpg" alt="place photos" class="add-place" /><img src="//cdn2.walk.sc/2/images/places-public-art.jpg" alt="place photos" class="add-place" /><img src="//cdn2.walk.sc/2/images/places-farmers-market.jpg" alt="place photos" class="add-place" /><img src="//cdn2.walk.sc/2/images/places-outdoor-places.jpg" alt="place photos" class="add-place" /></div><% if (tvars && tvars.htmlBlog) { %><a id="get-started" class="b-btn tall add-btn" href="http://blog.walkscore.com/2012/10/how-to-add-places-on-walk-score/" target="_blank"><span class="addphoto icon"></span>Get Started</a><% } else { %><a class="b-btn tall add-btn add-place"><span class="addphoto icon"></span>Add a Photo</a><% } %><p>Add places on the go with our <a href="https://itunes.apple.com/us/app/walk-score/id536017866" target="_blank">free iPhone App</a>.</p><p class="notice">Places you add may increase your Walk Score.</p>'};t._getTemplate=function(e){return this._templates||(this._templates={}),this._templates[e]||(this._templates[e]=_(_.template(o[e],null,{variable:"tvars"})).bind(this))},t.addCommentHtml=function(){return window.isMobile?this._getTemplate("comment")({mobile_photo_upload:!0}):this._getTemplate("comment")({photo_upload:!0})},t.editCommentHtml=function(e){return this._getTemplate("comment")({comment:e,is_edit:!0})},t.editPlaceHtml=function(e,t){return this._getTemplate("add_edit")({type:"Edit",place:e,geoData:t,showRemovePlaceButton:!0})},t.removePlaceHtml=function(e){return this._getTemplate("remove")({place:e})},DataCuratorAuthMixin(t),e.COMMENT_MAX_LENGTH=500,t.setPosition=function(e){this.x=e.e?e.e.pageX+20:100,this.y=e.e?e.e.pageY-70:100},t.onPlaceChangeCurationComplete=function(e,t){window._pageCache&&(window._pageCache={})},t.initNewPlaceLike=function(e){this.setPosition(e);var t=e.url||"/auth/places/v1/toggle-like-place",a=e.id?{place_id:e.id}:{place:JSON.stringify(unpackPlaceData(e.place),null,2)},i=function(i){i&&(e.blockHideDialog||hideDialog(),$.ajax({type:"GET",data:_(a).extend(e.params||{}),cache:!1,url:t,success:e.c}))};this.withUser(_(function(e){if(e)return i(e);var t='<h3>Sign in to like a place</h3><div id="user-login"></div><p class="medsmallfont clear-all pad-top">We require login to prevent abuse.<br />We never post without your permission.</p>';if(window.isMobile&&(t+='<input class="curate-cancel b-btn light" type="button" data-role="none" value="Cancel" />'),showDialog(t,"curate-place login-only",!0,this.x,this.y),this.updateLoginInfo(i),window.isMobile){var a=$(".login-only");a.find(".curate-cancel").click(hideDialog)}}).bind(this))},t.addPlaceToDB=function(e,t){var a={place:JSON.stringify(unpackPlaceData(e),null,2)};$.post("/auth/places/v1/add-place",a,t)},t.initNewPlaceComment=function(t){this.setPosition(t);var n=(this.app,_(function(e){e&&e.preventDefault&&e.preventDefault(),window.isMobile&&e&&e.stopPropagation&&e.stopPropagation();var n=$.trim(o.find("textarea").val()||o.find("input[type=text]").val()||"");return n?(a("Saving your comment..."),this.withUser(_(function(e){if(!e)return i("Please log in to comment on a place.");t.blockHideDialog||hideDialog();var a=t.id?{place_id:t.id}:{place:JSON.stringify(unpackPlaceData(t.place))};_(a).extend({comment:n}),(a.place_id||a.place)&&a.comment?o.ajaxSubmit({url:"/auth/places/v1/add-place-review",dataType:"json",timeout:6e4,data:a,success:_(function(e){e&&e.reviews&&e.reviews.comments?(t.blockHideDialog||hideDialog(),trackEvent("Curation","Add comment",document.location.href),t.c&&t.c(e,a)):this.showError((e||{}).error?e.error:"Couldn't save your change, try reloading this page.")}).bind(this)}):hideDialog()}).bind(this)),!1):i("Please enter a comment.")}).bind(this));if(t.commentForm){var o=$(t.commentForm);o.unbind("submit").submit(_(function(e){e.preventDefault(),this.withUser(_(function(e){if(e)return n();var t='<h3>Sign in to leave your comment</h3><div id="user-login"></div><p class="medsmallfont clear-all med big-pad-top">We require login to prevent abuse.<br />We never post without your permission.</p>';showDialog(t,"curate-place login-only",!0,this.x,this.y),this.updateLoginInfo(n)}).bind(this))}).bind(this))}else{showDialog(this.addCommentHtml(),"curate-place",!0,this.x,this.y);var o=$("#curate-form");o.find(".curate-cancel").click(hideDialog),this.updateLoginInfo(),o.submit(n)}var s=o.find(".user-comment"),r=o.find(".char-counter");r.length&&s.keyup(function(){limitText(s,r,e.COMMENT_MAX_LENGTH)})},t.initNewPlaceEdit=function(e){this.whenCategoriesReady(_(this.initNewPlaceEditContinuation).bind(this,e))},t.initNewPlaceEditContinuation=function(e){this.withPlaceGeoData(e.place,_(this.initNewPlaceEditContinuation2).bind(this,e))},t.initNewPlaceEditContinuation2=function(e,t){this.setPosition(e);var o=(this.app,e.place);this._didGeocode=!1;var s=_(function(t){return t.preventDefault(),a("Saving your changes..."),this.withUser(_(function(t){if(!t)return i("Please log in to edit a place.");var a=this.geoData,n=this._didGeocode?_({address:"getThoroughfare",lat:"getPreSnapLat",lng:"getPreSnapLng"}).oreduce(function(e,t,i){e[i]=a[t]()}):{},s={reason:"edit",place:JSON.stringify(unpackPlaceData(o)),edited_place:JSON.stringify(_(_(["name","url","phone","category_id"]).oreduce(function(e,t){e[t]=$("#curate-form .prop-"+t).val()},n)).trim())};$.ajax({url:"/auth/places/v1/curate",method:"POST",dataType:"json",timeout:6e4,data:s,success:_(function(t){hideDialog(),trackEvent("Curation","Edit place",document.location.href),this.onPlaceChangeCurationComplete(),e.c&&e.c(t,s,e.place)}).bind(this)})}).bind(this)),!1}).bind(this),r=_(function(t){t.preventDefault(),hideDialog(),this.initNewPlaceRemove(e)}).bind(this);showDialog(this.editPlaceHtml(o,this.geoData),"add-place",!0,this.x,this.y),this.updateLoginInfo();var l=_(n()).extend({center:o.latLng});this.map=new google.maps.Map($("#add-map")[0],l),this.showGeocodeLocation(this.geoData,{recenter:!0}),$("#curate-confirm").click(s),$("#curate-cancel").click(hideDialog),$("#curate-remove").click(r),$("#add-address").change(_(this.geocodeAddAddress).bind(this)),google.maps.event.addListener(this.map,"click",_(function(e){this.geocodeAddAddress({fromLatLng:e.latLng,updateAddressText:!0})}).bind(this))},t.initNewPlaceRemove=function(e){this.setPosition(e);var t=(this.app,e.place),n=_(function(){a("Saving removal..."),this.withUser(_(function(a){if(!a)return i("Please log in to edit a place.");var n={reason:$('#curate-form :radio[name="reason"]:checked').val(),comment:$("#curate-form").find("textarea").val(),place:JSON.stringify(unpackPlaceData(t)),other_place:JSON.stringify(unpackPlaceData(this.app.placeMapManager.getPlaceByExternalId($('#curate-form [name="duplicate-place"]').val())))};return n.reason?"delete"!=n.reason||n.comment?void $.ajax({url:"/auth/places/v1/curate",method:"POST",dataType:"json",timeout:6e4,data:n,success:_(function(t){updateDialog(this._getTemplate("place_remove_thanks")(t)),trackEvent("Curation","Remove place",document.location.href),this.onPlaceChangeCurationComplete(),e.c&&e.c(t,n)}).bind(this)}):i("Please enter a comment."):i("Please choose a reason.")}).bind(this))}).bind(this);showDialog(this.removePlaceHtml(t),"remove-place",!0,this.x,this.y),$("#curate-cancel").click(hideDialog),$("#curate-remove").click(n)},t._wireUpAddPlaceButtons=function(e){e=e||{};var t=e.c||function(e,t){_(e).spelunk(["place","place_page_url"])&&(window.location=e.place.place_page_path)},a=e.nodes||(e.containers||$("body")).find(".add-place");a.unbind().css("cursor","pointer").click(_(function(a){a.preventDefault(),trackEvent(ACTIVE_COMPONENT,"add place click",$(a.target).attr("tracklabel")),$.isFunction(e.addPlaceClick)&&e.addPlaceClick(),this.initAddPlace(e.category?e.category:null,e.bounds||_(this).spefunc(["map","getBounds"])()||_(this).spefunc(["app","map","getBounds"])(),"center",null,e,t)}).bind(this)),e.trackLabel&&a.attr("tracklabel",e.trackLabel)},t._wireUpLikeButtons=function(e){e=e||{};var t=_(function(t,a,i){this._updatePlaceFromToggleLikeResponse(a,t),e.c&&e.c(a,i)}).bind(this),a=e.nodes||(e.containers||$("body")).find(".vote-btn"),i=this;a.unbind().click(function(a){a.preventDefault();var n=getIdFromPrefixedClass($(this),"for-").split("-"),o=n[0],s=n[1],r={format:"json"};return s&&(r.review_id=s),i.initNewPlaceLike({id:o,e:a,c:_(t).bind({},s),place:e.place,params:r,blockHideDialog:e.blockHideDialog}),s?trackEvent(ACTIVE_COMPONENT,"like review click",s):trackEvent(ACTIVE_COMPONENT,"like place click",o),!1}),e.ajaxInit&&this.withUser(_(function(e){var i=(e||{}).display_id;if(i!=this._p_display_id){this._p_display_id=i;var n=_(_(a).oreduce(function(e,t){e[getIdFromPrefixedClass($(t),"for-")]=!0})).keys();n&&$.ajax({url:"/auth/places/v1/get-place-reviews-multi",type:"GET",cache:!1,success:function(e){_(e).each(function(e){t(null,e)})},data:{place_ids:n.join("|")}})}}).bind(this))},t._wireUpAskExpertLinks=function(e){e||(e={});var t=this;$(".ask-expert").click(function(e){var a=$(this),i=getIdFromPrefixedClass(a,"user-"),n=getIdFromPrefixedClass(a,"about-").split("-"),o=n[0],s=n[1],r=a.find(".user-name").text(),l=a.find(".place-name").text();t.initAskExpert({e:e,uid:i,cid:o,hid:s,uname:r,pname:l})})},t._wireUpRAEB=function(e){var t=this;_({report:"initNewPlaceReviewReport",edit:"initNewPlaceReviewEdit"}).each(function(a,i){$(".comment ."+i).unbind().click(function(n){var o=getIdFromPrefixedClass($(this),"for-"),s=o.split("-"),r=$(".representing-"+o+" .comment-text").text();t[a](_({place_id:s[0],review_id:s[1],comment:r,e:n}).extend(e||{})),trackEvent(ACTIVE_COMPONENT,i+" review click",s[1])})})},t._updatePlaceFromToggleLikeResponse=function(e,t){var a=_(e||{}).spelunk(["place","id"]),i=(e||{}).reviews||{};t&&(i=_(i.comments||[]).detect(function(e){return e.id==t})||{});var n=i.user_does_like,o=i.n_likes;if(a){var s=".representing-"+a;
t&&(s+="-"+t);var r=$(s),l=t?".comment":".place";r.find(l+".vote-btn")[n?"addClass":"removeClass"]("pressed"),r.find(l+".n-likes").html(o),r.find(l+".votes-plural").html(1==o?"":"s")}},t.initEditPlace=function(e,t,a,i,n,o){this.activeAmenity=e,this.showAddOrEditPlace("Edit",e.getCategory(),t,a,i,n,o),trackEvent("Curation","Show edit dialog",document.location.href)},t.initAddPlace=function(e,t,a,i,n,o){this.activeAmenity=null,this.showAddOrEditPlace("Add",e,t,a,i,n,o),trackEvent("Curation","Show add dialog",document.location.href)},t.whenCategoriesReady=function(e){return this._categories?e(this._categories):(this._categories=1,void jQuery.getJSON("/auth/places/v1/get-place-categories",_(function(t){this._categories=t,e(this._categories)}).bind(this)))},t.showAddOrEditPlace=function(t,a,i,o,s,r,l){if(!this._categories)return this.whenCategoriesReady(_(function(){this.showAddOrEditPlace(t,a,i,o,s,r,l)}).bind(this));this.addPlaceCallback=l;var c="";this.geocoder=_(this).spelunk(["app","geocoder"])||new google.maps.Geocoder,this.x="center"==o?"center":o+20,this.y=s?s-70:null;var d=[];d.push("<h3>"+t+" a Place</h3>"),d.push('<form name="curate-form" id="curate-form" method="post" enctype="multipart/form-data" class="ws-default">'),d.push('<div class="vertical-spaced-form">'),d.push('<div class="columns clearfix"><div id="place-type-select" class="left-half"><label>What type of place?</label>'),d.push('<select name="category_id">'),d.push('<option value="" >Choose a category</option>'),d.push(this.getCategorySelectOptionsHtml(a)),d.push("</select></div>"),d.push('<div id="curate-photo-upload" class="right-half"><label>Choose a photo</label><span class="addphoto icon"></span><input name="photo" type="file" /></div></div>'),d.push('<div class="float-right"><div id="add-map"></div>'),d.push('<p class="med medsmallfont float-right">Click map to set/adjust location.</p></div>'),d.push("<div><label>Place Name <span>e.g. Irwin's Coffee Shop</span></label>"),d.push('<input name="placename" id="placename" type="text"></input></div>'),d.push("<div><label>Address <span>e.g. 2123 N 40th St. Seattle, WA 98103</span></label>"),d.push('<input name="address" id="add-address" type="text"></input></div>'),d.push("<div><label>Phone Number <span>e.g. (206)555-5555</span></label>"),d.push('<input name="phone" type="text"></input></div>'),d.push("<div><label>Website <span>e.g. www.irwins.com</span></label>"),d.push('<input name="site" type="text"></input></div>'),d.push('<div><label>Comments:</label> <span id="char-counter"></span>'),d.push('<textarea name="comment" id="comment">'+(_(r||{}).spelunk(["text"])||"")+"</textarea></div>"),d.push("</div>"),d.push('<div id="user-login"></div>'),d.push('<div><p><input id="curate-confirm" type="button" value="Submit" class="b-btn" /><input id="curate-cancel" type="button" value="Cancel" class="b-btn light" /></p></div>'),d.push('<p class="normal">It may take up to 24 hours for your edits to appear.</p>'),d.push('<div id="curation-messaging"><p class="tight-bot"></p></div>'),d.push(c),d.push("</form>"),showDialog(d.join(""),"add-place",!0,this.x,this.y),this.updateLoginInfo();var u=_(n()).extend({center:i?i.getCenter():new google.maps.LatLng(-33.8688,151.2195),zoom:i?13:0});this.map=new google.maps.Map(document.getElementById("add-map"),u);$("#curate-form").submit(_(this.saveAddedPlace).bind(this)),$("#curate-confirm").click(_(this.saveAddedPlace).bind(this)),$("#curate-cancel").click(hideDialog),$("#add-address").change(_(this.geocodeAddAddress).bind(this)),google.maps.event.addListener(this.map,"click",_(function(e){this.geocodeAddAddress({fromLatLng:e.latLng,updateAddressText:!0})}).bind(this)),$("#comment").keyup(function(){limitText($("#comment"),$("#char-counter"),e.COMMENT_MAX_LENGTH)});var p=$("#curate-form");if(this.activeAmenity){var h=this.activeAmenity;h.userAddress||(h.userAddress=_(["getStreetAddress","getCity","getRegion"]).map(function(e){return h[e]()}).join(" "));var m=_(function(e){var t=this._categories.positive.categories;for(catgroup in t)if(t[catgroup].children){var a=_(t[catgroup].children).find(function(t){return t.amenity_profile_name==e});if(a)return a.id}return null}).bind(this),f=m(a);f&&p.find("select").val(f),_({placename:reversespecialchars(h.getName()),address:h.userAddress,phone:reversespecialchars(h.getPhoneNumber()),site:reversespecialchars(h.getUrl())}).each(function(e,t){p.find("[name="+t+"]").val(e)}),h.userAddress.trim().length>0?this.geocodeAddAddress():this.showGeocodeLocation(new GeoData("",h.point),{recenter:!0})}else{var g=new google.maps.places.Autocomplete($("#placename").get(0),{bounds:i});google.maps.event.addListener(g,"place_changed",_(function(){$("#comment").focus();var e=g.getPlace(),t="",a="",i=_(_(e).spelunk(["address_components",0,"types"])).detect(function(e){return"street_number"==e});i&&(a=e.address_components[0].short_name,t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" "));var n=_(e);_(function(){_({placename:n.spelunk(["name"]),address:t,phone:n.spelunk(["formatted_phone_number"]),site:n.spelunk(["website"])}).each(function(e,t){p.find("[name="+t+"]").val(e)})}).defer();var o=new GeoData("",e.geometry.location,_(e).spelunk(["address_components",4,"short_name"]),_(e).spelunk(["address_components",4,"long_name"]),n.spelunk(["formatted_address"]),_(e).spelunk(["address_components",3,"short_name"]),_(e).spelunk(["address_components",0,"short_name"])+" "+_(e).spelunk(["address_components",1,"short_name"]),_(e).spelunk(["address_components",2,"short_name"]),_(e).spelunk(["address_components",5,"short_name"]),e.geometry.location);o.streetNumber=a,this.showGeocodeLocation(o,{recenter:!0})}).bind(this))}},t.withPlaceGeoData=function(e,t){this.geocoder||(this.geocoder=this.app.getGeocoder()),this.geocoder.geocode({location:e.latLng},_(function(e){t(this.geoData=geoDataFromGoogleResponse(e))}).bind(this))},t.geocodeAddAddress=function(e){e=e||{},this._didGeocode=!0;var t=e.fromLatLng?{location:e.fromLatLng}:{address:$("#add-address").val()};this.geocoder.geocode(t,_(function(t){this.geoData=geoDataFromGoogleResponse(t),e.fromLatLng&&this.geoData.setLatLng(e.fromLatLng),this.showGeocodeLocation(this.geoData,{recenter:!e.fromLatLng,updateAddressText:e.updateAddressText})}).bind(this))},t.showGeocodeLocation=function(e,t){if(e&&e.getPreSnapLatLng()){this.geoData=e,t=t||{};var a=this.geoData.getPreSnapLatLng();a.ws_coerce&&(a=a.ws_coerce("google")),this.addPlaceMarker||(this.addPlaceMarker=new google.maps.Marker({position:a})),this.addPlaceMarker.setPosition(a),this.addPlaceMarker.setMap(this.map),this.map.setZoom(16),!t.recenter&&this.map.getBounds().contains(a)||this.map.setCenter(a),t.updateAddressText&&$("#add-address").val(this.geoData.getThoroughfare()),this.addGeoData=this.geoData,$("#curation-messaging").children().html("")}else this.addPlaceMarker&&this.addPlaceMarker.setMap(null),$("#curation-messaging").children().addClass("form-error-message").html("Couldn't locate this address -- please try again.")},t.saveAddedPlace=function(){var e=$("#curate-form"),t=e.find("[name=category_id]").val(),a=e.find("[name=placename]").val(),i=e.find("[name=address]").val(),n=e.find("[name=phone]").val(),o=e.find("[name=site]").val(),s=e.find("textarea").val(),r=e.find("input:file").val(),l=o.indexOf("://");if((o.length>0&&-1==l||l>8)&&(o="http://"+o),t)if(a)if(this.addGeoData&&this.addGeoData.getPreSnapLatLng())if(o.length>0&&!this.isValidUrl(o))$("#curation-messaging").children().addClass("form-error-message").html("Please correct the website address, or leave it blank.");else if(r&&!s)$("#curation-messaging").children().addClass("form-error-message").html("Please add a comment to go with your photo upload.");else{var c=this.addGeoData.getPreSnapLatLng(),d=c.lat(),u=c.lng(),p=this.addGeoData.hasStreetNumber()?this.addGeoData.getThoroughfare():"",h=this.addGeoData.getCity(),m=this.addGeoData.getAdminArea(),f=this.addGeoData.getPostalCode();this.activeAmenity&&"Local"==this.activeAmenity.getDataSource()&&(this.activeAmenity.key="ws_local_"+this.activeAmenity.pid);var g="";g+=urlifyParam("&category_id",t),g+=urlifyParam("&name",a),g+=urlifyParam("&user_address",i),g+=urlifyParam("&address",p),g+=urlifyParam("&city",h),g+=urlifyParam("&region",m),g+=urlifyParam("&postal",f),g+=urlifyParam("&lat",d),g+=urlifyParam("&lng",u),g+=urlifyParam("&phone",n),g+=urlifyParam("&comment",s);var v=this,_={category_id:t,pid:this.activeAmenity?this.activeAmenity.pid:"",lat:d,lng:u,url:o,name:a,user_address:i,address:p,city:h,region:m,postal:f,phone:n,file:r,comment:s};g+=this.activeAmenity&&"Local"!=this.activeAmenity.getDataSource()?urlifyParam("&act","edit"):urlifyParam("&act","add"),this.submitData({place:JSON.stringify(_)},function(e,t){v.onAdditionComplete(e,_,t)},"/auth/places/v1/add-place"),$("#curate-confirm").attr("disabled",!0),$("#curation-messaging").children().removeClass("form-error-message").addClass("progress").html("Saving your change...")}else $("#curation-messaging").children().addClass("form-error-message").html("Couldn't locate this address -- please try again.");else $("#curation-messaging").children().addClass("form-error-message").html("Please enter the name of the place to add.");else $("#curation-messaging").children().addClass("form-error-message").html("Please choose a category for the place to add.")},t.onAdditionComplete=function(e,t,a){if(e&&e.place&&e.place.canonical_name){var i=_(function(a){hideDialog(),this.activeAmenity?trackEvent("Curation","Edit amenity",document.location.href):trackEvent("Curation","Add amenity",document.location.href),this.onPlaceChangeCurationComplete(),this.addPlaceCallback&&this.addPlaceCallback(a||e,t)}).bind(this),n=_(e).spelunk(["place","id"]);n&&t.comment?$("#curate-form").ajaxSubmit({url:"/auth/places/v1/add-place-review",dataType:"json",timeout:6e4,data:{place_id:n},success:_(function(e){e&&e.reviews&&e.reviews.comments?i(e):this.showError((e||{}).error?e.error:"Couldn't save your change, try reloading this page.")}).bind(this)}):i()}else this.showError((e||{}).error?e.error:"Couldn't save your change, try reloading this page.")},t.showError=function(e){$("#curation-messaging").children().removeClass("progress").addClass("form-error-message").html(e),$("#curate-confirm").attr("disabled",!1)},t.deleteAmenity=function(e){var t="";t+=urlifyParam("act","delete"),t+=urlifyParam("&key",this.activeAmenity.getKey()),t+=urlifyParam("&cat",this.activeAmenity.getCategory()),t+=urlifyParam("&ws_url",document.location.href);var a=this;this.submitData(t,function(t){e||a.onDeleteComplete(parseJson(t))}),e&&this.app.deleteAmenity(this.activeAmenity.getCategory(),this.activeAmenity.getKey()),$("#curate-confirm").attr("disabled",!0),$("#curation-messaging").children().removeClass("form-error-message").addClass("progress").html("Saving your change...")},t.onDeleteComplete=function(e){e&&"success"==e.report?(hideDialog(),this.app.deleteAmenity(this.activeAmenity.getCategory(),this.activeAmenity.getKey()),trackEvent("Curation","Remove amenity",document.location.href),this.onPlaceChangeCurationComplete(),this.activeAmenity=null):($("#curation-messaging").children().removeClass("progress").addClass("form-error-message").html("Couldn't save your change, try reloading this page."),$("#curate-confirm").attr("disabled",!1))},t.initNewPlaceReviewReport=function(e){this.setPosition(e);var t=(this.app,_(function(t){t&&t.preventDefault&&t.preventDefault();var n=o.find("textarea").val();return n?(a("Saving your report..."),this.withUser(_(function(t){var a={place_id:e.place_id,review_id:e.review_id,comment:n},i=_(function(e){"OK"==(e||{}).result?(updateDialog(this._getTemplate("comment_report_thanks")()),trackEvent("Curation","Edit comment",document.location.href)):this.showError((e||{}).error?e.error:"Couldn't save your report, try reloading this page.")}).bind(this);$.ajax({url:"/auth/places/v1/report-place-review",dataType:"json",data:a,success:i,error:i})}).bind(this)),!1):i("Please enter a comment.")}).bind(this)),n=this._getTemplate("report_comment")();showDialog(n,"curate-place",!0,this.x,this.y),this.updateLoginInfo(null,!1,!0);var o=$("#curate-form");o.find(".curate-cancel").click(hideDialog),o.submit(t)},t.initNewPlaceReviewEdit=function(e){this.setPosition(e);var t=(this.app,_(function(t){t&&t.preventDefault&&t.preventDefault();var n=$.trim(s.find("textarea").val()||"");return n?(a("Saving your comment..."),this.withUser(_(function(t){if(!t)return i("Please log in to comment on a place.");var a={place_id:e.place_id,review_id:e.review_id,comment:n};s.ajaxSubmit({url:"/auth/places/v1/add-place-review",dataType:"json",timeout:6e4,data:a,success:_(function(t){t&&t.reviews&&t.reviews.comments?(hideDialog(),trackEvent("Curation","Edit comment",document.location.href),this.onPlaceChangeCurationComplete(),e.c&&e.c(t,a)):this.showError((t||{}).error?t.error:"Couldn't save your change, try reloading this page.")}).bind(this)})}).bind(this)),!1):i("Please enter a comment.")}).bind(this)),n=_(function(t){t.preventDefault(),hideDialog(),this.initNewPlaceReviewDelete(e)}).bind(this),o=this.editCommentHtml(e.comment);showDialog(o,"curate-place",!0,this.x,this.y),this.updateLoginInfo();var s=$("#curate-form");s.find(".curate-cancel").click(hideDialog),s.submit(t),$("#curate-remove").click(n)},t.initNewPlaceReviewDelete=function(e){this.setPosition(e);var t=(this.app,_(function(t){return t&&t.preventDefault&&t.preventDefault(),a("Saving deletion..."),this.withUser(_(function(t){if(!t)return i("Please log in to delete a comment.");var a={place_id:e.place_id,review_id:e.review_id};o.ajaxSubmit({url:"/auth/places/v1/delete-place-review",dataType:"json",timeout:6e4,data:a,success:_(function(t){t&&t.reviews?(hideDialog(),trackEvent("Curation","Delete comment",document.location.href),this.onPlaceChangeCurationComplete(),e.c&&e.c(t,a)):this.showError((t||{}).error?t.error:"Couldn't save your change, try reloading this page.")}).bind(this)})}).bind(this)),!1}).bind(this)),n=this._getTemplate("delete_comment")();showDialog(n,"curate-place",!0,this.x,this.y),this.updateLoginInfo();var o=$("#curate-form");o.find(".curate-cancel").click(hideDialog),o.submit(t)},t.initAskExpert=function(e){this.setPosition(e);var t=(this.app,_(function(t){return t.preventDefault(),a("Submitting your question..."),this.withUser(_(function(t){if(!t)return i("Please log in to edit a place.");var a=$("#curate-form .user-question").val();if(!a)return i("Please type a question.");var n=_(_(e).slice(["uid","cid","hid","uname","pname"])).extend({question:a});$.ajax({url:"/auth/places/v1/ask-expert",type:"POST",dataType:"json",data:n,success:_(function(t){updateDialog(this._getTemplate("ask_expert_thanks")()),trackEvent(ACTIVE_COMPONENT,"ask expert",document.location.href),e.c&&e.c(t,n)}).bind(this)})}).bind(this)),!1}).bind(this));showDialog(this._getTemplate("ask_expert")(e),"ask-expert wide",!0,this.x,this.y),this.updateLoginInfo(function(e){$("#curate-buttons").css("display",e?"block":"none"),a(e?"This will send email from "+e.email:"Sign in required to prevent abuse.")},null,!0),$("#curate-confirm").click(t),$(".curate-cancel").click(hideDialog)},t._wireUpRLB=function(e){var e=e||{},t=e.nodes||$("body").find(".apt-badlisting a");if(bootstrapIsPhone()){var a="walkscore@walkscore.com",i="Bad listing report from mobile site",n="I'm reporting the following listing as bad because...\n\nListing: "+window.location.href,o="mailto:"+a+"?subject="+encodeURIComponent(i)+"&body="+encodeURIComponent(n);t.attr("href",o)}else t.each(function(){$(this).click(function(e){return e.preventDefault(),window.dataCurator.initReportListing($(this).attr("class").substr(4),e.pageX,e.pageY),trackEvent(ACTIVE_COMPONENT,"report listing click",$(e.target).attr("tracklabel")),!1})})},t.initReportListing=function(e,t,a){this.x=t+20,this.y=a-70;var i=[];i.push("<h3>Report Listing</h3>"),i.push('<form name="curate-form" id="curate-form" method="post">'),i.push('<ul class="smalltextlist">'),i.push('<li><label for="rep1"><input type="radio" name="removeType" id="rep1" value="fraudscam"> Fraud or scam.  Remove immediately.</label></li>'),i.push('<li><label for="rep2"><input type="radio" name="removeType" id="rep2" value="notavailable"> No longer available</label></li>'),i.push('<li><label for="rep3"><input type="radio" name="removeType" id="rep3" value="badinfo"> Incorrect information</label></li>'),i.push('<li><label for="rep4"><input type="radio" name="removeType" id="rep4" value="landlordproblem"> Problem with landlord / manager</label></li>'),i.push('<li><label for="rep5"><input type="radio" name="removeType" id="rep5" value="other"> Other</label></li>'),i.push('</ul><div class="small-pad-top"><label>Comments: <span class="extra comments-required" style="display: none;">(required)</span> <span id="char-counter"></span></label>'),i.push('<textarea name="comments" id="comments" style="width:95%;" rows="2" ></textarea></div>'),i.push('<div id="user-login"></div>'),i.push('<div><input id="curate-confirm" type="button" class="b-btn" value="Report Listing" /> &nbsp; <input id="curate-cancel" class="b-btn light" type="button" value="Cancel" /></div>'),i.push('<div id="curation-messaging"><p class="tight-bot">&nbsp;</p></div>'),i.push("</form>"),i.push('<div class="clear-all"><p class="tight-bot smallfont">If you prefer not to sign in, you can <a id="report-listing-email">report this via email</a>.</p></div>'),i.push('<div><p class="tight-bot smallfont">Protect yourself from rental fraud.  <a href="/apartments/fraud-protection">Learn more</a>.</p></div>'),showDialog(i.join(""),"curate-place",!0,this.x,this.y),this.updateLoginInfo();$("#curate-form").submit(_(this.reportListing).bind(this,e)),$("#curate-confirm").click(_(this.reportListing).bind(this,e)),$("#curate-cancel").click(hideDialog),$("#curate-form").find("input[type=radio]").click(_(this.updateUI).bind(this)),$("#comments").keyup(function(){limitText($("#comments"),$("#char-counter"),DataCurator.COMMENT_MAX_LENGTH)}),$("#report-listing-email").click(_(function(){var t=$("#curate-form"),a=t.find("textarea").val(),i=t.find("input:radio[name=removeType]:checked").blur().val();return window.open(this.getRentalContactUrl(a,e,i)),!1}).bind(this)),trackEvent("Curation","Show remove dialog",document.location.href)},t.updateUI=function(){if($("#curate-form").length){var e="other"==$("#curate-form").find("input:radio[name=removeType]:checked").blur().val();$(".comments-required").css("display",e?"inline":"none")}},t.reportListing=function(e){var t=$("#curate-form"),a=t.find("textarea").val(),i=t.find("input:radio[name=removeType]:checked").blur().val();if(void 0==i)return void $("#curation-messaging").children().addClass("form-error-message").html("Please select a reason for reporting this listing.");if("other"==i&&0==a.length)return void $("#curation-messaging").children().addClass("form-error-message").html("Please comment on the reason for reporting this.");var n={rid:e,url:""+window.location,reason:i,comment:a};DEBUG_CURATION&&console.log("params",n);var o=function(i){if(DEBUG_CURATION&&console.log("response",i),i&&"OK"==i.result){var n="<h3>Thanks</h3>";n+="<p>We've received your listing report.</p>",n+='<input id="dialog-button" type="button" value="Close" />',updateDialog(n),$("#dialog-button").click(function(){hideDialog(),location.reload()})}else{var o=$.trim(t.find("input:radio[name=removeType]:checked").parent().text()),n="<h3>Oops... Something went wrong</h3>";n+='<p>Please <a href="'+this.getRentalContactUrl(a,e,o)+'">email us</a> to let us know.</p>',n+='<input id="dialog-button" type="button" value="OK" />',updateDialog(n),$("#dialog-button").click(hideDialog)}};$.ajax({url:"/auth/rentals/curate",type:"POST",data:n,dataType:"json",success:_(o).bind(this),error:_(o).bind(this,null)})},t.getRentalContactUrl=function(e,t,a){var i="/contact-us.php?m=report_listing&message=";return i+=encodeURIComponent("Comment:<br>"+e+"<br><br><br>----------------------------------------<br>"),i+=encodeURIComponent("Report Listing Details:<br>URL: "+window.location+"<br>Listing ID: "+t+"<br>Reason: "+(a||""))},t.submitData=function(e,t,a){var a=a||"/data/curate.php";$.ajax({url:a,type:"POST",data:e,success:t,error:t})}}(),function(){"use strict";window.latLngFromGoogleResponse=function(e,t){if(e&&e.length>t&&e[t].geometry){var a=e[t].geometry.location;return new google.maps.LatLng(a.lat(),a.lng())}return null},window.googleResponseHasCountry=function(e,t){if(e&&e.length>t&&e[t].address_components){var a=_(e[t].address_components).detect(function(e){return _(e.types).detect(function(e){return"country"==e})});return a.short_name}return!1},window.geoDataFromGoogleWithinRange=function(e,t,a,i,n){if(!t)return null;n||(n=Math.min(3,t.length));var o=_(_.range(n)).detect(_(function(i){var n=googleResponseHasCountry(t,i),o=google.maps.geometry.spherical.computeDistanceBetween(latLngFromGoogleResponse(t,i),e);return n&&a>o}).bind(this));return _.isUndefined(o)?null:geoDataFromGoogleResponse(t,i,Number(o))},window.geoDataFromGoogleResponse=function(e,t,a){if(ensure_ws(),0==(e||[]).length)return new GeoData;t||(t="");var i=null,n=null,o=null,s=null,r=null,l=null,c=null,d=null,u=null,p="",h=_.isUndefined(a)?e:[e[a]];if(_(h).detect(function(e){var t=e.geometry.location;n=new ws.LatLng(t.lat(),t.lng()),r=e.formatted_address;var a=[];return _(e.address_components).each(function(e){_(e.types).each(function(t){switch(t){case"street_number":a.unshift(e.long_name),p=e.long_name;break;case"route":a.push(e.long_name);break;case"locality":d=e.long_name;break;case"country":s=e.long_name,o=e.short_name;break;case"administrative_area_level_1":l=e.short_name;break;case"postal_code":u=e.long_name}}),c=a.join(" ")}),o}),o){DEBUG_AUDIT_GEOCODE&&(dbug("---NEW GEOCODE---"),dbug("query: "+t),dbug("latlng: "+dumpGLL(n)),dbug("countryCode: "+o),dbug("countryName: "+s),dbug("formattedAddress: "+r),dbug("administrativeAreaName: "+l),dbug("thoroughfare: "+c),dbug("localityName: "+d),dbug("postalCode: "+u),dbug("---------------"));var i=new GeoData(t,n,o,s,r,l,c,d,u,n);i.streetNumber=p}else if(e.Placemark){for(var m=1;m<e.Placemark.length;m++)if(e.Placemark[m].AddressDetails.Country){o=String(e.Placemark[m].AddressDetails.Country.CountryNameCode);break}var i=new GeoData(t,n,o)}return i}}(),window.RentalsTopMenus=t.exports=function(){var e=function(e){this._init(e)},t=e.prototype,a=function(e){this._init(e)},i=a.prototype;i.updateState=function(e){return this._update(e),this},i._init=function(e){this._id=e.id,this.controls=e.controls,this._shortname=e.shortname},i._update=function(e){var t=_(this.controls).detect(_(function(t){return e[t.member]&&(!t.keys||_(t.keys).detect(function(a){return e[t.member][a]}))}).bind(this));$(this._id)[t?"addClass":"removeClass"]("active")};var n=this,o=n.ListenerMixin||require("../listener-mixin");return t.position=function(){return this._positionMenus(),this},t.start=function(){return this._start(),this},t.openTo=function(e,t){return this._open(e,t),this},t.close=function(e){return this._close(e),this},t.onOpen=function(e){return this._addListener("open",e),this},t.onClose=function(e){return this._addListener("close",e),this},t.destroy=function(){return this._destroy(),this},t.setApp=function(e){return this.app=e,this},t.isOpen=function(){return this._isOpen()},o(t),t._init=function(e){this.app=e,this.buttons={},this._destructors=[],this._initMenuButtonObjects()},t._start=function(){this._initMenuExtraStuff(),this._activateMenus()},t._initRentalsAppButtons=function(){this._initClearButton(),this.app.commute_street&&this._open("#btn-commute"),this.app.openmenu&&this._open("#btn-"+this.app.openmenu,!1)},t._destroy=function(){this._unsetCloseHandler(),_(this._destructors).each(function(e){e()})},t._updateBodyClasses=function(e){e.commuteControls&&!this.hadShed?$("body").addClass("has-shed"):!e.commuteControls&&this.hadShed&&$("body").removeClass("has-shed"),this.hadShed=e.commuteControls},t._initClearButton=function(){var e=$("#btn-clear-filters"),t=_(function(){var t=this.app.getDirty();this._updateMenuButtonStates(t),_(t).detect(function(e){return e})?e.addClass("dirty").find("span:first").addClass("b-btn light"):e.removeClass("dirty"),this._updateBodyClasses(t)}).bind(this);this.app.commuteControls&&this.app.commuteControls.onUpdate(t),this.app.filtersView&&this.app.filtersView.onUpdate(t),this.app.transitLines&&this.app.transitLines.onUpdate(t),this.app.hoodFilter&&this.app.hoodFilter.onUpdate(t),this.app.overlays&&this.app.overlays.onUpdate(t),e.click(_(function(e){e.stopPropagation(),this.app.clearFilters()}).bind(this))},t._isOpen=function(){return $(".menu-button.open").length>0},t._positionMenus=function(){var e=$(".menu-button.open"),t=e.children(".menu");if(t.length>0){var a=e.offset().left,i=a+e.outerWidth(),n=t.outerWidth(),o=a,s=Math.max(i-n,$(window).width()-n-10),r=20,l=Math.max(r,Math.min(s,o));t.css("left",l-a-1+"px")}},t._activateMenus=function(){var e=_(this._clickHandler).bind(this),t=$(".menu-button").not(".no-highlight").not(".no-handlers");t.children(".menu").bind("click",function(e){e.stopPropagation()});var a=function(){e(this)};this._destructors.push(function(){t.unbind("click.topmenu")}),t.bind("click.topmenu",a),activateShareButton()},t._clickHandler=function(e){$(e).hasClass("open")||trackEvent(ACTIVE_COMPONENT,"filter opened",$(e).attr("id")),this._open(e,!0),_.defer(clearSelection)},t._open=function(e,t){var e=$(e),a=$(e).hasClass("open"),i=$(".menu-button.open");a||(this.app.notifications&&e.closest("#secondary-controls").length&&this.app.notifications.block(),this._alertListeners("open",$(e).attr("id")),$(e).addClass("open"),this._unsetCloseHandler(),_(_(function(){this.boundCloseHandler=_(this._menuCloseHandler).bind(this),$("body").click(this.boundCloseHandler)}).bind(this)).delay(200)),i.length&&(t||i.attr("id")!=e.attr("id"))&&this._close(i),this.position()},t._menuCloseHandler=function(e){var t=$(e.target),a=t.is("select"),i=t.closest(".open").length>0;i||a||this._close($(".menu-button.open"))},t._close=function(e){var t=$(e);t.hasClass("open")&&(t.removeClass("open"),t.attr("id")&&this._alertListeners("close",t.attr("id")),this._unsetCloseHandler()),this.app.notifications&&this.app.notifications.unblock()},t._unsetCloseHandler=function(e){this.boundCloseHandler&&($("body").unbind("click",this.boundCloseHandler),this.boundCloseHandler=null)},t._initMenuExtraStuff=function(){_([[90,100],[70,89],[50,69],[0,49]]).each(function(e,t){$("#walkscore-legend").find(".cat-"+t).click(_(function(){$("#btn-walkscore .filter_slider").slider("values",e)}).bind(this))})},t._initMenuButtonObjects=function(e){_([{id:"#btn-commute",shortname:"commute",controls:[{member:"commuteControls"}]},{id:"#btn-transit",shortname:"transit",controls:[{member:"transitLines"}]},{id:"#btn-hood",shortname:"hoods",controls:[{member:"hoodFilter"}]},{id:"#btn-walkscore",shortname:"score",controls:[{member:"filtersView",keys:[K_SCORE]},{member:"nearbyPlacesSearch"}]},{id:"#btn-morefilters",shortname:"price-and-beds",controls:[{member:"filtersView",keys:[K_BED,K_PRICE,K_IMAGE,K_DOGS,K_CATS]}]}]).each(_(this._addMenuButton).bind(this))},t._addMenuButton=function(e){var t=new a(e);this.buttons[t._id]=t,$(t._id+">span").html("<span class='m-icon'></span>"+FILTER_LABELS[t._shortname]+"<span class='toggle'></span>")},t._updateMenuButtonStates=function(e){_(this.buttons).each(function(t){t.updateState(e)})},e}(),window.RentalsFacebookConnector=t.exports=function(){var e=function(e){this._init(e)},t=e.prototype;return t.start=function(){return this._start(),this},t.onSignIn=function(e){return this._addListener("in",e),this},t.onSignInStart=function(e){return this._addListener("instart",e),this},t.onSignOut=function(e){return this._addListener("out",e),this},t.registerSignInLink=function(e,t){return this._rSIL(e,t),this},t.registerSignInNode=function(e,t){return this._rSIN(e,t),this},t.registerSignOutLink=function(e){return this._rSOL(e),this},t.getUser=function(){return this._getUser()},t.signIn=function(){return this._signIn()},t.signOut=function(){return this._signOut()},ListenerMixin(t),t._init=function(e){this.app=e,this.oidConnector=new OpenIdConnector,this._signedIn=!1,this.undeterminedState=!0},t._start=function(){this._signIn(),this.oidConnector.on("info",_(this._handleInfo).bind(this))},t._rSIL=function(e,t){t||(t="facebook"),this.oidConnector.registerSignInLink(e,t,_(this._signIn).bind(this),_(this._alertSignInStart).bind(this))},t._rSIN=function(e,t){t||(t="facebook"),this.oidConnector.registerSignInNode(e,t,_(this._signIn).bind(this),_(this._alertSignInStart).bind(this))},t._rSOL=function(e){this.oidConnector.registerSignOutLink(e,_(this._signOut).bind(this))},t._getUser=function(){return this._user},t._alertSignInStart=function(){this._alertListeners("instart")},t._handleSignIn=function(e){this._user=e,e&&!this._signedIn&&(this._alertListeners("in"),this._signedIn=!0)},t._handleSignOut=function(e){(this._user||this.undeterminedState)&&(this._user=null,this._signedIn=!1,this._alertListeners("out"))},t._handleInfo=function(e){e?this._handleSignIn(e):this._handleSignOut(),this.undeterminedState=!1},t._signIn=function(){this.oidConnector.withInfo(_(this._handleSignIn).bind(this))},t._signOut=function(){this.oidConnector.logout(_(this._handleSignOut).bind(this))},e}(),window.RentalsFacebookView=t.exports=function(){var e=function(e){this._init(e)},t=e.prototype,a=this,i=a.ListenerMixin||require("../listener-mixin"),n=a.$||require("../fake-jquery"),t=e.prototype;return t.start=function(){return this._start(),this},t.openMenu=function(){return this._openMenu(),this},t.refreshContentAvatars=function(){return this._refreshContentAvatars(),this},t.wirePopupLoginDialogs=function(e){return this._wirePopupLoginDialogs(e),this},t.showPopupLoginDialog=function(){return this._showPopupLoginDialog(),this},i(t),t._init=function(e){this.app=e},t._start=function(){this.facebook=this.app.facebook,n("#btn-login").removeClass("deactivated"),this.facebook.registerSignInLink("ws-fb-login"),this.facebook.registerSignInLink("ws-oid-login","google"),this.facebook.registerSignOutLink("ws-fb-logout"),this.facebook.onSignInStart(_(this._startSpinner).bind(this)),this.facebook.onSignIn(_(this._handleSignedIn).bind(this)),this.facebook.onSignOut(_(this._handleSignedOut).bind(this))},t._openMenu=function(){this.app.topMenus&&this.app.topMenus.openTo("#btn-login")},t._handleSignedIn=function(){this._stopSpinner();var e=this.facebook.getUser();if(e){this._refreshContentAvatars(e);var t=n("#nav-links").css("display","block").find("#btn-login").addClass("logged-in");n("#logged-out, .visible-logged-out").css("display","none"),t.find("#default-login-head").css("display","none"),t.find("#login-head").css("display","block").attr("src",e.image),t.find("#login-name").html('<span class="name">'+(e.first||e.name)+'</span><span class="toggle"></span>'),n("#logged-in, .visible-logged-in").css("display","block"),n("#my-places-link").attr("href","/people/"+e.display_id),this.app.topMenus&&(this.app.topMenus.position(),this.app.topMenus.close("#btn-login"))}},t._handleSignedOut=function(){this._stopSpinner(),this._refreshContentAvatars(null);var e=n("#nav-links").css("display","block").find("#btn-login").removeClass("logged-in");n("#logged-in, .visible-logged-in").css("display","none"),n("#logged-out, .visible-logged-out").css("display","block"),this.app.topMenus&&(this.app.topMenus.close("#btn-login"),0==e.closest("#respo-header").length&&e.find("#default-login-head").css("display","block"),e.find("#login-head").css("display","none"),e.find("#login-name").html('<span class="name noselect">Log in</span><span class="toggle"></span>'),this.app.topMenus&&this.app.topMenus.position())},t._startSpinner=function(){n("#logged-out").append('<img src="/images/progress.gif" class="progress">');
},t._stopSpinner=function(){n("#logged-out .progress").remove()},t._refreshContentAvatars=function(e){var e="undefined"!=typeof e?e:this.facebook.getUser();e?n(".login-head").attr("src",e.image).unbind().click(function(){window.location="/people/"+e.display_id}).css("cursor","pointer"):n(".login-head").attr("src","/images/search/login-head-50.png").unbind().css("cursor","auto")},t._wirePopupLoginDialogs=function(e){n(".sign-in-dialog").unbind("click").click(_(this._showPopupLoginDialog).bind(this,e))},t._showPopupLoginDialog=function(e){var t=(e.introText?"<p>"+e.introText+"</p>":"")+'<div class="user-login align-center"><p><a id="dialog-fb-login" class="fb-login login"></a></p><p><a id="dialog-goog-login" class="oid-login login"></a></p></div>',a=makeModal("login-dialog",{title:"Sign in",content:t,classes:"narrow"}).on("hidden",function(){n(".modal").remove()});this.facebook.on("instart",function(){a&&a.find(".user-login").html('<div class="progress-spinner"></div>')}),this.facebook.on("in",function(){a&&a.modal("hide")}),this.facebook.registerSignInNode(a.find("#dialog-fb-login")),this.facebook.registerSignInNode(a.find("#dialog-goog-login"),"google")},e}(),window.constants=t.exports=function(){return this._||(this._=require("../underscore-premixed")),this._ws_||(this._ws_=require("../util-shared")),{populate:function(){_ws_.makeIndices.call(this,["K_ID","K_LAT","K_LNG","K_BED","K_PRICE","K_DATE","K_PID","K_SCORE","K_DOGS","K_CATS","K_URLSLUG","K_IMAGE","K_HOOD","K_TSCORE","K_RANDOM","K_FLOORPLANS","K_ADDRESS","K_NAME","K_LEADGEN","K_RENTSALE","K_BATH","K_TYPE","K_DISPLAY","K_SECTION8"]),_ws_.makeIndices.call(this,["KD_BEDS","KD_PRICE_TYPE","KD_PRICE","KD_COMMUTE"]),_ws_.makeIndices.call(this,["VD_NONE","VD_SINGLE","VD_FROM"]),_ws_.makeFlags.call(this,["F_SALE","F_RENT"]),_ws_.makeFlags.call(this,["F_SINGLE","F_CONDO","F_TOWNHOME"]),this.RENTSALE_MAP={"homes-for-sale":F_SALE,apartments:F_RENT,homes:F_RENT|F_SALE},this.RENTSALE_UNMAP=_(this.RENTSALE_MAP).oreduce(function(e,t,a){e[t]=a}),this.FILTER_LABELS={"price-and-beds":"Price &amp; Beds",commute:"Commute Time",score:"Gotta Have&hellip;",transit:"Public Transit",hoods:"Neighborhoods"},_({K_CARF:"carf",K_TRAVEL:"travel",K_LATLNG:"latLng",K_HIDDEN:"hidden",K_PRICE_MIN:"price-min",K_PRICE_MAX:"price-max"}).each(function(e,t){this[t]=e}),this.COMMUTE_CLASSES=_(["a","b","c","d","e","f","g","h"]).map(function(e){return"commute-"+e}),this.COMMUTE_COLORS=_(["#0ca312","#dfa31a","#52c6e7","#ea1111","#ff52e9","#7007ff","#ff7901","#3971d0"]).chain().zip(this.COMMUTE_CLASSES).oreduce(function(e,t){e[t[1]]=t[0]}).value(),this.MARKER_IW=0,this.MARKER_TOOLTIP=1,this.MARKER_FAVORITE=2,this.MARKER_SEEN=3,this.CURRENT_LOCATION="Current Location",this.POP_CONSTANTS=function(){this.IS_LOW_PERFORMANCE=getPerformanceLevel()==PERF_ABYSMAL,this.DEFAULT_MAX_SIDEBAR=50,this.DEFAULT_MAX_DISPLAY=[50,100,100,200,200][getPerformanceLevel()]}}}}(),window.PlaceDataCuratorConstituent=t.exports=function(){var t=function(e){this._init(e)},a=t.prototype;return a.start=function(){return this._start(),this},a.setApp=function(e){return this._setApp(e),this},ListenerMixin(a),a._init=function(t){this.app=t,this.dataCurator=new e(this.app,this.app.facebook.oidConnector)},a._start=function(){},a._setApp=function(e){this.app=e,this.dataCurator.app=e},t}(),constants.populate.call(this);var a=function(){this._init()};!function(){var e=a.prototype;ConstituentsMixin(e),e._init=function(){var e={topMenus:RentalsTopMenus,facebook:RentalsFacebookConnector,facebookView:RentalsFacebookView,curator:PlaceDataCuratorConstituent};window.PlaceDataCurator&&(e.curator=PlaceDataCuratorConstituent),this._initConstituents(e)}}(),$(document).ready(function(){window.simpleLoginApp=new a})}();